{"version":3,"sources":["uni-app:///main.js","webpack:///D:/PrivateFiles/HBuilderProjects/ID-Local/pages/subperiod/weight/weight.vue?7e61","webpack:///D:/PrivateFiles/HBuilderProjects/ID-Local/pages/subperiod/weight/weight.vue?7eb3","webpack:///D:/PrivateFiles/HBuilderProjects/ID-Local/pages/subperiod/weight/weight.vue?1ade","webpack:///D:/PrivateFiles/HBuilderProjects/ID-Local/pages/subperiod/weight/weight.vue?32ad","uni-app:///pages/subperiod/weight/weight.vue","webpack:///D:/PrivateFiles/HBuilderProjects/ID-Local/pages/subperiod/weight/weight.vue?9b1a","webpack:///D:/PrivateFiles/HBuilderProjects/ID-Local/pages/subperiod/weight/weight.vue?2b15"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","y","m","d","weightRecords","profile","uni","res","data","rangeKey","todayStr","todayKg","heightCm","stats","count","delta","latestText","latestDateText","firstText","avgText","stdText","minText","maxText","deltaText","pointsAll","points","chartTrend","chartWeek","chartDist","weekAgg","categories","values","distSeries","optsTrend","padding","legend","show","position","xAxis","disableGrid","labelCount","scrollShow","yAxis","gridType","dashLength","extra","mix","line","type","width","optsWeek","column","optsDist","ring","ringWidth","centerColor","showWeightPopup","weightInput","weightDisplay","showHeightPopup","heightInput","computed","rangeLabel","hasToday","todayKgText","todayKgDetail","heightText","bmiValue","bmiText","bmiTagText","onShow","methods","noop","setRange","reload","store","map","dateStr","kg","filter","sort","recompute","minDate","cut","fillEmpty","buildStats","buildTrendChart","series","name","buildWeekAgg","pts","buildDist","bins","a","b","c","arr","bin","value","openWeightForToday","onWeightCancel","onWeightKey","s","onWeightDel","onWeightConfirm","title","icon","saveStore","openHeightPopup","onHeightCancel","onHeightConfirm"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,eAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAmH;AACnH;AAC0D;AACL;AACa;;;AAGlE;AACqL;AACrL,gBAAgB,yLAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,iFAAM;AACR,EAAE,0FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,qFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACrBA;AAAA;AAAA;AAAA;AAA6rB,CAAgB,4qBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACqOjtB;AAEA;EACA;AACA;AACA;EACA;AACA;AACA;EACA;IAAA;IAAAC;IAAAC;IAAAC;EACA;AACA;AACA;EACA;EACA;EACA;IAAAC;IAAAC;EAAA;AACA;AACA;EACAC;AACA;AACA;EACA;AACA;AACA;EACA;EACA;IAAA;EAAA;AACA;AACA;EACA;EACA;EACA;IAAA;EAAA;EACA;AACA;AACA;EAAA;EACA;EACA;IACA;IACA;IACAC;EACA;EACA;AACA;AACA;EACA;EACA;EACAJ;EACA;EACA;EACA;EACA;AACA;AAAA,eAEA;EACAK;IACA;MACAC;MACAC;MACAC;MACAC;MAEA;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MAEAC;MACAC;MAEAC;MACAC;MACAC;MAEAC;QAAAC;QAAAC;MAAA;MACAC;MAEAC;QACAC;QACAC;UAAAC;UAAAC;QAAA;QACAC;UAAAC;UAAAC;UAAAC;QAAA;QACAC;UAAAC;UAAAC;QAAA;QACAC;UAAAC;YAAAC;cAAAC;cAAAC;YAAA;UAAA;QAAA;MACA;MACAC;QACAhB;QACAC;UAAAC;QAAA;QACAE;UAAAC;UAAAC;QAAA;QACAE;UAAAC;UAAAC;QAAA;QACAC;UAAAM;YAAAF;UAAA;QAAA;MACA;MACAG;QACAlB;QACAC;UAAAC;QAAA;QACAS;UAAAQ;YAAAC;YAAAC;UAAA;QAAA;MACA;MAEA;MACAC;MACAC;MACAC;MAEA;MACAC;MACAC;IACA;EACA;EAEAC;IACAC;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;EACA;EAEAC;IACA;EACA;EAEAC;IACAC;IAEAC;MACA;MACA;IACA;IAEAC;MACA;MACAC;MACAA;;MAEA;MACA;MACA;;MAEA;MACA;MACA;MACA;MACA;;MAEA;MACA,4CACAC;QACA;QACA;QACA;QACA;UAAAC;UAAAC;QAAA;MACA,GACAC,gBACAC;QAAA;MAAA;MAEA;MACA;IACA;IAEAC;MACA;MACA;QACA;QACA;QACA;MACA;MAEA;MACA;QACA;QACA;QACA;QACAC;QACAC;UAAA;QAAA;MACA;MACA;MAEA;MACA;MACA;MACA;IACA;IAEAC;MACA;QACAtE;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACA;MACA;MACA;MACA;QAAAO;QAAAC;MAAA;MACA;IACA;IAEAsD;MACA;MACA;MAEA;MACA;MAEA;QAAA;MAAA;MACA;MACA;MACA;MACA;MACA;MAEA;QACAvE;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;IACA;IAEA+D;MACA;MACA;QAAA;MAAA;MACA;QAAA;MAAA;MACA;;MAEA;MACA;QACAxD;QACAyD,SACA;UAAAC;UAAAxC;UAAAxC;QAAA,GACA;UAAAgF;UAAAxC;UAAAxC;QAAA;MAEA;IACA;IAEAiF;MACA;MACA;MACAC;QACA;QACAd;QACAA;MACA;MAEA;MACA;QAAA;MAAA;MACA;QAAA;MAAA;MAEA;QAAA9C;QAAAC;MAAA;MACA;QACAD;QACAyD;UAAAC;UAAAhF;QAAA;MACA;IACA;IAEAmF;MACA;MACA;QAAA;MAAA;QAAA;MAAA;MACA;QACA;QACA;QACA;MACA;MAEA;MACA;MACA;MACA;MAEA;MACA;QACA;QACA;QACAC;UAAAC;UAAAC;UAAAC;QAAA;MACA;MACAC;QACA;UACA;UACA;UACA;YACAC;YACA;UACA;QACA;MACA;MAEA,kBACAlB;QAAA;MAAA,GACAH;QAAA;UAAAY;UAAAU;QAAA;MAAA;MAEA;MACA;QAAAX;MAAA;IACA;IAEA;IACAY;MACA;MACAxB;MACA;MACA;MAEA;MACA;MAEA;MACA;MACA;IACA;IAEAyB;MACA;IACA;IAEAC;MACA;MACA;MAEA;QACA;QACA;QACAC;MACA;QACA,0BACAA;MACA;;MAEA;MACA;MACA;QACA;QACA;QACA;QACAA;MACA;MAEA;MACA;IACA;IAEAC;MACA;MACA;QACA;QACA;MACA;MACAD;MACA;MACA;IACA;IAEAE;MACA;MACA;MACA;MAEA;MACA;QACAlG;UAAAmG;UAAAC;QAAA;QACA;MACA;MAEA;MACA/B;MACAA;MAEA;QACA;UACA;UACAgC;UACArG;YAAAmG;YAAAC;UAAA;QACA;UACApG;YAAAmG;YAAAC;UAAA;QACA;QACA;QACA;QACA;MACA;MAEA/B;QAAAG;MAAA;MACA6B;MAEA;MACArG;QAAAmG;QAAAC;MAAA;MACA;IACA;IAEA;IACAE;MACA;MACA;IACA;IAEAC;MACA;IACA;IAEAC;MACA;MACA;QACAxG;UAAAmG;UAAAC;QAAA;QACA;MACA;MAEA;MACA/B;MACAA;MACAgC;MAEA;MACArG;QAAAmG;QAAAC;MAAA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;ACtrBA;AAAA;AAAA;AAAA;AAAo/B,CAAgB,y7BAAG,EAAC,C;;;;;;;;;;;ACAxgC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/subperiod/weight/weight.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/subperiod/weight/weight.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./weight.vue?vue&type=template&id=29a13d78&\"\nvar renderjs\nimport script from \"./weight.vue?vue&type=script&lang=js&\"\nexport * from \"./weight.vue?vue&type=script&lang=js&\"\nimport style0 from \"./weight.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/subperiod/weight/weight.vue\"\nexport default component.exports","export * from \"-!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./weight.vue?vue&type=template&id=29a13d78&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.pointsAll.length\n  var g1 = _vm.weekAgg.categories.length\n  var g2 = _vm.distSeries.length\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        g2: g2,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./weight.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./weight.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"page-wrap\">\n    <scroll-view class=\"page\" :scroll-y=\"true\">\n      <!-- 顶部大卡片：今日体重 + BMI -->\n      <view class=\"hero-card\">\n        <view class=\"hero-row\">\n          <view class=\"hero-left\">\n            <text class=\"hero-k\">今儿</text>\n            <text class=\"hero-v\">{{ todayKgText }}</text>\n            <text class=\"hero-unit\">kg</text>\n\n            <view class=\"hero-sub\">\n              <text class=\"sub-item\">体重：{{ todayKgDetail }}</text>\n              <text class=\"sub-dot\">·</text>\n              <text class=\"sub-item\">BMI：{{ bmiText }}</text>\n            </view>\n\n            <view class=\"hero-sub2\">\n              <text class=\"sub2-item\">身高：{{ heightText }}</text>\n              <text class=\"sub-dot\">·</text>\n              <text class=\"sub2-item\">日期：{{ todayStr }}</text>\n            </view>\n          </view>\n\n          <view class=\"hero-right\">\n            <view class=\"hero-btn primary\" @tap=\"openWeightForToday\">\n              <text class=\"hero-btn-t\">{{ hasToday ? '修改' : '记录' }}</text>\n            </view>\n            <view class=\"hero-btn ghost\" @tap=\"openHeightPopup\">\n              <text class=\"hero-btn-t\">身高</text>\n            </view>\n          </view>\n        </view>\n\n        <view class=\"hero-tip\" v-if=\"!hasToday\">\n          今天还没记录体重哦～点右侧「记录」即可\n        </view>\n\n        <view class=\"hero-bmi-tag\" v-if=\"bmiTagText\">\n          <text class=\"bmi-tag\">{{ bmiTagText }}</text>\n        </view>\n      </view>\n\n      <!-- 范围切换 -->\n      <view class=\"range-bar\" v-if=\"pointsAll.length\">\n        <view class=\"pill\" :class=\"{ on: rangeKey === '7' }\" @tap=\"setRange('7')\">7天</view>\n        <view class=\"pill\" :class=\"{ on: rangeKey === '30' }\" @tap=\"setRange('30')\">30天</view>\n        <view class=\"pill\" :class=\"{ on: rangeKey === '90' }\" @tap=\"setRange('90')\">90天</view>\n        <view class=\"pill\" :class=\"{ on: rangeKey === 'all' }\" @tap=\"setRange('all')\">全部</view>\n      </view>\n\n      <!-- 概览指标 -->\n      <view class=\"card\" v-if=\"stats.count\">\n        <view class=\"card-title\">概览</view>\n\n        <view class=\"metrics\">\n          <view class=\"metric\">\n            <text class=\"m-k\">最新</text>\n            <text class=\"m-v\">{{ stats.latestText }}</text>\n            <text class=\"m-s\">{{ stats.latestDateText }}</text>\n          </view>\n\n          <view class=\"metric\">\n            <text class=\"m-k\">近{{ rangeLabel }}变化</text>\n            <text class=\"m-v\" :class=\"{ up: stats.delta > 0, down: stats.delta < 0 }\">\n              {{ stats.deltaText }}\n            </text>\n            <text class=\"m-s\">起点：{{ stats.firstText }}</text>\n          </view>\n\n          <view class=\"metric\">\n            <text class=\"m-k\">均值</text>\n            <text class=\"m-v\">{{ stats.avgText }}</text>\n            <text class=\"m-s\">波动：{{ stats.stdText }}</text>\n          </view>\n\n          <view class=\"metric\">\n            <text class=\"m-k\">范围</text>\n            <text class=\"m-v\">{{ stats.minText }} ~ {{ stats.maxText }}</text>\n            <text class=\"m-s\">记录：{{ stats.count }}天</text>\n          </view>\n        </view>\n      </view>\n\n      <!-- 空态 -->\n      <view class=\"card\" v-if=\"!stats.count\">\n        <view class=\"card-title\">还没有体重记录</view>\n        <view class=\"empty\">\n          <text class=\"empty-t\">点上方「记录」开始吧～</text>\n        </view>\n      </view>\n\n      <!-- 图1：趋势折线 -->\n      <view class=\"card\" v-if=\"stats.count\">\n        <view class=\"card-title\">趋势</view>\n        <view class=\"sub\">折线：每日体重（kg）｜虚线：7日均线</view>\n        <view class=\"chart-box\">\n          <qiun-data-charts\n            type=\"mix\"\n            :opts=\"optsTrend\"\n            :chartData=\"chartTrend\"\n            :canvas2d=\"true\"\n            :canvasId=\"'trendChart'\"\n            :inScrollView=\"true\"\n          />\n        </view>\n      </view>\n\n      <!-- 图2：周均柱状 -->\n      <view class=\"card\" v-if=\"weekAgg.categories.length\">\n        <view class=\"card-title\">周均体重</view>\n        <view class=\"sub\">按自然周聚合，更能看出长期趋势</view>\n        <view class=\"chart-box\">\n          <qiun-data-charts\n            type=\"column\"\n            :opts=\"optsWeek\"\n            :chartData=\"chartWeek\"\n            :canvas2d=\"true\"\n            :canvasId=\"'weekChart'\"\n            :inScrollView=\"true\"\n          />\n        </view>\n      </view>\n\n      <!-- 图3：分布环形 -->\n      <view class=\"card\" v-if=\"distSeries.length\">\n        <view class=\"card-title\">体重分布</view>\n        <view class=\"sub\">自动根据你的数据生成区间</view>\n        <view class=\"chart-box\">\n          <qiun-data-charts\n            type=\"ring\"\n            :opts=\"optsDist\"\n            :chartData=\"chartDist\"\n            :canvas2d=\"true\"\n            :canvasId=\"'distChart'\"\n            :inScrollView=\"true\"\n          />\n        </view>\n\n        <view class=\"dist-legend\">\n          <view class=\"dist-item\" v-for=\"(it, idx) in distSeries\" :key=\"idx\">\n            <text class=\"dist-name\">{{ it.name }}</text>\n            <text class=\"dist-val\">{{ it.value }}天</text>\n          </view>\n        </view>\n      </view>\n\n      <view class=\"bottom-spacer\"></view>\n    </scroll-view>\n\n    <!-- =====体重输入：底部弹窗===== -->\n    <view v-if=\"showWeightPopup\">\n      <view class=\"sheet-mask\" @tap=\"onWeightCancel\" @touchmove.stop.prevent=\"noop\"></view>\n\n      <view class=\"sheet\" @tap.stop.prevent=\"noop\" @touchmove.stop.prevent=\"noop\">\n        <view class=\"sheet-header\">\n          <text class=\"sheet-btn\" @tap=\"onWeightCancel\">取消</text>\n          <text class=\"sheet-title\">体重</text>\n          <text class=\"sheet-btn sheet-btn-primary\" @tap=\"onWeightConfirm\">确定</text>\n        </view>\n\n        <view class=\"sheet-value\">\n          <text class=\"value-num\">{{ weightDisplay }}</text>\n          <text class=\"value-unit\">公斤</text>\n        </view>\n\n        <view class=\"sheet-keypad\">\n          <view class=\"key-row\">\n            <view class=\"key\" data-k=\"1\" @tap=\"onWeightKey\">1</view>\n            <view class=\"key\" data-k=\"2\" @tap=\"onWeightKey\">2</view>\n            <view class=\"key\" data-k=\"3\" @tap=\"onWeightKey\">3</view>\n          </view>\n          <view class=\"key-row\">\n            <view class=\"key\" data-k=\"4\" @tap=\"onWeightKey\">4</view>\n            <view class=\"key\" data-k=\"5\" @tap=\"onWeightKey\">5</view>\n            <view class=\"key\" data-k=\"6\" @tap=\"onWeightKey\">6</view>\n          </view>\n          <view class=\"key-row\">\n            <view class=\"key\" data-k=\"7\" @tap=\"onWeightKey\">7</view>\n            <view class=\"key\" data-k=\"8\" @tap=\"onWeightKey\">8</view>\n            <view class=\"key\" data-k=\"9\" @tap=\"onWeightKey\">9</view>\n          </view>\n          <view class=\"key-row\">\n            <view class=\"key\" data-k=\".\" @tap=\"onWeightKey\">.</view>\n            <view class=\"key\" data-k=\"0\" @tap=\"onWeightKey\">0</view>\n            <view class=\"key key-del\" @tap=\"onWeightDel\">\n              <text class=\"del-t\">⌫</text>\n            </view>\n          </view>\n\n          <view class=\"sheet-hint\">输入 0 可删除今天记录</view>\n        </view>\n      </view>\n    </view>\n\n    <!-- =====身高输入弹窗===== -->\n    <view v-if=\"showHeightPopup\">\n      <view class=\"sheet-mask\" @tap=\"onHeightCancel\" @touchmove.stop.prevent=\"noop\"></view>\n\n      <view class=\"sheet\" @tap.stop.prevent=\"noop\" @touchmove.stop.prevent=\"noop\">\n        <view class=\"sheet-header\">\n          <text class=\"sheet-btn\" @tap=\"onHeightCancel\">取消</text>\n          <text class=\"sheet-title\">身高</text>\n          <text class=\"sheet-btn sheet-btn-primary\" @tap=\"onHeightConfirm\">确定</text>\n        </view>\n\n        <view class=\"height-box\">\n          <view class=\"height-row\">\n            <text class=\"height-k\">身高</text>\n            <input\n              class=\"height-input\"\n              type=\"number\"\n              v-model=\"heightInput\"\n              placeholder=\"例如 170\"\n              maxlength=\"3\"\n            />\n            <text class=\"height-u\">cm</text>\n          </view>\n\n          <view class=\"height-hint\">\n            用于计算 BMI（BMI = 体重 / 身高²）\n          </view>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nconst STORE_KEY = 'period_record_v1';\n\nfunction pad2(n) {\n  return (n < 10 ? '0' : '') + n;\n}\nfunction toDateStr(d) {\n  return `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;\n}\nfunction parseDateStr(s) {\n  const [y, m, d] = s.split('-').map(Number);\n  return new Date(y, m - 1, d);\n}\nfunction loadStore() {\n  const v = uni.getStorageSync(STORE_KEY);\n  if (v && typeof v === 'object') return v;\n  return { weightRecords: {}, profile: {} };\n}\nfunction saveStore(store) {\n  uni.setStorageSync(STORE_KEY, store);\n}\nfunction round2(x) {\n  return Math.round(x * 100) / 100;\n}\nfunction mean(arr) {\n  if (!arr.length) return 0;\n  return arr.reduce((a, b) => a + b, 0) / arr.length;\n}\nfunction stddev(arr) {\n  if (arr.length <= 1) return 0;\n  const m = mean(arr);\n  const v = mean(arr.map((x) => (x - m) * (x - m)));\n  return Math.sqrt(v);\n}\nfunction movingAvg(points, win = 7) {\n  const res = [];\n  for (let i = 0; i < points.length; i++) {\n    const start = Math.max(0, i - win + 1);\n    const slice = points.slice(start, i + 1);\n    res.push(round2(mean(slice)));\n  }\n  return res;\n}\nfunction getWeekKey(dateObj) {\n  const d = new Date(Date.UTC(dateObj.getFullYear(), dateObj.getMonth(), dateObj.getDate()));\n  const dayNum = d.getUTCDay() || 7;\n  d.setUTCDate(d.getUTCDate() + 4 - dayNum);\n  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\n  const weekNo = Math.ceil(((d - yearStart) / 86400000 + 1) / 7);\n  const y = d.getUTCFullYear();\n  return `${y}-W${pad2(weekNo)}`;\n}\n\nexport default {\n  data() {\n    return {\n      rangeKey: '30',\n      todayStr: toDateStr(new Date()),\n      todayKg: null,\n      heightCm: null,\n\n      // stats\n      stats: {\n        count: 0,\n        delta: 0,\n        latestText: '--',\n        latestDateText: '--',\n        firstText: '--',\n        avgText: '--',\n        stdText: '--',\n        minText: '--',\n        maxText: '--',\n        deltaText: '--'\n      },\n\n      pointsAll: [],\n      points: [],\n\n      chartTrend: {},\n      chartWeek: {},\n      chartDist: {},\n\n      weekAgg: { categories: [], values: [] },\n      distSeries: [],\n\n      optsTrend: {\n        padding: [12, 10, 8, 6],\n        legend: { show: true, position: 'top' },\n        xAxis: { disableGrid: true, labelCount: 5, scrollShow: false },\n        yAxis: { gridType: 'dash', dashLength: 4 },\n        extra: { mix: { line: { type: 'curve', width: 2 } } }\n      },\n      optsWeek: {\n        padding: [12, 10, 8, 6],\n        legend: { show: false },\n        xAxis: { disableGrid: true, labelCount: 6 },\n        yAxis: { gridType: 'dash', dashLength: 4 },\n        extra: { column: { width: 14 } }\n      },\n      optsDist: {\n        padding: [12, 10, 8, 6],\n        legend: { show: false },\n        extra: { ring: { ringWidth: 16, centerColor: '#ffffff' } }\n      },\n\n      // 体重弹窗\n      showWeightPopup: false,\n      weightInput: '',\n      weightDisplay: '0',\n\n      // 身高弹窗\n      showHeightPopup: false,\n      heightInput: ''\n    };\n  },\n\n  computed: {\n    rangeLabel() {\n      if (this.rangeKey === '7') return '7天';\n      if (this.rangeKey === '30') return '30天';\n      if (this.rangeKey === '90') return '90天';\n      return '全部';\n    },\n    hasToday() {\n      return typeof this.todayKg === 'number' && this.todayKg > 0;\n    },\n    todayKgText() {\n      return this.hasToday ? this.todayKg.toFixed(2) : '--';\n    },\n    todayKgDetail() {\n      return this.hasToday ? `${this.todayKg.toFixed(2)} kg` : '--';\n    },\n    heightText() {\n      return this.heightCm ? `${this.heightCm} cm` : '未设置';\n    },\n    bmiValue() {\n      if (!this.hasToday) return null;\n      if (!this.heightCm || this.heightCm <= 0) return null;\n      const h = this.heightCm / 100;\n      return round2(this.todayKg / (h * h));\n    },\n    bmiText() {\n      if (!this.hasToday) return '--';\n      if (!this.heightCm) return '未设置身高';\n      if (this.bmiValue == null) return '--';\n      return this.bmiValue.toFixed(1);\n    },\n    bmiTagText() {\n      // 常用 BMI 分级（仅作参考，不用于医疗诊断）\n      const v = this.bmiValue;\n      if (v == null) return '';\n      if (v < 18.5) return '偏瘦';\n      if (v < 24) return '正常';\n      if (v < 28) return '超重';\n      return '肥胖';\n    }\n  },\n\n  onShow() {\n    this.reload();\n  },\n\n  methods: {\n    noop() {},\n\n    setRange(key) {\n      this.rangeKey = key;\n      this.recompute();\n    },\n\n    reload() {\n      const store = loadStore();\n      store.weightRecords = store.weightRecords || {};\n      store.profile = store.profile || {};\n\n      // 身高\n      const h = Number(store.profile.heightCm || 0);\n      this.heightCm = h > 0 ? h : null;\n\n      // 今日体重\n      const today = this.todayStr;\n      const rec = store.weightRecords[today];\n      const kg = rec && typeof rec.kg === 'number' ? rec.kg : 0;\n      this.todayKg = kg > 0 ? kg : null;\n\n      // 全部体重记录 -> 数组\n      const list = Object.keys(store.weightRecords)\n        .map((dateStr) => {\n          const r = store.weightRecords[dateStr];\n          const k = r && typeof r.kg === 'number' ? r.kg : null;\n          if (k == null || k <= 0) return null;\n          return { dateStr, kg: Number(k) };\n        })\n        .filter(Boolean)\n        .sort((a, b) => parseDateStr(a.dateStr) - parseDateStr(b.dateStr));\n\n      this.pointsAll = list;\n      this.recompute();\n    },\n\n    recompute() {\n      const all = this.pointsAll.slice();\n      if (!all.length) {\n        this.points = [];\n        this.fillEmpty();\n        return;\n      }\n\n      let cut = all;\n      if (this.rangeKey !== 'all') {\n        const days = Number(this.rangeKey);\n        const lastDate = parseDateStr(all[all.length - 1].dateStr);\n        const minDate = new Date(lastDate.getTime());\n        minDate.setDate(minDate.getDate() - (days - 1));\n        cut = all.filter((p) => parseDateStr(p.dateStr) >= minDate);\n      }\n      this.points = cut;\n\n      this.buildStats();\n      this.buildTrendChart();\n      this.buildWeekAgg();\n      this.buildDist();\n    },\n\n    fillEmpty() {\n      this.stats = {\n        count: 0,\n        delta: 0,\n        latestText: '--',\n        latestDateText: '--',\n        firstText: '--',\n        avgText: '--',\n        stdText: '--',\n        minText: '--',\n        maxText: '--',\n        deltaText: '--'\n      };\n      this.chartTrend = {};\n      this.chartWeek = {};\n      this.chartDist = {};\n      this.weekAgg = { categories: [], values: [] };\n      this.distSeries = [];\n    },\n\n    buildStats() {\n      const pts = this.points;\n      const count = pts.length;\n\n      const first = pts[0];\n      const last = pts[pts.length - 1];\n\n      const arr = pts.map((p) => p.kg);\n      const avg = mean(arr);\n      const std = stddev(arr);\n      const min = Math.min.apply(null, arr);\n      const max = Math.max.apply(null, arr);\n      const delta = round2(last.kg - first.kg);\n\n      this.stats = {\n        count,\n        delta,\n        latestText: `${last.kg.toFixed(2)} kg`,\n        latestDateText: last.dateStr,\n        firstText: `${first.kg.toFixed(2)} kg`,\n        avgText: `${avg.toFixed(2)} kg`,\n        stdText: `${std.toFixed(2)} kg`,\n        minText: `${min.toFixed(2)} kg`,\n        maxText: `${max.toFixed(2)} kg`,\n        deltaText: `${delta > 0 ? '+' : ''}${delta.toFixed(2)} kg`\n      };\n    },\n\n    buildTrendChart() {\n      const pts = this.points;\n      const categories = pts.map((p) => p.dateStr.slice(5)); // MM-DD\n      const values = pts.map((p) => round2(p.kg));\n      const ma7 = movingAvg(values, 7);\n\n      // 用 mix：两条线（体重 + 均线）\n      this.chartTrend = {\n        categories,\n        series: [\n          { name: '体重', type: 'line', data: values },\n          { name: '7日均线', type: 'line', data: ma7 }\n        ]\n      };\n    },\n\n    buildWeekAgg() {\n      const pts = this.points;\n      const map = {};\n      pts.forEach((p) => {\n        const wk = getWeekKey(parseDateStr(p.dateStr));\n        map[wk] = map[wk] || [];\n        map[wk].push(p.kg);\n      });\n\n      const keys = Object.keys(map).sort();\n      const categories = keys.map((k) => k.replace('-W', 'W'));\n      const values = keys.map((k) => round2(mean(map[k])));\n\n      this.weekAgg = { categories, values };\n      this.chartWeek = {\n        categories,\n        series: [{ name: '周均(kg)', data: values }]\n      };\n    },\n\n    buildDist() {\n      const pts = this.points;\n      const arr = pts.map((p) => p.kg).sort((a, b) => a - b);\n      if (!arr.length) {\n        this.distSeries = [];\n        this.chartDist = {};\n        return;\n      }\n\n      const min = arr[0];\n      const max = arr[arr.length - 1];\n      const span = Math.max(0.01, max - min);\n      const step = span / 5;\n\n      const bins = [];\n      for (let i = 0; i < 5; i++) {\n        const a = min + step * i;\n        const b = i === 4 ? max : min + step * (i + 1);\n        bins.push({ a, b, c: 0 });\n      }\n      arr.forEach((x) => {\n        for (let i = 0; i < bins.length; i++) {\n          const bin = bins[i];\n          const isLast = i === bins.length - 1;\n          if ((x >= bin.a && x < bin.b) || (isLast && x <= bin.b)) {\n            bin.c++;\n            break;\n          }\n        }\n      });\n\n      const series = bins\n        .filter((b) => b.c > 0)\n        .map((b) => ({ name: `${b.a.toFixed(1)}~${b.b.toFixed(1)}kg`, value: b.c }));\n\n      this.distSeries = series;\n      this.chartDist = { series };\n    },\n\n    // ====== 今日体重录入 ======\n    openWeightForToday() {\n      const store = loadStore();\n      store.weightRecords = store.weightRecords || {};\n      const rec = store.weightRecords[this.todayStr];\n      const kg = rec && typeof rec.kg === 'number' ? rec.kg : 0;\n\n      let showVal = '';\n      if (kg > 0) showVal = kg.toFixed(2);\n\n      this.showWeightPopup = true;\n      this.weightInput = showVal;\n      this.weightDisplay = showVal || '0';\n    },\n\n    onWeightCancel() {\n      this.showWeightPopup = false;\n    },\n\n    onWeightKey(e) {\n      const k = e.currentTarget.dataset.k;\n      let s = this.weightInput || '';\n\n      if (k === '.') {\n        if (s.includes('.')) return;\n        if (s === '') s = '0';\n        s = s + '.';\n      } else {\n        if (s === '0') s = k;\n        else s = s + k;\n      }\n\n      // 限制：整数3位，小数2位\n      const m = s.match(/^(\\d{0,3})(?:\\.(\\d{0,2}))?/);\n      if (m) {\n        const intPart = m[1] || '';\n        const dot = s.includes('.') ? '.' : '';\n        const decPart = (s.split('.')[1] || '').slice(0, 2);\n        s = intPart + (dot ? dot + decPart : '');\n      }\n\n      this.weightInput = s;\n      this.weightDisplay = s === '' ? '0' : s;\n    },\n\n    onWeightDel() {\n      let s = this.weightInput || '';\n      if (!s) {\n        this.weightDisplay = '0';\n        return;\n      }\n      s = s.slice(0, -1);\n      this.weightInput = s;\n      this.weightDisplay = s === '' ? '0' : s;\n    },\n\n    onWeightConfirm() {\n      let s = (this.weightInput || '').trim();\n      if (s === '') s = (this.weightDisplay || '').trim();\n      if (s === '') s = '0';\n\n      const num = parseFloat(s);\n      if (isNaN(num) || num < 0) {\n        uni.showToast({ title: '请输入有效体重', icon: 'none' });\n        return;\n      }\n\n      const store = loadStore();\n      store.weightRecords = store.weightRecords || {};\n      store.profile = store.profile || {};\n\n      if (num === 0) {\n        if (store.weightRecords[this.todayStr]) {\n          delete store.weightRecords[this.todayStr];\n          saveStore(store);\n          uni.showToast({ title: '已删除今天体重', icon: 'none' });\n        } else {\n          uni.showToast({ title: '今天未记录体重', icon: 'none' });\n        }\n        this.showWeightPopup = false;\n        this.reload();\n        return;\n      }\n\n      store.weightRecords[this.todayStr] = { kg: Number(num.toFixed(2)) };\n      saveStore(store);\n\n      this.showWeightPopup = false;\n      uni.showToast({ title: '已记录体重', icon: 'none' });\n      this.reload();\n    },\n\n    // ====== 身高设置（用于 BMI）======\n    openHeightPopup() {\n      this.heightInput = this.heightCm ? String(this.heightCm) : '';\n      this.showHeightPopup = true;\n    },\n\n    onHeightCancel() {\n      this.showHeightPopup = false;\n    },\n\n    onHeightConfirm() {\n      const v = Number(String(this.heightInput || '').trim());\n      if (!v || v < 80 || v > 250) {\n        uni.showToast({ title: '请输入合理身高（80~250）', icon: 'none' });\n        return;\n      }\n\n      const store = loadStore();\n      store.profile = store.profile || {};\n      store.profile.heightCm = Math.round(v);\n      saveStore(store);\n\n      this.showHeightPopup = false;\n      uni.showToast({ title: '已保存身高', icon: 'none' });\n      this.reload();\n    }\n  }\n};\n</script>\n\n<style>\n@import './weight.css';\n</style>\n","import mod from \"-!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./weight.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./weight.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1768876148787\n      var cssReload = require(\"D:/Programming/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}