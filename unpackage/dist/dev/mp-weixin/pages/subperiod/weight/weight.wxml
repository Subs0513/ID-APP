<view class="page-wrap"><scroll-view class="page" scroll-y="{{true}}"><view class="hero-card"><view class="hero-row"><view class="hero-left"><text class="hero-k">今儿</text><text class="hero-v">{{todayKgText}}</text><text class="hero-unit">kg</text><view class="hero-sub"><text class="sub-item">{{"体重："+todayKgDetail}}</text><text class="sub-dot">·</text><text class="sub-item">{{"BMI："+bmiText}}</text></view><view class="hero-sub2"><text class="sub2-item">{{"身高："+heightText}}</text><text class="sub-dot">·</text><text class="sub2-item">{{"日期："+todayStr}}</text></view></view><view class="hero-right"><view data-event-opts="{{[['tap',[['openWeightForToday',['$event']]]]]}}" class="hero-btn primary" bindtap="__e"><text class="hero-btn-t">{{hasToday?'修改':'记录'}}</text></view><view data-event-opts="{{[['tap',[['openHeightPopup',['$event']]]]]}}" class="hero-btn ghost" bindtap="__e"><text class="hero-btn-t">身高</text></view></view></view><block wx:if="{{!hasToday}}"><view class="hero-tip"> 今天还没记录体重哦～点右侧「记录」即可 </view></block><block wx:if="{{bmiTagText}}"><view class="hero-bmi-tag"><text class="bmi-tag">{{bmiTagText}}</text></view></block></view><block wx:if="{{$root.g0}}"><view class="range-bar"><view data-event-opts="{{[['tap',[['setRange',['7']]]]]}}" class="{{['pill',(rangeKey==='7')?'on':'']}}" bindtap="__e">7天</view><view data-event-opts="{{[['tap',[['setRange',['30']]]]]}}" class="{{['pill',(rangeKey==='30')?'on':'']}}" bindtap="__e">30天</view><view data-event-opts="{{[['tap',[['setRange',['90']]]]]}}" class="{{['pill',(rangeKey==='90')?'on':'']}}" bindtap="__e">90天</view><view data-event-opts="{{[['tap',[['setRange',['all']]]]]}}" class="{{['pill',(rangeKey==='all')?'on':'']}}" bindtap="__e">全部</view></view></block><block wx:if="{{stats.count}}"><view class="card"><view class="card-title">概览</view><view class="metrics"><view class="metric"><text class="m-k">最新</text><text class="m-v">{{stats.latestText}}</text><text class="m-s">{{stats.latestDateText}}</text></view><view class="metric"><text class="m-k">{{"近"+rangeLabel+"变化"}}</text><text class="{{['m-v',(stats.delta>0)?'up':'',(stats.delta<0)?'down':'']}}">{{''+stats.deltaText+''}}</text><text class="m-s">{{"起点："+stats.firstText}}</text></view><view class="metric"><text class="m-k">均值</text><text class="m-v">{{stats.avgText}}</text><text class="m-s">{{"波动："+stats.stdText}}</text></view><view class="metric"><text class="m-k">范围</text><text class="m-v">{{stats.minText+" ~ "+stats.maxText}}</text><text class="m-s">{{"记录："+stats.count+"天"}}</text></view></view></view></block><block wx:if="{{!stats.count}}"><view class="card"><view class="card-title">还没有体重记录</view><view class="empty"><text class="empty-t">点上方「记录」开始吧～</text></view></view></block><block wx:if="{{stats.count}}"><view class="card"><view class="card-title">趋势</view><view class="sub">折线：每日体重（kg）｜虚线：7日均线</view><view class="chart-box"><qiun-data-charts vue-id="0a86f28e-1" type="mix" opts="{{optsTrend}}" chartData="{{chartTrend}}" canvas2d="{{true}}" canvasId="trendChart" inScrollView="{{true}}" bind:__l="__l"></qiun-data-charts></view></view></block><block wx:if="{{$root.g1}}"><view class="card"><view class="card-title">周均体重</view><view class="sub">按自然周聚合，更能看出长期趋势</view><view class="chart-box"><qiun-data-charts vue-id="0a86f28e-2" type="column" opts="{{optsWeek}}" chartData="{{chartWeek}}" canvas2d="{{true}}" canvasId="weekChart" inScrollView="{{true}}" bind:__l="__l"></qiun-data-charts></view></view></block><block wx:if="{{$root.g2}}"><view class="card"><view class="card-title">体重分布</view><view class="sub">自动根据你的数据生成区间</view><view class="chart-box"><qiun-data-charts vue-id="0a86f28e-3" type="ring" opts="{{optsDist}}" chartData="{{chartDist}}" canvas2d="{{true}}" canvasId="distChart" inScrollView="{{true}}" bind:__l="__l"></qiun-data-charts></view><view class="dist-legend"><block wx:for="{{distSeries}}" wx:for-item="it" wx:for-index="idx" wx:key="idx"><view class="dist-item"><text class="dist-name">{{it.name}}</text><text class="dist-val">{{it.value+"天"}}</text></view></block></view></view></block><view class="bottom-spacer"></view></scroll-view><block wx:if="{{showWeightPopup}}"><view><view data-event-opts="{{[['tap',[['onWeightCancel',['$event']]]],['touchmove',[['noop',['$event']]]]]}}" class="sheet-mask" bindtap="__e" catchtouchmove="__e"></view><view data-event-opts="{{[['tap',[['noop',['$event']]]],['touchmove',[['noop',['$event']]]]]}}" class="sheet" catchtap="__e" catchtouchmove="__e"><view class="sheet-header"><text data-event-opts="{{[['tap',[['onWeightCancel',['$event']]]]]}}" class="sheet-btn" bindtap="__e">取消</text><text class="sheet-title">体重</text><text data-event-opts="{{[['tap',[['onWeightConfirm',['$event']]]]]}}" class="sheet-btn sheet-btn-primary" bindtap="__e">确定</text></view><view class="sheet-value"><text class="value-num">{{weightDisplay}}</text><text class="value-unit">公斤</text></view><view class="sheet-keypad"><view class="key-row"><view class="key" data-k="1" data-event-opts="{{[['tap',[['onWeightKey',['$event']]]]]}}" bindtap="__e">1</view><view class="key" data-k="2" data-event-opts="{{[['tap',[['onWeightKey',['$event']]]]]}}" bindtap="__e">2</view><view class="key" data-k="3" data-event-opts="{{[['tap',[['onWeightKey',['$event']]]]]}}" bindtap="__e">3</view></view><view class="key-row"><view class="key" data-k="4" data-event-opts="{{[['tap',[['onWeightKey',['$event']]]]]}}" bindtap="__e">4</view><view class="key" data-k="5" data-event-opts="{{[['tap',[['onWeightKey',['$event']]]]]}}" bindtap="__e">5</view><view class="key" data-k="6" data-event-opts="{{[['tap',[['onWeightKey',['$event']]]]]}}" bindtap="__e">6</view></view><view class="key-row"><view class="key" data-k="7" data-event-opts="{{[['tap',[['onWeightKey',['$event']]]]]}}" bindtap="__e">7</view><view class="key" data-k="8" data-event-opts="{{[['tap',[['onWeightKey',['$event']]]]]}}" bindtap="__e">8</view><view class="key" data-k="9" data-event-opts="{{[['tap',[['onWeightKey',['$event']]]]]}}" bindtap="__e">9</view></view><view class="key-row"><view class="key" data-k="." data-event-opts="{{[['tap',[['onWeightKey',['$event']]]]]}}" bindtap="__e">.</view><view class="key" data-k="0" data-event-opts="{{[['tap',[['onWeightKey',['$event']]]]]}}" bindtap="__e">0</view><view data-event-opts="{{[['tap',[['onWeightDel',['$event']]]]]}}" class="key key-del" bindtap="__e"><text class="del-t">⌫</text></view></view><view class="sheet-hint">输入 0 可删除今天记录</view></view></view></view></block><block wx:if="{{showHeightPopup}}"><view><view data-event-opts="{{[['tap',[['onHeightCancel',['$event']]]],['touchmove',[['noop',['$event']]]]]}}" class="sheet-mask" bindtap="__e" catchtouchmove="__e"></view><view data-event-opts="{{[['tap',[['noop',['$event']]]],['touchmove',[['noop',['$event']]]]]}}" class="sheet" catchtap="__e" catchtouchmove="__e"><view class="sheet-header"><text data-event-opts="{{[['tap',[['onHeightCancel',['$event']]]]]}}" class="sheet-btn" bindtap="__e">取消</text><text class="sheet-title">身高</text><text data-event-opts="{{[['tap',[['onHeightConfirm',['$event']]]]]}}" class="sheet-btn sheet-btn-primary" bindtap="__e">确定</text></view><view class="height-box"><view class="height-row"><text class="height-k">身高</text><input class="height-input" type="number" placeholder="例如 170" maxlength="3" data-event-opts="{{[['input',[['__set_model',['','heightInput','$event',[]]]]]]}}" value="{{heightInput}}" bindinput="__e"/><text class="height-u">cm</text></view><view class="height-hint"> 用于计算 BMI（BMI = 体重 / 身高²） </view></view></view></view></block></view>