(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/subperiod/love/love"],{"141a":function(t,e,a){},2213:function(t,e,a){"use strict";(function(t){var r=a("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=r(a("af34")),i=r(a("3b2d")),o=r(a("7ca3")),s=r(a("34cf"));function c(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}var u={cycleLength:28,periodLength:5,lutealDays:14};function l(t){return(t<10?"0":"")+t}function f(t){return"".concat(t.getFullYear(),"-").concat(l(t.getMonth()+1),"-").concat(l(t.getDate()))}function h(t){if(!t)return null;var e=t.split("-").map(Number),a=(0,s.default)(e,3),r=a[0],n=a[1],i=a[2];return new Date(r,n-1,i)}function d(t,e){var a=h(t);return a?(a.setDate(a.getDate()+e),f(a)):""}function v(t,e){var a=h(t),r=h(e);return a&&r?Math.round((r-a)/864e5):0}function b(){return f(new Date)}function p(t){return t.settings=t.settings||function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?c(Object(a),!0).forEach((function(e){(0,o.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},u),t.periodRecords=Array.isArray(t.periodRecords)?t.periodRecords:[],t.sexRecords=t.sexRecords&&"object"===(0,i.default)(t.sexRecords)&&!Array.isArray(t.sexRecords)?t.sexRecords:{},t.periodRecords.sort((function(t,e){return(t.start||"").localeCompare(e.start||"")})),t}var g={data:function(){return{cycleText:"",prevCycleText:"",riskTips:[],riskHint:"",trendSubText:"",methodSubText:"",metrics:{totalThis:0,daysWith:0,avgText:"--",maxGapText:"--"},trendDates:[],trendLabels:[],trendValues:[],methodLegend:[],recentList:[],barTip:{show:!1,left:0,top:0,date:"",value:0},canvasW:1,barH:220,pieH:260}},onLoad:function(){this.refresh()},onShow:function(){this.refresh()},methods:{goAdd:function(){var e=b();t.navigateTo({url:"/pages/subperiod/addlove/addlove?date=".concat(encodeURIComponent(e))})},refresh:function(){var e=this,a=p(function(){return t.getStorageSync("period_record_v1")||{}}()),r=a.settings||u,n=a.periodRecords||[],i=n.length&&n[n.length-1].start||"",o=b(),s=0;if(n.length>=2){var c=n[n.length-2].start;s=v(c,i)}s||(s=r.cycleLength||u.cycleLength);var l=o,f=function(t,e,a){var r=e||0;if(!t)return"";var n=r?r-a:0;return!n||n<6||n>30?"":d(t,n)}(i,s,r.lutealDays||u.lutealDays),h=f?d(f,-5):"",g=f?d(f,1):"",m=this.collectSexEntries(a.sexRecords,i,l,h,g),y=m.entriesThis,T=m.totalThis,x=m.daysWith,w=m.unprotectedThis,M=m.fertileTimes,D=this.buildMetrics(i,l,y);D.totalThis=T,D.daysWith=x;var R=this.buildRiskTips({totalThis:T,unprotectedThis:w,fertileTimes:M,hasFertile:!!f,fertileRangeText:f?"".concat(h," ~ ").concat(g):""}),S=this.buildTrend30(a.sexRecords),_=this.buildMethodPie(y,T),P=y.slice().sort((function(t,e){return(e.date||"").localeCompare(t.date||"")})).slice(0,5).map((function(t){return{dateLabel:t.date,time:t.time,method:t.method}})),O=i?"本周期范围：".concat(i," ~ ").concat(l):"暂无经期记录：本页将以“近30天趋势”为主展示",k=f?"推算排卵期：".concat(h," ~ ").concat(g):"";this.setData({metrics:D,cycleText:O,prevCycleText:k,riskTips:R.tips,riskHint:R.hint,trendSubText:S.subText,methodSubText:_.subText,trendDates:S.dates,trendLabels:S.labels,trendValues:S.values,methodLegend:_.legend,recentList:P,barTip:{show:!1,left:0,top:0,date:"",value:0}}),this.$nextTick((function(){e.measureAndDrawBar(S.dates,S.labels,S.values),e.drawPie(_.slices)}))},inRange:function(t,e,a){return t&&e&&a&&t>=e&&t<=a},collectSexEntries:function(t,e,a,r,n){var i=this,o=/(无措施|不避孕|未避孕|不使用|没用|无\b)/,s=[],c=0,u=new Set,l=0,f=0;return Object.keys(t||{}).forEach((function(h){if(!e||!a||i.inRange(h,e,a)){var d=Array.isArray(t[h])?t[h]:[];d.length&&(c+=d.length,u.add(h),d.forEach((function(t){var e=t&&t.time?String(t.time):"--:--",a=t&&t.method?String(t.method).trim():"未记录措施";s.push({date:h,time:e,method:a}),o.test(a)&&(l+=1),r&&n&&i.inRange(h,r,n)&&(f+=1)})))}})),{entriesThis:s,totalThis:c,daysWith:u.size,unprotectedThis:l,fertileTimes:f}},buildMetrics:function(t,e,a){var r=t&&v(t,d(e,1))||0,n="--";if(r>0){var i=a.length/r*7;n="".concat(i.toFixed(1),"/周")}else n=a.length?"—":"--";var o="--",s=a.map((function(t){return t.date})).filter(Boolean),c=Array.from(new Set(s)).sort();if(c.length>=2){for(var u=0,l=1;l<c.length;l++){var f=v(c[l-1],c[l])-1;f>u&&(u=f)}o=0===u?"0天":"".concat(u,"天")}else 1===c.length&&(o="—");return{totalThis:0,daysWith:0,avgText:n,maxGapText:o}},buildRiskTips:function(t){var e=t.totalThis,a=t.unprotectedThis,r=t.fertileTimes,n=t.hasFertile,i=t.fertileRangeText,o=[];return 0===e?(o.push("本周期暂无爱爱记录：可以先记录一条，才会生成更准确的提示。"),{tips:o,hint:"温馨提示：风险提示仅用于自我管理，不替代专业医疗建议。"}):(a>0?o.push("存在 ".concat(a," 次“无措施/未避孕”情况：如不计划怀孕，建议使用更可靠的避孕方式。")):o.push("避孕方式记录较规范：继续保持～"),n?(o.push("推算排卵期：".concat(i,"。排卵期内记录次数：").concat(r," 次。")),r>0&&a>0&&o.push("若排卵期内存在未避孕情况，意外怀孕风险更高。")):o.push("排卵期数据不足：需要更多经期记录才能进行推算。"),e>=10&&o.push("本周期次数较多：注意休息、清洁与舒适度；如有不适及时就医。"),{tips:o,hint:"提示：排卵期为算法推算；如有备孕/避孕明确需求，建议结合更可靠方式或医生建议。"})},buildTrend30:function(t){for(var e=new Date,a=[],r=[],i=29;i>=0;i--){var o=new Date(e);o.setDate(o.getDate()-i);var s=f(o);a.push(s),r.push("".concat(o.getMonth()+1,"/").concat(o.getDate()))}var c=a.map((function(e){var a=Array.isArray((t||{})[e])?(t||{})[e]:[];return a.length})),u=c.reduce((function(t,e){return t+e}),0),l=Math.max.apply(Math,(0,n.default)(c).concat([0])),h=u?"近30天共记录 ".concat(u," 次 · 单日最高 ").concat(l," 次"):"近30天暂无记录";return{dates:a,labels:r,values:c,subText:h}},buildMethodPie:function(t,e){var a={};t.forEach((function(t){var e=function(t){var e=(t||"").trim();return e||"未记录措施"}(t.method);a[e]=(a[e]||0)+1}));var r=Object.keys(a).map((function(t){return{k:t,v:a[t]}}));r.sort((function(t,e){return e.v-t.v}));var n=r.slice(0,4),i=r.slice(4),o=i.reduce((function(t,e){return t+e.v}),0);o>0&&n.push({k:"其他",v:o});var s=["#ff6b9a","#ff9f6b","#6bc2ff","#8d6bff","#6bffb0"],c=n.map((function(t,e){return{label:t.k,value:t.v,color:s[e%s.length]}})),u=c.map((function(t){return{label:t.label,value:"".concat(t.value,"次"),color:t.color}})),l=e?"本周期共 ".concat(e," 次"):"本周期暂无记录";return this.setData({methodSubText:l}),{slices:c,legend:u,subText:l}},measureAndDrawBar:function(e,a,r){var n=this;t.createSelectorQuery().in(this).select("#barCanvas").boundingClientRect((function(t){if(t&&t.width&&t.height){n._barRect={left:t.left,top:t.top,width:t.width,height:t.height};var i=Math.max(1,Math.round(t.width)),o=Math.max(1,Math.round(t.height));n.setData({canvasW:i,barH:o}),n.$nextTick((function(){n.drawBar("barCanvas",i,o,e,a,r)}))}})).exec()},drawBar:function(e,a,r,i,o,s){var c=t.createCanvasContext(e,this),u=a-34-14,l=r-14-28;c.clearRect(0,0,a,r),c.setFillStyle("#ffffff"),c.fillRect(0,0,a,r);var f=Math.max.apply(Math,(0,n.default)(s).concat([0]))||1;c.setStrokeStyle("rgba(0,0,0,0.06)"),c.setLineWidth(1);for(var h=1;h<=3;h++){var d=14+l*h/3;c.beginPath(),c.moveTo(34,d),c.lineTo(34+u,d),c.stroke()}c.setFillStyle("rgba(0,0,0,0.45)"),c.setFontSize(10),c.fillText("最大 ".concat(f),8,24);var v=s.length,b=Math.max(2,Math.floor((u-2*(v-1))/v));this._barGeom={pL:34,pT:14,w:u,h:l,bw:b,gap:2,n:v},this._barDates=i,this._barValues=s,this._barMaxV=f;for(var p=0;p<v;p++){var g=s[p]||0,m=Math.round(g/f*l),y=34+p*(b+2),T=l-m+14;c.setFillStyle(g>0?"rgba(255,107,154,0.85)":"rgba(0,0,0,0.06)"),c.fillRect(y,T,b,m),p%5!==0&&p!==v-1||(c.setFillStyle("rgba(0,0,0,0.45)"),c.setFontSize(10),c.fillText(o[p],y-4,14+l+18))}c.draw()},getCanvasPoint:function(t){var e=this._barRect;if(!e)return null;var a=t&&t.touches&&t.touches[0]?t.touches[0]:null;if(!a)return null;if("number"===typeof a.x&&"number"===typeof a.y)return{x:a.x,y:a.y};var r="number"===typeof a.clientX?a.clientX:null,n="number"===typeof a.clientY?a.clientY:null;return null==r||null==n?null:{x:r-e.left,y:n-e.top}},onBarTouch:function(t){var e=this.getCanvasPoint(t);if(e&&this._barGeom){var a=e.x,r=e.y,n=this._barGeom,i=n.pL,o=n.pT,s=n.w,c=n.h,u=n.bw,l=n.gap,f=n.n;if(a<i||a>i+s||r<o||r>o+c)this.setData({barTip:{show:!1,left:0,top:0,date:"",value:0}});else{var h=Math.floor((a-i)/(u+l));if(!(h<0||h>=f)){var d=this._barDates&&this._barDates[h]?this._barDates[h]:"",v=this._barValues&&"number"===typeof this._barValues[h]?this._barValues[h]:0,b=i+h*(u+l)+u/2-46;b<6&&(b=6),b>this.canvasW-92&&(b=this.canvasW-92);var p=this._barMaxV||1,g=Math.round(v/p*c),m=o+(c-g),y=m-44;y<6&&(y=6),this.setData({barTip:{show:!0,left:Math.round(b),top:Math.round(y),date:d,value:v}})}}}},drawPieImpl:function(e,a,r,n){var i=t.createCanvasContext(e,this);i.clearRect(0,0,a,r),i.setFillStyle("#ffffff"),i.fillRect(0,0,a,r);var o=Math.round(a/2),s=Math.round(r/2)-6,c=.32*Math.min(a,r),u=.55*c,l=n.reduce((function(t,e){return t+(e.value||0)}),0)||1,f=-Math.PI/2;n.forEach((function(t){var e=t.value/l*Math.PI*2,a=f+e;i.beginPath(),i.moveTo(o,s),i.arc(o,s,c,f,a),i.closePath(),i.setFillStyle(t.color),i.fill(),f=a})),i.beginPath(),i.arc(o,s,u,0,2*Math.PI),i.setFillStyle("#ffffff"),i.fill(),i.draw()},drawPie:function(e){var a=this;t.createSelectorQuery().in(this).select("#pieCanvas").boundingClientRect((function(t){if(t&&t.width&&t.height){var r=Math.max(1,Math.round(t.width)),n=Math.max(1,Math.round(t.height));a.setData({canvasW:r,pieH:n}),a.$nextTick((function(){a.drawPieImpl("pieCanvas",r,n,e||[])}))}})).exec()}}};e.default=g}).call(this,a("df3c")["default"])},"43aa":function(t,e,a){"use strict";a.r(e);var r=a("2213"),n=a.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return r[t]}))}(i);e["default"]=n.a},7562:function(t,e,a){"use strict";a.d(e,"b",(function(){return r})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var r=function(){var t=this.$createElement,e=(this._self._c,this.recentList.length);this.$mp.data=Object.assign({},{$root:{g0:e}})},n=[]},aa6d:function(t,e,a){"use strict";a.r(e);var r=a("7562"),n=a("43aa");for(var i in n)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(i);a("e45f"),a("b7b4");var o=a("828b"),s=Object(o["a"])(n["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);e["default"]=s.exports},ad5e:function(t,e,a){"use strict";(function(t,e){var r=a("47a9");a("8ba4");r(a("3240"));var n=r(a("aa6d"));t.__webpack_require_UNI_MP_PLUGIN__=a,e(n.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},b7b4:function(t,e,a){"use strict";var r=a("141a"),n=a.n(r);n.a}},[["ad5e","common/runtime","common/vendor"]]]);