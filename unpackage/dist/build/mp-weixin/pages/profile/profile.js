(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/profile/profile"],{"0f7d":function(e,t,n){"use strict";(function(e){var a=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("7ca3"));function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s=n("5aad"),c="phone_auth_v1",l={cycleLength:28,periodLength:5,lutealDays:14};function h(t){var n=e.getStorageSync("period_record_v1")||{},a=n&&n.settings?n.settings:{};n.settings=i(i(i({},l),a),t),e.setStorageSync("period_record_v1",n)}var u={components:{YMDWheel:function(){n.e("components/YMD-Wheel/YMD-Wheel").then(function(){return resolve(n("91f6"))}.bind(null,n)).catch(n.oe)}},data:function(){return{defaultAvatar:"/assets/icons/default_avatar.png",coupleStartDate:"",userProfile:null,draftAvatarUrl:"",draftNickName:"",showSheet:!1,phone:"",code:"",countdown:0,timer:null,auth:null,isAuthed:!1,periodLength:l.periodLength,cycleLength:l.cycleLength,showWheel:!1,wheelType:"",wheelTitle:"",wheelOptions:[],wheelIndex:0,wheelDraftIndex:0,showDateWheel:!1}},computed:{displayName:function(){var e=this.userProfile;return e&&e.nickName?e.nickName:this.isAuthed?"已登录用户":"未登录"},displayAvatar:function(){var e=this.userProfile;return e&&e.avatarUrl?e.avatarUrl:this.defaultAvatar},maskedPhone:function(){return function(e){var t=String(e||"");return t.length<7?t:t.slice(0,3)+"****"+t.slice(-4)}(this.auth&&this.auth.phone)},sendDisabled:function(){return this.countdown>0||!this.isValidPhone(this.phone)},sendBtnText:function(){return this.countdown>0?"".concat(this.countdown,"s"):"发送"},loginDisabled:function(){return!this.isValidPhone(this.phone)||String(this.code||"").length<4}},onShow:function(){var t=s.getUserProfile?s.getUserProfile():null;this.setData({userProfile:t||null,draftAvatarUrl:t&&t.avatarUrl||"",draftNickName:t&&t.nickName||""});var n=s.getCoupleStartDate?s.getCoupleStartDate():"";this.setData({coupleStartDate:n||""});var a=e.getStorageSync(c)||null,o=!!(a&&a.phone&&a.token);this.setData({auth:a,isAuthed:o});var r=function(){var t=e.getStorageSync("period_record_v1"),n=t&&t.settings?t.settings:{};return{cycleLength:Number(n.cycleLength||l.cycleLength),periodLength:Number(n.periodLength||l.periodLength)}}();this.setData({periodLength:r.periodLength,cycleLength:r.cycleLength})},onHide:function(){this.clearTimer()},methods:{openCoupleDateWheel:function(){this.setData({showDateWheel:!0})},closeCoupleDateWheel:function(){this.setData({showDateWheel:!1})},onCoupleDateConfirm:function(t){s.setCoupleStartDate&&s.setCoupleStartDate(t),this.setData({coupleStartDate:t,showDateWheel:!1}),e.showToast({title:"已保存",icon:"success"})},openLoginSheet:function(){var e=this.userProfile||{};this.setData({showSheet:!0,draftAvatarUrl:e.avatarUrl||"",draftNickName:e.nickName||""})},closeLoginSheet:function(){this.setData({showSheet:!1})},noop:function(){},onPhoneInput:function(e){var t=e.detail&&e.detail.value||"";this.setData({phone:t.replace(/\s/g,"")})},onCodeInput:function(e){var t=e.detail&&e.detail.value||"";this.setData({code:t.replace(/\s/g,"")})},isValidPhone:function(e){var t=String(e||"").trim();return/^1\d{10}$/.test(t)},sendCode:function(){var t=this;this.sendDisabled||(e.showToast({title:"验证码已发送（演示）",icon:"none"}),this.setData({countdown:60}),this.clearTimer(),this.timer=setInterval((function(){var e=Math.max(0,(t.countdown||0)-1);t.setData({countdown:e}),e<=0&&t.clearTimer()}),1e3))},loginWithPhone:function(){if(!this.loginDisabled){var t="mock_"+Date.now(),n={phone:String(this.phone),token:t,at:Date.now()};e.setStorageSync(c,n),this.setData({auth:n,isAuthed:!0,showSheet:!1,code:""}),e.showToast({title:"登录成功",icon:"success"})}},logoutOnly:function(){e.removeStorageSync(c),this.setData({auth:null,isAuthed:!1,showSheet:!1}),e.showToast({title:"已退出",icon:"success"})},clearTimer:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onNickInput:function(e){var t=e.detail&&e.detail.value||"";this.setData({draftNickName:t})},pickAvatar:function(){var t=this;e.chooseImage({count:1,sizeType:["compressed"],success:function(e){var n=e.tempFilePaths&&e.tempFilePaths[0]||"";t.setData({draftAvatarUrl:n})}})},saveLocalProfile:function(){var t=String(this.draftNickName||"").trim();if(t){var n={nickName:t,avatarUrl:this.draftAvatarUrl||""};s.setUserProfile&&s.setUserProfile(n),this.setData({userProfile:n}),e.showToast({title:"已保存",icon:"success"}),this.closeLoginSheet()}else e.showToast({title:"请先填写昵称",icon:"none"})},openPeriodWheel:function(){for(var e=[],t=2;t<=20;t++)e.push(t);var n=Math.max(0,e.indexOf(Number(this.periodLength)));this.setData({showWheel:!0,wheelType:"period",wheelTitle:"经期长度",wheelOptions:e,wheelIndex:n,wheelDraftIndex:n})},openCycleWheel:function(){for(var e=[],t=16;t<=60;t++)e.push(t);var n=Math.max(0,e.indexOf(Number(this.cycleLength)));this.setData({showWheel:!0,wheelType:"cycle",wheelTitle:"周期长度",wheelOptions:e,wheelIndex:n,wheelDraftIndex:n})},closeWheel:function(){this.setData({showWheel:!1})},onWheelChange:function(e){var t=e&&e.detail&&e.detail.value?e.detail.value:[0],n=Number(t[0]||0);this.setData({wheelDraftIndex:n})},confirmWheel:function(){var t=Number(this.wheelDraftIndex||0),n=this.wheelOptions[t];"period"===this.wheelType?(h({periodLength:Number(n)}),this.setData({periodLength:Number(n)})):"cycle"===this.wheelType&&(h({cycleLength:Number(n)}),this.setData({cycleLength:Number(n)})),this.setData({showWheel:!1}),e.showToast({title:"已保存",icon:"success"})},confirmClear:function(){var t=this;e.showModal({title:"确认清空？",content:"将删除本机所有缓存数据（包括重要日子、经期记录等），不可恢复。",confirmText:"清空",confirmColor:"#e5484d",success:function(n){if(n.confirm){try{e.clearStorageSync()}catch(a){try{e.removeStorageSync(c),e.removeStorageSync("period_record_v1")}catch(o){}}t.setData({userProfile:null,draftAvatarUrl:"",draftNickName:"",auth:null,isAuthed:!1,phone:"",code:"",coupleStartDate:"",showSheet:!1,showWheel:!1,showDateWheel:!1}),e.showToast({title:"已清空",icon:"success"}),e.switchTab({url:"/pages/home/home"})}}})},goAbout:function(){e.navigateTo({url:"/pages/about/about"})},onShare:function(){}}};t.default=u}).call(this,n("df3c")["default"])},"299f":function(e,t,n){"use strict";(function(e,t){var a=n("47a9");n("8ba4");a(n("3240"));var o=a(n("f01a"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"2ba9":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var a=function(){var e=this.$createElement;this._self._c},o=[]},"313f":function(e,t,n){"use strict";n.r(t);var a=n("0f7d"),o=n.n(a);for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=o.a},a7a5:function(e,t,n){},f01a:function(e,t,n){"use strict";n.r(t);var a=n("2ba9"),o=n("313f");for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);n("fe78");var i=n("828b"),s=Object(i["a"])(o["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);t["default"]=s.exports},fe78:function(e,t,n){"use strict";var a=n("a7a5"),o=n.n(a);o.a}},[["299f","common/runtime","common/vendor"]]]);