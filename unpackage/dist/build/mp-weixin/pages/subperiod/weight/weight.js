(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/subperiod/weight/weight"],{"233c":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){}));var n=function(){var t=this.$createElement,e=(this._self._c,this.pointsAll.length),i=this.weekAgg.categories.length,n=this.distSeries.length;this.$mp.data=Object.assign({},{$root:{g0:e,g1:i,g2:n}})},a=[]},"24a9":function(t,e,i){},"37da":function(t,e,i){"use strict";i.r(e);var n=i("233c"),a=i("978a");for(var r in a)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(r);i("4f3e");var o=i("828b"),s=Object(o["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=s.exports},"39c4":function(t,e,i){"use strict";(function(t){var n=i("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=n(i("3b2d")),r=n(i("34cf"));function o(t){return(t<10?"0":"")+t}function s(t){return"".concat(t.getFullYear(),"-").concat(o(t.getMonth()+1),"-").concat(o(t.getDate()))}function h(t){var e=t.split("-").map(Number),i=(0,r.default)(e,3),n=i[0],a=i[1],o=i[2];return new Date(n,a-1,o)}function u(){var e=t.getStorageSync("period_record_v1");return e&&"object"===(0,a.default)(e)?e:{weightRecords:{},profile:{}}}function c(e){t.setStorageSync("period_record_v1",e)}function l(t){return Math.round(100*t)/100}function g(t){return t.length?t.reduce((function(t,e){return t+e}),0)/t.length:0}var d={data:function(){return{rangeKey:"30",todayStr:s(new Date),todayKg:null,heightCm:null,stats:{count:0,delta:0,latestText:"--",latestDateText:"--",firstText:"--",avgText:"--",stdText:"--",minText:"--",maxText:"--",deltaText:"--"},pointsAll:[],points:[],chartTrend:{},chartWeek:{},chartDist:{},weekAgg:{categories:[],values:[]},distSeries:[],optsTrend:{padding:[12,10,8,6],legend:{show:!0,position:"top"},xAxis:{disableGrid:!0,labelCount:5,scrollShow:!1},yAxis:{gridType:"dash",dashLength:4},extra:{mix:{line:{type:"curve",width:2}}}},optsWeek:{padding:[12,10,8,6],legend:{show:!1},xAxis:{disableGrid:!0,labelCount:6},yAxis:{gridType:"dash",dashLength:4},extra:{column:{width:14}}},optsDist:{padding:[12,10,8,6],legend:{show:!1},extra:{ring:{ringWidth:16,centerColor:"#ffffff"}}},showWeightPopup:!1,weightInput:"",weightDisplay:"0",showHeightPopup:!1,heightInput:""}},computed:{rangeLabel:function(){return"7"===this.rangeKey?"7天":"30"===this.rangeKey?"30天":"90"===this.rangeKey?"90天":"全部"},hasToday:function(){return"number"===typeof this.todayKg&&this.todayKg>0},todayKgText:function(){return this.hasToday?this.todayKg.toFixed(2):"--"},todayKgDetail:function(){return this.hasToday?"".concat(this.todayKg.toFixed(2)," kg"):"--"},heightText:function(){return this.heightCm?"".concat(this.heightCm," cm"):"未设置"},bmiValue:function(){if(!this.hasToday)return null;if(!this.heightCm||this.heightCm<=0)return null;var t=this.heightCm/100;return l(this.todayKg/(t*t))},bmiText:function(){return this.hasToday?this.heightCm?null==this.bmiValue?"--":this.bmiValue.toFixed(1):"未设置身高":"--"},bmiTagText:function(){var t=this.bmiValue;return null==t?"":t<18.5?"偏瘦":t<24?"正常":t<28?"超重":"肥胖"}},onShow:function(){this.reload()},methods:{noop:function(){},setRange:function(t){this.rangeKey=t,this.recompute()},reload:function(){var t=u();t.weightRecords=t.weightRecords||{},t.profile=t.profile||{};var e=Number(t.profile.heightCm||0);this.heightCm=e>0?e:null;var i=this.todayStr,n=t.weightRecords[i],a=n&&"number"===typeof n.kg?n.kg:0;this.todayKg=a>0?a:null;var r=Object.keys(t.weightRecords).map((function(e){var i=t.weightRecords[e],n=i&&"number"===typeof i.kg?i.kg:null;return null==n||n<=0?null:{dateStr:e,kg:Number(n)}})).filter(Boolean).sort((function(t,e){return h(t.dateStr)-h(e.dateStr)}));this.pointsAll=r,this.recompute()},recompute:function(){var t=this.pointsAll.slice();if(!t.length)return this.points=[],void this.fillEmpty();var e=t;if("all"!==this.rangeKey){var i=Number(this.rangeKey),n=h(t[t.length-1].dateStr),a=new Date(n.getTime());a.setDate(a.getDate()-(i-1)),e=t.filter((function(t){return h(t.dateStr)>=a}))}this.points=e,this.buildStats(),this.buildTrendChart(),this.buildWeekAgg(),this.buildDist()},fillEmpty:function(){this.stats={count:0,delta:0,latestText:"--",latestDateText:"--",firstText:"--",avgText:"--",stdText:"--",minText:"--",maxText:"--",deltaText:"--"},this.chartTrend={},this.chartWeek={},this.chartDist={},this.weekAgg={categories:[],values:[]},this.distSeries=[]},buildStats:function(){var t=this.points,e=t.length,i=t[0],n=t[t.length-1],a=t.map((function(t){return t.kg})),r=g(a),o=function(t){if(t.length<=1)return 0;var e=g(t),i=g(t.map((function(t){return(t-e)*(t-e)})));return Math.sqrt(i)}(a),s=Math.min.apply(null,a),h=Math.max.apply(null,a),u=l(n.kg-i.kg);this.stats={count:e,delta:u,latestText:"".concat(n.kg.toFixed(2)," kg"),latestDateText:n.dateStr,firstText:"".concat(i.kg.toFixed(2)," kg"),avgText:"".concat(r.toFixed(2)," kg"),stdText:"".concat(o.toFixed(2)," kg"),minText:"".concat(s.toFixed(2)," kg"),maxText:"".concat(h.toFixed(2)," kg"),deltaText:"".concat(u>0?"+":"").concat(u.toFixed(2)," kg")}},buildTrendChart:function(){var t=this.points,e=t.map((function(t){return t.dateStr.slice(5)})),i=t.map((function(t){return l(t.kg)})),n=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,i=[],n=0;n<t.length;n++){var a=Math.max(0,n-e+1),r=t.slice(a,n+1);i.push(l(g(r)))}return i}(i,7);this.chartTrend={categories:e,series:[{name:"体重",type:"line",data:i},{name:"7日均线",type:"line",data:n}]}},buildWeekAgg:function(){var t=this.points,e={};t.forEach((function(t){var i=function(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),i=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-i);var n=new Date(Date.UTC(e.getUTCFullYear(),0,1)),a=Math.ceil(((e-n)/864e5+1)/7),r=e.getUTCFullYear();return"".concat(r,"-W").concat(o(a))}(h(t.dateStr));e[i]=e[i]||[],e[i].push(t.kg)}));var i=Object.keys(e).sort(),n=i.map((function(t){return t.replace("-W","W")})),a=i.map((function(t){return l(g(e[t]))}));this.weekAgg={categories:n,values:a},this.chartWeek={categories:n,series:[{name:"周均(kg)",data:a}]}},buildDist:function(){var t=this.points,e=t.map((function(t){return t.kg})).sort((function(t,e){return t-e}));if(!e.length)return this.distSeries=[],void(this.chartDist={});for(var i=e[0],n=e[e.length-1],a=Math.max(.01,n-i),r=a/5,o=[],s=0;s<5;s++){var h=i+r*s,u=4===s?n:i+r*(s+1);o.push({a:h,b:u,c:0})}e.forEach((function(t){for(var e=0;e<o.length;e++){var i=o[e],n=e===o.length-1;if(t>=i.a&&t<i.b||n&&t<=i.b){i.c++;break}}}));var c=o.filter((function(t){return t.c>0})).map((function(t){return{name:"".concat(t.a.toFixed(1),"~").concat(t.b.toFixed(1),"kg"),value:t.c}}));this.distSeries=c,this.chartDist={series:c}},openWeightForToday:function(){var t=u();t.weightRecords=t.weightRecords||{};var e=t.weightRecords[this.todayStr],i=e&&"number"===typeof e.kg?e.kg:0,n="";i>0&&(n=i.toFixed(2)),this.showWeightPopup=!0,this.weightInput=n,this.weightDisplay=n||"0"},onWeightCancel:function(){this.showWeightPopup=!1},onWeightKey:function(t){var e=t.currentTarget.dataset.k,i=this.weightInput||"";if("."===e){if(i.includes("."))return;""===i&&(i="0"),i+="."}else"0"===i?i=e:i+=e;var n=i.match(/^(\d{0,3})(?:\.(\d{0,2}))?/);if(n){var a=n[1]||"",r=i.includes(".")?".":"",o=(i.split(".")[1]||"").slice(0,2);i=a+(r?r+o:"")}this.weightInput=i,this.weightDisplay=""===i?"0":i},onWeightDel:function(){var t=this.weightInput||"";t?(t=t.slice(0,-1),this.weightInput=t,this.weightDisplay=""===t?"0":t):this.weightDisplay="0"},onWeightConfirm:function(){var e=(this.weightInput||"").trim();""===e&&(e=(this.weightDisplay||"").trim()),""===e&&(e="0");var i=parseFloat(e);if(isNaN(i)||i<0)t.showToast({title:"请输入有效体重",icon:"none"});else{var n=u();if(n.weightRecords=n.weightRecords||{},n.profile=n.profile||{},0===i)return n.weightRecords[this.todayStr]?(delete n.weightRecords[this.todayStr],c(n),t.showToast({title:"已删除今天体重",icon:"none"})):t.showToast({title:"今天未记录体重",icon:"none"}),this.showWeightPopup=!1,void this.reload();n.weightRecords[this.todayStr]={kg:Number(i.toFixed(2))},c(n),this.showWeightPopup=!1,t.showToast({title:"已记录体重",icon:"none"}),this.reload()}},openHeightPopup:function(){this.heightInput=this.heightCm?String(this.heightCm):"",this.showHeightPopup=!0},onHeightCancel:function(){this.showHeightPopup=!1},onHeightConfirm:function(){var e=Number(String(this.heightInput||"").trim());if(!e||e<80||e>250)t.showToast({title:"请输入合理身高（80~250）",icon:"none"});else{var i=u();i.profile=i.profile||{},i.profile.heightCm=Math.round(e),c(i),this.showHeightPopup=!1,t.showToast({title:"已保存身高",icon:"none"}),this.reload()}}}};e.default=d}).call(this,i("df3c")["default"])},"47ed":function(t,e,i){"use strict";(function(t,e){var n=i("47a9");i("8ba4");n(i("3240"));var a=n(i("37da"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(a.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"4f3e":function(t,e,i){"use strict";var n=i("24a9"),a=i.n(n);a.a},"978a":function(t,e,i){"use strict";i.r(e);var n=i("39c4"),a=i.n(n);for(var r in n)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(r);e["default"]=a.a}},[["47ed","common/runtime","common/vendor"]]]);