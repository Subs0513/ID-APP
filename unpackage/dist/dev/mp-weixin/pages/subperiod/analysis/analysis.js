(global["webpackJsonp"] = global["webpackJsonp"] || []).push([["pages/subperiod/analysis/analysis"],{

/***/ 143:
/*!************************************************************************************************************!*\
  !*** D:/PrivateFiles/HBuilderProjects/ID-Local/main.js?{"page":"pages%2Fsubperiod%2Fanalysis%2Fanalysis"} ***!
  \************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(wx, createPage) {

var _interopRequireDefault = __webpack_require__(/*! @babel/runtime/helpers/interopRequireDefault */ 4);
__webpack_require__(/*! uni-pages */ 26);
var _vue = _interopRequireDefault(__webpack_require__(/*! vue */ 25));
var _analysis = _interopRequireDefault(__webpack_require__(/*! ./pages/subperiod/analysis/analysis.vue */ 144));
// @ts-ignore
wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;
createPage(_analysis.default);
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/wx.js */ 1)["default"], __webpack_require__(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */ 2)["createPage"]))

/***/ }),

/***/ 144:
/*!***************************************************************************************!*\
  !*** D:/PrivateFiles/HBuilderProjects/ID-Local/pages/subperiod/analysis/analysis.vue ***!
  \***************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _analysis_vue_vue_type_template_id_e8232890___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./analysis.vue?vue&type=template&id=e8232890& */ 145);
/* harmony import */ var _analysis_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./analysis.vue?vue&type=script&lang=js& */ 147);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _analysis_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__) if(["default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _analysis_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__[key]; }) }(__WEBPACK_IMPORT_KEY__));
/* harmony import */ var _analysis_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./analysis.vue?vue&type=style&index=0&lang=css& */ 149);
/* harmony import */ var _Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js */ 32);

var renderjs





/* normalize component */

var component = Object(_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__["default"])(
  _analysis_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__["default"],
  _analysis_vue_vue_type_template_id_e8232890___WEBPACK_IMPORTED_MODULE_0__["render"],
  _analysis_vue_vue_type_template_id_e8232890___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null,
  false,
  _analysis_vue_vue_type_template_id_e8232890___WEBPACK_IMPORTED_MODULE_0__["components"],
  renderjs
)

component.options.__file = "pages/subperiod/analysis/analysis.vue"
/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ 145:
/*!**********************************************************************************************************************!*\
  !*** D:/PrivateFiles/HBuilderProjects/ID-Local/pages/subperiod/analysis/analysis.vue?vue&type=template&id=e8232890& ***!
  \**********************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_template_id_e8232890___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--17-0!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./analysis.vue?vue&type=template&id=e8232890& */ 146);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_template_id_e8232890___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_template_id_e8232890___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "recyclableRender", function() { return _Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_template_id_e8232890___WEBPACK_IMPORTED_MODULE_0__["recyclableRender"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "components", function() { return _Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_uni_app_loader_page_meta_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_template_id_e8232890___WEBPACK_IMPORTED_MODULE_0__["components"]; });



/***/ }),

/***/ 146:
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--17-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!D:/PrivateFiles/HBuilderProjects/ID-Local/pages/subperiod/analysis/analysis.vue?vue&type=template&id=e8232890& ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "recyclableRender", function() { return recyclableRender; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "components", function() { return components; });
var components
var render = function () {
  var _vm = this
  var _h = _vm.$createElement
  var _c = _vm._self._c || _h
}
var recyclableRender = false
var staticRenderFns = []
render._withStripped = true



/***/ }),

/***/ 147:
/*!****************************************************************************************************************!*\
  !*** D:/PrivateFiles/HBuilderProjects/ID-Local/pages/subperiod/analysis/analysis.vue?vue&type=script&lang=js& ***!
  \****************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Programming_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--13-1!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./analysis.vue?vue&type=script&lang=js& */ 148);
/* harmony import */ var _Programming_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_Programming_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _Programming_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__) if(["default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _Programming_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_Programming_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_13_1_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ 148:
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--13-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!D:/PrivateFiles/HBuilderProjects/ID-Local/pages/subperiod/analysis/analysis.vue?vue&type=script&lang=js& ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(uni) {

var _interopRequireDefault = __webpack_require__(/*! @babel/runtime/helpers/interopRequireDefault */ 4);
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _toConsumableArray2 = _interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/toConsumableArray */ 18));
var _defineProperty2 = _interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/defineProperty */ 11));
var _typeof2 = _interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/typeof */ 13));
var _slicedToArray2 = _interopRequireDefault(__webpack_require__(/*! @babel/runtime/helpers/slicedToArray */ 5));
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//

var STORE_KEY = 'period_record_v1';
var DEFAULTS = {
  cycleLength: 28,
  periodLength: 5,
  lutealDays: 14
};
function pad2(n) {
  return (n < 10 ? '0' : '') + n;
}
function toDateStr(d) {
  return "".concat(d.getFullYear(), "-").concat(pad2(d.getMonth() + 1), "-").concat(pad2(d.getDate()));
}
function parseDateStr(s) {
  if (!s) return null;
  var _s$split$map = s.split('-').map(Number),
    _s$split$map2 = (0, _slicedToArray2.default)(_s$split$map, 3),
    y = _s$split$map2[0],
    m = _s$split$map2[1],
    d = _s$split$map2[2];
  return new Date(y, m - 1, d);
}
function diffDays(aStr, bStr) {
  var a = parseDateStr(aStr);
  var b = parseDateStr(bStr);
  if (!a || !b) return 0;
  return Math.round((b - a) / 86400000);
}
function clamp(n, min, max) {
  return Math.max(min, Math.min(max, n));
}
function fmt2(x) {
  return typeof x === 'number' && !Number.isNaN(x) ? x.toFixed(2) : '';
}
function loadStore() {
  var v = uni.getStorageSync(STORE_KEY);
  return v && (0, _typeof2.default)(v) === 'object' ? v : {};
}
function normalizeStore(store) {
  store.settings = store.settings || _objectSpread({}, DEFAULTS);
  store.periodRecords = Array.isArray(store.periodRecords) ? store.periodRecords : [];
  store.periodStarts = Array.isArray(store.periodStarts) ? store.periodStarts : [];
  store.painRecords = store.painRecords && (0, _typeof2.default)(store.painRecords) === 'object' && !Array.isArray(store.painRecords) ? store.painRecords : {};
  store.sexRecords = store.sexRecords && (0, _typeof2.default)(store.sexRecords) === 'object' && !Array.isArray(store.sexRecords) ? store.sexRecords : {};
  store.sexDates = Array.isArray(store.sexDates) ? store.sexDates : [];

  // weightRecords：兼容 Map / Array => [{date, weight}]
  store.weightRecords = store.weightRecords || [];
  if (!Array.isArray(store.weightRecords) && (0, _typeof2.default)(store.weightRecords) === 'object') {
    var obj = store.weightRecords;
    store.weightRecords = Object.keys(obj).sort().map(function (date) {
      var v = obj[date] || {};
      var w = typeof v.weight === 'number' ? v.weight : typeof v.kg === 'number' ? v.kg : NaN;
      return {
        date: date,
        weight: w
      };
    }).filter(function (x) {
      return x.date;
    });
  }
  if (Array.isArray(store.weightRecords)) {
    store.weightRecords = store.weightRecords.map(function (r) {
      if (!r) return null;
      var date = r.date || r.day || r.dateStr;
      var w = typeof r.weight === 'number' ? r.weight : typeof r.kg === 'number' ? r.kg : NaN;
      return {
        date: date,
        weight: w
      };
    }).filter(function (x) {
      return x && x.date;
    });
    store.weightRecords.sort(function (a, b) {
      return (a.date || '').localeCompare(b.date || '');
    });
  }
  if (store.periodRecords.length === 0 && store.periodStarts.length > 0) {
    var starts = (0, _toConsumableArray2.default)(store.periodStarts).sort();
    store.periodRecords = starts.map(function (s) {
      return {
        start: s,
        end: s
      };
    });
  }
  store.periodRecords.sort(function (a, b) {
    return (a.start || '').localeCompare(b.start || '');
  });
  return store;
}
function getRecentRecords(recordsAsc, n) {
  var arr = Array.isArray(recordsAsc) ? recordsAsc : [];
  return arr.length <= n ? arr.slice() : arr.slice(arr.length - n);
}
function formatMonthDayCN(dateStr) {
  var d = parseDateStr(dateStr);
  if (!d) return '';
  return "".concat(d.getMonth() + 1, "\u6708").concat(d.getDate(), "\u65E5");
}
function getTodayStr() {
  return toDateStr(new Date());
}
function addDaysStr(dateStr, days) {
  var d = parseDateStr(dateStr);
  if (!d) return '';
  d.setDate(d.getDate() + days);
  return toDateStr(d);
}
function formatRangeCN(a, b) {
  return a && b ? "".concat(a, " ~ ").concat(b) : '';
}
function buildCycleChangeCard(recordsAsc, settings) {
  var expected = settings && settings.cycleLength ? settings.cycleLength : DEFAULTS.cycleLength;
  var startsAsc = (recordsAsc || []).map(function (r) {
    return r.start;
  }).filter(Boolean).sort();
  if (startsAsc.length < 1) return null;
  var todayStr = getTodayStr();
  var currentStart = startsAsc[startsAsc.length - 1];
  var currentLen = diffDays(currentStart, todayStr) + 1;
  var lastStart = '',
    lastEnd = '',
    lastLen = 0,
    prevLen = 0;
  if (startsAsc.length >= 2) {
    lastStart = startsAsc[startsAsc.length - 2];
    var nextStart = startsAsc[startsAsc.length - 1];
    lastLen = diffDays(lastStart, nextStart);
    var endD = parseDateStr(nextStart);
    endD.setDate(endD.getDate() - 1);
    lastEnd = toDateStr(endD);
  }
  if (startsAsc.length >= 3) {
    var prevStart = startsAsc[startsAsc.length - 3];
    var prevNext = startsAsc[startsAsc.length - 2];
    prevLen = diffDays(prevStart, prevNext);
  }
  var normalTag = lastLen >= 21 && lastLen <= 35 ? '正常' : '偏离';
  var deltaText = '—';
  if (lastLen && prevLen) {
    var delta = lastLen - prevLen;
    deltaText = delta === 0 ? '持平' : delta > 0 ? "\u591A ".concat(delta, " \u5929") : "\u5C11 ".concat(Math.abs(delta), " \u5929");
  }
  var items = [];
  var currentDelta = currentLen - expected;
  items.push({
    dateLabel: formatMonthDayCN(currentStart),
    status: currentDelta <= 0 ? '准时' : "\u63A8\u8FDF".concat(currentDelta, "\u5929"),
    lenText: "\u4ECA\u5929\u4E3A\u5F53\u524D\u5468\u671F".concat(currentLen, "\u5929"),
    len: currentLen,
    isCurrent: true
  });
  var added = 0;
  for (var i = startsAsc.length - 1; i >= 1 && added < 2; i--) {
    var start = startsAsc[i - 1];
    var next = startsAsc[i];
    var len = diffDays(start, next);
    if (len <= 0) continue;
    var _delta = len - expected;
    var status = '准时';
    if (_delta > 0) status = "\u63A8\u8FDF".concat(_delta, "\u5929");else if (_delta < 0) status = "\u63D0\u524D".concat(Math.abs(_delta), "\u5929");
    items.push({
      dateLabel: formatMonthDayCN(start),
      status: status,
      lenText: "".concat(len, "\u5929"),
      len: len,
      isCurrent: false
    });
    added++;
  }

  /**
   * 条形图标尺上限固定为「用户设定周期 + 22」
   * 例如：设定 28 天 => 右侧上限 50 天
   */
  var fixedMaxLen = Math.max(1, expected + 22);
  items.forEach(function (it) {
    var rawPct = it.len / fixedMaxLen * 100;
    var pct = Math.round(rawPct);
    it.barPct = clamp(pct, 18, 100); // ✅ 最小可见宽度 + 最大不超出
    it.barStyle = "width: ".concat(it.barPct, "%;");
  });
  var rangeText = lastStart && lastEnd ? "\u6700\u8FD1 1 \u4E2A\u5468\u671F\uFF08".concat(lastStart, " - ").concat(lastEnd, "\uFF09") : '最近 1 个周期（数据不足）';
  return {
    rangeText: rangeText,
    lastLenText: lastLen ? "".concat(lastLen, "\u5929") : '—',
    normalTag: normalTag,
    deltaText: deltaText,
    items: items
  };
}
function analyzeStability(recordsAsc) {
  var recent = getRecentRecords(recordsAsc, 4);
  if (recent.length < 4) return {
    stdev: null,
    text: '数据不足（经期记录少于4次）'
  };
  var lens = [];
  for (var i = 1; i < recent.length; i++) {
    lens.push(diffDays(recent[i - 1].start, recent[i].start));
  }
  var mean = lens.reduce(function (a, b) {
    return a + b;
  }, 0) / lens.length;
  var var0 = lens.reduce(function (a, b) {
    return a + (b - mean) * (b - mean);
  }, 0) / lens.length;
  var stdev = Math.sqrt(var0);
  var text = '波动较大';
  if (stdev <= 3) text = '较稳定';else if (stdev <= 6) text = '略有波动';
  return {
    stdev: stdev,
    text: text
  };
}
function getLatestPeriodWindow(recentRecord, settings) {
  var start = recentRecord.start;
  var end = recentRecord.end;
  if (!end || end === start) {
    var len = settings && settings.periodLength ? settings.periodLength : DEFAULTS.periodLength;
    end = addDaysStr(start, Math.max(0, len - 1));
  }
  return {
    start: start,
    end: end
  };
}
function predictNext(recentStart, recentCycleLen, settings) {
  var cycleLength = settings && settings.cycleLength ? settings.cycleLength : DEFAULTS.cycleLength;
  var lutealDays = settings && settings.lutealDays ? settings.lutealDays : DEFAULTS.lutealDays;
  var usedCycle = recentCycleLen > 0 ? recentCycleLen : cycleLength;
  var nextStart = addDaysStr(recentStart, usedCycle);
  var ovulationDay = addDaysStr(nextStart, -lutealDays);
  var fertileStart = addDaysStr(ovulationDay, -5);
  var fertileEnd = addDaysStr(ovulationDay, 1);
  // return { nextStart, ovulationDay, fertileRangeText: formatRangeCN(fertileStart, fertileEnd) };
  return {
    nextStart: nextStart,
    ovulationDay: ovulationDay,
    fertileStart: fertileStart,
    fertileEnd: fertileEnd,
    fertileRangeText: formatRangeCN(fertileStart, fertileEnd)
  };
}

// 痛经记录
function inRangeDateStr(ds, start, end) {
  if (!ds || !start || !end) return false;
  return ds >= start && ds <= end; // YYYY-MM-DD 字符串可直接比较
}

function buildPainTexts(painRecords, cycleStart, cycleEnd) {
  var pr = painRecords && (0, _typeof2.default)(painRecords) === 'object' ? painRecords : {};
  var levelOrder = ['轻微', '一般', '严重', '非常严重'];
  var levelRank = {};
  levelOrder.forEach(function (lv, i) {
    return levelRank[lv] = i;
  });
  var entries = [];
  Object.keys(pr).forEach(function (ds) {
    if (!inRangeDateStr(ds, cycleStart, cycleEnd)) return;
    var list = Array.isArray(pr[ds]) ? pr[ds] : [];
    list.forEach(function (it) {
      return entries.push(_objectSpread(_objectSpread({}, it), {}, {
        _date: ds
      }));
    });
  });
  var total = entries.length;
  if (!total) {
    return {
      painSummaryText: '本周期未记录痛经',
      painLevelText: '',
      painPeakText: ''
    };
  }

  // 统计程度
  var counts = {};
  var peakLv = '';
  var peakRank = -1;
  entries.forEach(function (it) {
    var lv = it && it.level ? it.level : '未选择程度';
    counts[lv] = (counts[lv] || 0) + 1;
    var r = lv in levelRank ? levelRank[lv] : -1;
    if (r > peakRank) {
      peakRank = r;
      peakLv = lv;
    }
  });

  // 最常见程度
  var commonLv = '';
  var commonCnt = 0;
  Object.keys(counts).forEach(function (lv) {
    if (counts[lv] > commonCnt) {
      commonCnt = counts[lv];
      commonLv = lv;
    }
  });

  // 分布文案（只展示有数据的项）
  var distParts = levelOrder.filter(function (lv) {
    return counts[lv];
  }).map(function (lv) {
    return "".concat(lv).concat(counts[lv], "\u6B21");
  });
  if (counts['未选择程度']) distParts.push("\u672A\u9009\u62E9".concat(counts['未选择程度'], "\u6B21"));
  return {
    painSummaryText: "\u672C\u5468\u671F\u8BB0\u5F55\u75DB\u7ECF ".concat(total, " \u6B21\uFF08").concat(cycleStart, " ~ ").concat(cycleEnd, "\uFF09"),
    painLevelText: distParts.length ? "\u7A0B\u5EA6\u5206\u5E03\uFF1A".concat(distParts.join('，')) : '',
    painPeakText: peakLv ? "\u6700\u4E25\u91CD\u7A0B\u5EA6\uFF1A".concat(peakLv, "\uFF1B\u6700\u5E38\u89C1\uFF1A").concat(commonLv) : ''
  };
}

// 爱爱记录
function buildSexTexts(store, rangeStart, rangeEnd, ovulationDay) {
  var sexRecords = store.sexRecords || {};
  var sexDates = Array.isArray(store.sexDates) ? store.sexDates : [];
  function inRange(ds, a, b) {
    return ds && a && b && ds >= a && ds <= b;
  }
  var unprotectedRe = /(无|不避孕|未避孕|不使用|没用)/;
  var total = 0;
  var withMethod = 0;
  var unprotected = 0;

  // 1) 详细记录
  Object.keys(sexRecords).forEach(function (ds) {
    if (!inRange(ds, rangeStart, rangeEnd)) return;
    var list = Array.isArray(sexRecords[ds]) ? sexRecords[ds] : [];
    total += list.length;
    list.forEach(function (it) {
      var m = it && it.method ? String(it.method).trim() : '';
      if (m) withMethod += 1;
      if (!m || unprotectedRe.test(m)) unprotected += 1;
    });
  });

  // 2) 兜底：只有小心心日期但没详细条目时，当天按 1 次
  sexDates.forEach(function (ds) {
    if (!inRange(ds, rangeStart, rangeEnd)) return;
    var list = Array.isArray(sexRecords[ds]) ? sexRecords[ds] : [];
    if (!list.length) total += 1;
  });

  // 3) 排卵期统计（-5 ~ +1）
  var fertile = 0;
  if (ovulationDay) {
    var fs = addDaysStr(ovulationDay, -5);
    var fe = addDaysStr(ovulationDay, 1);
    Object.keys(sexRecords).forEach(function (ds) {
      if (!inRange(ds, fs, fe)) return;
      var list = Array.isArray(sexRecords[ds]) ? sexRecords[ds] : [];
      fertile += list.length;
    });
    sexDates.forEach(function (ds) {
      if (!inRange(ds, fs, fe)) return;
      var list = Array.isArray(sexRecords[ds]) ? sexRecords[ds] : [];
      if (!list.length) fertile += 1;
    });
  }
  var missMethod = Math.max(0, total - withMethod);
  return {
    summary: "\u672C\u5468\u671F\u8BB0\u5F55\u7231\u7231 ".concat(total, " \u6B21"),
    fertile: ovulationDay ? "\u5176\u4E2D\u6392\u5375\u671F\u5185 ".concat(fertile, " \u6B21\uFF08\u6309\u63A8\u7B97\uFF09") : '排卵期数据不足，无法统计',
    unprotected: total === 0 ? '暂无避孕方式记录' : missMethod === 0 ? '避孕方式记录较完整' : "\u6709 ".concat(missMethod, "/").concat(total, " \u6B21\u672A\u8BB0\u5F55\u907F\u5B55\u65B9\u5F0F\uFF08\u6216\u6807\u8BB0\u4E3A\u672A\u907F\u5B55\uFF09")
  };
}

/**
 * 统计爱爱次数：按「月经期 / 排卵期 / 其他时间」归类；同时统计“未记录/未避孕”次数，用于风险估算。
 * 注意：为了和旧逻辑一致：
 * - sexRecords[ds] 里每条算 1 次
 * - sexDates 里若当天没有详细条目，则当天按 1 次（视为未记录避孕方式）
 */
function buildSexPhaseCounts(store, rangeStart, rangeEnd, periodStart, periodEnd, fertileStart, fertileEnd) {
  var sexRecords = store.sexRecords || {};
  var sexDates = Array.isArray(store.sexDates) ? store.sexDates : [];
  var unprotectedRe = /(无|不避孕|未避孕|不使用|没用)/;
  function inRange(ds, a, b) {
    return ds && a && b && ds >= a && ds <= b;
  }
  function bucketOf(ds) {
    if (periodStart && periodEnd && inRange(ds, periodStart, periodEnd)) return 'period';
    if (fertileStart && fertileEnd && inRange(ds, fertileStart, fertileEnd)) return 'ovulation';
    return 'other';
  }
  var out = {
    period: {
      total: 0,
      unprotected: 0
    },
    ovulation: {
      total: 0,
      unprotected: 0
    },
    other: {
      total: 0,
      unprotected: 0
    }
  };

  // 1) 详细记录
  Object.keys(sexRecords).forEach(function (ds) {
    if (!inRange(ds, rangeStart, rangeEnd)) return;
    var list = Array.isArray(sexRecords[ds]) ? sexRecords[ds] : [];
    if (!list.length) return;
    var key = bucketOf(ds);
    out[key].total += list.length;
    list.forEach(function (it) {
      var m = it && it.method ? String(it.method).trim() : '';
      if (!m || unprotectedRe.test(m)) out[key].unprotected += 1;
    });
  });

  // 2) 兜底：只有小心心日期但没详细条目时，当天按 1 次（并计为未记录避孕方式）
  sexDates.forEach(function (ds) {
    if (!inRange(ds, rangeStart, rangeEnd)) return;
    var list = Array.isArray(sexRecords[ds]) ? sexRecords[ds] : [];
    if (list.length) return;
    var key = bucketOf(ds);
    out[key].total += 1;
    out[key].unprotected += 1;
  });
  return out;
}

// 简单风险估算：只做“提示”，不做医学承诺；系数后续可调
function estimatePregnancyRatePct(curPhaseCounts) {
  if (!curPhaseCounts) return 0;
  var p = curPhaseCounts.period || {
    total: 0,
    unprotected: 0
  };
  var o = curPhaseCounts.ovulation || {
    total: 0,
    unprotected: 0
  };
  var other = curPhaseCounts.other || {
    total: 0,
    unprotected: 0
  };
  var totalAll = (p.total || 0) + (o.total || 0) + (other.total || 0);
  if (!totalAll) return 0;
  var risk = 0;
  risk += (o.unprotected || 0) * 8;
  risk += (o.total || 0) * 2;
  risk += (other.unprotected || 0) * 1;
  return clamp(risk, 0, 45);
}
var _default = {
  data: function data() {
    return {
      hasData: false,
      latestStart: '',
      latestEnd: '',
      latestPeriodLen: 0,
      latestCycleLen: 0,
      stabilityText: '',
      confidenceText: '',
      nextStart: '',
      ovulationDay: '',
      fertileRangeText: '',
      cycleChange: null,
      painSummaryText: '',
      painLevelText: '',
      painPeakText: '',
      // 本周期"爱爱次数"记录
      sexSummaryText: '',
      sexFertileText: '',
      sexUnprotectedText: '',
      // 上一周期"爱爱次数"记录
      sexPrevSummaryText: '',
      sexPrevFertileText: '',
      sexPrevUnprotectedText: '',
      // 新UI：顶部汇总 + 柱状图
      sexCycleTotal: 0,
      sexPregRateText: '0.0%',
      // [{ label: '月经期', cur: 0, prev: 0, curPct: 0, prevPct: 0 }]
      sexPhaseBars: [],
      // 体重 7 天
      weight7SubText: '近7天体重：暂无记录',
      latest7WeightText: '--.--',
      weightHintText: '体重记录不足（建议在经期前后多记录几天）',
      // canvas 尺寸
      canvasW: 1,
      canvasH: 1,
      canvasCssW: 0,
      canvasCssH: 0,
      dpr: 1
    };
  },
  onLoad: function onLoad() {
    this.refresh();
  },
  onShow: function onShow() {
    this.refresh();
  },
  methods: {
    onGoWeight: function onGoWeight() {
      uni.navigateTo({
        // url: '/pages/subperiod/weight/weight',
        fail: function fail() {
          return uni.showToast({
            title: '“体重分析"页维护中，请等等待下一次更新',
            icon: 'none'
          });
        }
      });
    },
    onGoLove: function onGoLove() {
      uni.navigateTo({
        url: '/pages/subperiod/love/love'
        // fail: () => uni.showToast({ title: '“爱爱"页维护中', icon: 'none' })
      });
    },
    refresh: function refresh() {
      var _this = this;
      var store = normalizeStore(loadStore());
      var settings = store.settings || DEFAULTS;
      var recordsAsc = store.periodRecords || [];

      // 体重：无论是否记录经期，都绘制
      var w7 = this.buildWeight7Series(store.weightRecords);
      this.setData({
        weight7SubText: w7.subText,
        latest7WeightText: w7.latestText,
        weightHintText: w7.hintText
      });
      this.$nextTick(function () {
        return _this.measureCanvasAndDraw(w7);
      });

      // 无经期记录：上面周期/痛经/行为不展示
      if (!recordsAsc.length) {
        this.setData({
          hasData: false,
          latestStart: '',
          latestEnd: '',
          latestPeriodLen: 0,
          latestCycleLen: 0,
          stabilityText: '',
          confidenceText: '',
          nextStart: '',
          ovulationDay: '',
          fertileRangeText: '',
          cycleChange: null,
          painSummaryText: '',
          painLevelText: '',
          painPeakText: '',
          sexSummaryText: '',
          sexFertileText: '',
          sexUnprotectedText: '',
          sexPrevSummaryText: '',
          sexPrevFertileText: '',
          sexPrevUnprotectedText: '',
          sexCycleTotal: 0,
          sexPregRateText: '0.0%',
          sexPhaseBars: []
        });
        return;
      }
      var recent = getRecentRecords(recordsAsc, 1)[0];
      var w0 = getLatestPeriodWindow(recent, settings);
      var latestStart = w0.start;
      var latestEnd = w0.end;
      var latestPeriodLen = diffDays(latestStart, addDaysStr(latestEnd, 1));
      var recent2 = getRecentRecords(recordsAsc, 2);
      var latestCycleLen = 0;
      if (recent2.length >= 2) latestCycleLen = diffDays(recent2[0].start, recent2[1].start);
      var stab = analyzeStability(recordsAsc);
      var stabilityText = stab.text;
      var confidenceText = recordsAsc.length >= 6 ? '高（记录较多）' : recordsAsc.length >= 4 ? '中（记录一般）' : '低（记录偏少）';
      var pred = predictNext(latestStart, latestCycleLen, settings);
      var todayStr = getTodayStr();

      // 本周期范围：latestStart ~ (下次预计开始前一天)，没有预测就到今天
      var thisCycleEnd = pred.nextStart ? addDaysStr(pred.nextStart, -1) : todayStr;
      var thisSex = buildSexTexts(store, latestStart, thisCycleEnd, pred.ovulationDay);

      // 上一周期：start = 前一次经期开始；end = 本次开始前一天
      var prevSex = {
        summary: '上一周期数据不足',
        fertile: '',
        unprotected: ''
      };

      // === 新UI：按阶段统计（本周期 vs 上周期） ===
      // 本周期：月经期范围（latestStart ~ latestEnd），排卵期范围（pred.fertileStart ~ pred.fertileEnd）
      var curPhaseCounts = buildSexPhaseCounts(store, latestStart, thisCycleEnd, latestStart, latestEnd, pred.fertileStart, pred.fertileEnd);

      // 上一周期：需要上一条经期记录的「经期窗口」
      var prevPhaseCounts = {
        period: {
          total: 0,
          unprotected: 0
        },
        ovulation: {
          total: 0,
          unprotected: 0
        },
        other: {
          total: 0,
          unprotected: 0
        }
      };
      var startsAsc = (recordsAsc || []).map(function (r) {
        return r.start;
      }).filter(Boolean).sort();
      if (startsAsc.length >= 2) {
        var prevRecord = recordsAsc[recordsAsc.length - 2];
        var prevWindow = getLatestPeriodWindow(prevRecord, settings);
        var prevStart = prevWindow.start;
        var prevPeriodEnd = prevWindow.end;
        var prevEnd = addDaysStr(latestStart, -1);
        var prevCycleLen = diffDays(prevStart, latestStart);
        var prevPred = predictNext(prevStart, prevCycleLen, settings);
        prevPhaseCounts = buildSexPhaseCounts(store, prevStart, prevEnd, prevStart, prevPeriodEnd, prevPred.fertileStart, prevPred.fertileEnd);
      }

      // 柱状图数据 + 百分比高度
      var chart = [{
        label: '月经期',
        cur: curPhaseCounts.period.total,
        prev: prevPhaseCounts.period.total
      }, {
        label: '排卵期',
        cur: curPhaseCounts.ovulation.total,
        prev: prevPhaseCounts.ovulation.total
      }, {
        label: '其他时间',
        cur: curPhaseCounts.other.total,
        prev: prevPhaseCounts.other.total
      }];
      var maxVal = Math.max.apply(Math, [0].concat((0, _toConsumableArray2.default)(chart.map(function (x) {
        return x.cur;
      })), (0, _toConsumableArray2.default)(chart.map(function (x) {
        return x.prev;
      }))));
      var denom = maxVal > 0 ? maxVal : 1;
      var withPct = chart.map(function (it) {
        var curPct0 = Math.round(it.cur / denom * 100);
        var prevPct0 = Math.round(it.prev / denom * 100);
        // 视觉：非 0 最低给一点高度，避免“1次”看不见
        var curPct = it.cur > 0 ? Math.max(10, curPct0) : 0;
        var prevPct = it.prev > 0 ? Math.max(10, prevPct0) : 0;
        return _objectSpread(_objectSpread({}, it), {}, {
          curPct: curPct,
          prevPct: prevPct
        });
      });
      var sexCycleTotal = chart.reduce(function (s, x) {
        return s + (x.cur || 0);
      }, 0);
      var riskPct = estimatePregnancyRatePct(curPhaseCounts);
      var sexPregRateText = "".concat(riskPct.toFixed(1), "%");

      //  const startsAsc = (recordsAsc || []).map(r => r.start).filter(Boolean).sort();
      //  if (startsAsc.length >= 2) {
      //    const prevStart = startsAsc[startsAsc.length - 2];
      //    const prevEnd = addDaysStr(latestStart, -1);
      //    const prevCycleLen = diffDays(prevStart, latestStart);
      //    const prevPred = predictNext(prevStart, prevCycleLen, settings);
      //    prevSex = buildSexTexts(store, prevStart, prevEnd, prevPred.ovulationDay);

      //    // 给上一周期文案加前缀，避免和本周期混淆
      //    // prevSex.summary = `上一周期：${prevSex.summary.replace('本周期', '')}`.replace('记录爱爱', '记录爱爱');
      //    // prevSex.fertile = prevSex.fertile ? `上一周期：${prevSex.fertile}` : '';
      //    // prevSex.unprotected = prevSex.unprotected ? `上一周期：${prevSex.unprotected}` : '';
      // prevSex.summary = `上一周期：${prevSex.summary}`;
      // prevSex.fertile = prevSex.fertile ? `上一周期：${prevSex.fertile}` : '';
      // prevSex.unprotected = prevSex.unprotected ? `上一周期：${prevSex.unprotected}` : '';

      //  }

      // const cycleChange = buildCycleChangeCard(recordsAsc, settings);

      // const painSummaryText = this.painSummaryText || '最近3个周期未记录痛经';
      // const painLevelText = this.painLevelText || '';
      // const painPeakText = this.painPeakText || '';
      var cycleChange = buildCycleChangeCard(recordsAsc, settings);

      // ✅ 痛经：从 store.painRecords 现算（本周期范围：latestStart ~ thisCycleEnd）
      var painTexts = buildPainTexts(store.painRecords, latestStart, thisCycleEnd);
      var painSummaryText = painTexts.painSummaryText;
      var painLevelText = painTexts.painLevelText;
      var painPeakText = painTexts.painPeakText;
      this.setData({
        hasData: true,
        latestStart: latestStart,
        latestEnd: latestEnd,
        latestPeriodLen: latestPeriodLen,
        latestCycleLen: latestCycleLen,
        stabilityText: stabilityText,
        confidenceText: confidenceText,
        nextStart: pred.nextStart,
        ovulationDay: pred.ovulationDay,
        fertileRangeText: pred.fertileRangeText,
        cycleChange: cycleChange,
        painSummaryText: painSummaryText,
        painLevelText: painLevelText,
        painPeakText: painPeakText,
        // sexSummaryText,
        // sexFertileText,
        // sexUnprotectedText
        sexSummaryText: thisSex.summary,
        sexFertileText: thisSex.fertile,
        sexUnprotectedText: thisSex.unprotected,
        sexPrevSummaryText: prevSex.summary,
        sexPrevFertileText: prevSex.fertile,
        sexPrevUnprotectedText: prevSex.unprotected,
        sexCycleTotal: sexCycleTotal,
        sexPregRateText: sexPregRateText,
        sexPhaseBars: withPct
      });
    },
    // 今天往前 7 天（含今天）；哪怕只记录 1 天也展示
    buildWeight7Series: function buildWeight7Series(weightRecords) {
      var today = new Date();
      var days = [];
      var labels = [];
      for (var i = 6; i >= 0; i--) {
        var d = new Date(today);
        d.setDate(d.getDate() - i);
        var ds = toDateStr(d);
        days.push(ds);
        labels.push("".concat(d.getMonth() + 1, "/").concat(d.getDate()));
      }
      var map = {};
      (weightRecords || []).forEach(function (r) {
        if (!r || !r.date) return;
        if (typeof r.weight !== 'number' || Number.isNaN(r.weight)) return;
        map[r.date] = r.weight;
      });
      var values = days.map(function (ds) {
        return map[ds] != null ? map[ds] : null;
      });
      var exist = values.filter(function (v) {
        return typeof v === 'number';
      });
      var latestVal = null;
      var todayStr = days[6];
      if (map[todayStr] != null) latestVal = map[todayStr];else {
        for (var _i = 6; _i >= 0; _i--) {
          var _ds = days[_i];
          if (map[_ds] != null) {
            latestVal = map[_ds];
            break;
          }
        }
      }
      var subText = '近7天体重：暂无记录';
      var latestText = '--.--';
      var hintText = '体重记录不足（建议在经期前后多记录几天）';
      if (exist.length) {
        var min = Math.min.apply(Math, (0, _toConsumableArray2.default)(exist));
        var max = Math.max.apply(Math, (0, _toConsumableArray2.default)(exist));
        var wave = max - min;
        subText = "\u5DF2\u8BB0\u5F55 ".concat(exist.length, "/7 \u5929 \xB7 \u6700\u8FD1 ").concat(fmt2(latestVal), "kg \xB7 \u5468\u671F\u5185\u6700\u5927\u6CE2\u52A8 ").concat(fmt2(wave), "kg");
        latestText = fmt2(latestVal);
        hintText = exist.length >= 3 ? '' : '体重记录不足（建议在经期前后多记录几天）';
      }
      return {
        labels: labels,
        values: values,
        subText: subText,
        latestText: latestText,
        hintText: hintText
      };
    },
    // 测量尺寸 + 绘制
    measureCanvasAndDraw: function measureCanvasAndDraw(series) {
      var _this2 = this;
      uni.createSelectorQuery().in(this).select('#weight7Canvas').boundingClientRect(function (rect) {
        if (!rect || !rect.width || !rect.height) return;
        var W = Math.max(1, Math.round(rect.width));
        var H = Math.max(1, Math.round(rect.height));
        _this2.setData({
          canvasW: W,
          canvasH: H,
          canvasCssW: rect.width,
          canvasCssH: rect.height,
          dpr: 1
        }, function () {
          return _this2.drawWeight7Canvas(series);
        });
      }).exec();
    },
    drawWeight7Canvas: function drawWeight7Canvas(series) {
      var ctx = uni.createCanvasContext('weight7Canvas', this);
      var W = this.canvasW || 300;
      var H = this.canvasH || 160;
      ctx.clearRect(0, 0, W, H);

      // padding（像素）
      var padL = 18;
      var padR = 18;
      var padT = 10;
      var padB = 34; // ✅ 底部稍微再留一点：要放7个日期

      var innerW = W - padL - padR;
      var innerH = H - padT - padB;

      // 网格线
      ctx.setStrokeStyle('#f2f2f2');
      ctx.setLineWidth(1);
      for (var i = 0; i <= 3; i++) {
        var y = padT + Math.round(innerH * i / 3);
        ctx.beginPath();
        ctx.moveTo(padL, y);
        ctx.lineTo(W - padR, y);
        ctx.stroke();
      }

      // x 坐标（固定 7 天）
      var xs = [];
      for (var _i2 = 0; _i2 < 7; _i2++) {
        xs.push(padL + Math.round(innerW * _i2 / 6));
      }
      var values = series.values || [];
      var labels = series.labels || []; // "M/D"

      // ✅ 横坐标：每天都显示（7个都显示）
      ctx.setFillStyle('#999');
      ctx.setFontSize(9); // ✅ 字更小一点，避免拥挤
      for (var _i3 = 0; _i3 < labels.length; _i3++) {
        var lb = labels[_i3] || '';
        var x = xs[_i3];
        var estW = lb.length * 5.2;
        var tx = x - estW / 2;

        // 边界保护：不出画布
        tx = Math.max(2, Math.min(W - estW - 2, tx));

        // 底部位置
        ctx.fillText(lb, tx, H - 8);
      }
      var nums = values.filter(function (v) {
        return typeof v === 'number';
      });
      if (!nums.length) {
        ctx.draw();
        return;
      }
      var minV = Math.min.apply(Math, (0, _toConsumableArray2.default)(nums));
      var maxV = Math.max.apply(Math, (0, _toConsumableArray2.default)(nums));
      if (maxV - minV < 0.6) maxV = minV + 0.6;
      var yOf = function yOf(v) {
        var t = (v - minV) / (maxV - minV);
        var y = padT + innerH * (1 - t);
        return Math.max(padT, Math.min(padT + innerH, y));
      };

      // 折线（遇到 null 断开）
      ctx.setStrokeStyle('#ff6b9a');
      ctx.setLineWidth(3);
      var started = false;
      values.forEach(function (v, i) {
        if (typeof v !== 'number') {
          if (started) ctx.stroke();
          started = false;
          return;
        }
        var x = xs[i];
        var y = yOf(v);
        if (!started) {
          ctx.beginPath();
          ctx.moveTo(x, y);
          started = true;
        } else {
          ctx.lineTo(x, y);
        }
      });
      if (started) ctx.stroke();

      // ✅ 点（粉色不变）
      var r = 4;
      ctx.setFillStyle('#ff6b9a');

      // ✅ 文字：统一深灰色 & 放在点下面
      var textColor = '#444';
      var fontSize = 10; // 不能太大
      ctx.setFontSize(fontSize);
      ctx.setFillStyle(textColor);
      values.forEach(function (v, i) {
        if (typeof v !== 'number') return;
        var x = xs[i];
        var y = yOf(v);

        // 点要用粉色画（注意：我们刚刚把 fillStyle 改深灰了，所以这里先切回粉色）
        ctx.setFillStyle('#ff6b9a');
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.fill();

        // 再切回深灰写字
        ctx.setFillStyle(textColor);
        var text = "".concat(v.toFixed(2), "kg");
        var estW = text.length * 5.5;
        var tx = x - estW / 2;

        // 边界保护
        tx = Math.max(2, Math.min(W - estW - 2, tx));

        // ✅ 放点下面：y + 16
        // 同时防止贴到最底部（要给日期让位）
        var maxTextY = H - 18; // 离底部留点空间给日期
        var ty = Math.min(maxTextY, y + 16);
        ctx.fillText(text, tx, ty);
      });
      ctx.draw();
    }
  }
};
exports.default = _default;
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */ 2)["default"]))

/***/ }),

/***/ 149:
/*!************************************************************************************************************************!*\
  !*** D:/PrivateFiles/HBuilderProjects/ID-Local/pages/subperiod/analysis/analysis.vue?vue&type=style&index=0&lang=css& ***!
  \************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Programming_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_Programming_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_6_oneOf_1_1_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_6_oneOf_1_2_Programming_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_3_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--6-oneOf-1-2!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src??ref--6-oneOf-1-3!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!../../../../../../Programming/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./analysis.vue?vue&type=style&index=0&lang=css& */ 150);
/* harmony import */ var _Programming_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_Programming_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_6_oneOf_1_1_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_6_oneOf_1_2_Programming_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_3_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_Programming_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_Programming_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_6_oneOf_1_1_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_6_oneOf_1_2_Programming_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_3_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _Programming_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_Programming_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_6_oneOf_1_1_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_6_oneOf_1_2_Programming_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_3_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0__) if(["default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _Programming_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_Programming_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_6_oneOf_1_1_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_6_oneOf_1_2_Programming_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_3_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_Programming_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_Programming_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_dist_cjs_js_ref_6_oneOf_1_1_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_loaders_stylePostLoader_js_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_6_oneOf_1_2_Programming_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_3_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_vue_loader_lib_index_js_vue_loader_options_Programming_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_analysis_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ 150:
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--6-oneOf-1-2!./node_modules/postcss-loader/src??ref--6-oneOf-1-3!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!D:/PrivateFiles/HBuilderProjects/ID-Local/pages/subperiod/analysis/analysis.vue?vue&type=style&index=0&lang=css& ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin
    if(false) { var cssReload; }
  

/***/ })

},[[143,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/subperiod/analysis/analysis.js.map