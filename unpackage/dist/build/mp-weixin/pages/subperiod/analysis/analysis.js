(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/subperiod/analysis/analysis"],{"721e":function(t,e,r){"use strict";(function(t,e){var a=r("47a9");r("8ba4");a(r("3240"));var n=a(r("c212"));t.__webpack_require_UNI_MP_PLUGIN__=r,e(n.default)}).call(this,r("3223")["default"],r("df3c")["createPage"])},"8f77":function(t,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return n})),r.d(e,"a",(function(){}));var a=function(){var t=this.$createElement;this._self._c},n=[]},bd88:function(t,e,r){"use strict";(function(t){var a=r("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(r("af34")),o=a(r("7ca3")),i=a(r("3b2d")),c=a(r("34cf"));function u(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?u(Object(r),!0).forEach((function(e){(0,o.default)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var l={cycleLength:28,periodLength:5,lutealDays:14};function f(t){return(t<10?"0":"")+t}function h(t){return"".concat(t.getFullYear(),"-").concat(f(t.getMonth()+1),"-").concat(f(t.getDate()))}function d(t){if(!t)return null;var e=t.split("-").map(Number),r=(0,c.default)(e,3),a=r[0],n=r[1],o=r[2];return new Date(a,n-1,o)}function v(t,e){var r=d(t),a=d(e);return r&&a?Math.round((a-r)/864e5):0}function p(t,e,r){return Math.max(e,Math.min(r,t))}function x(t){return"number"!==typeof t||Number.isNaN(t)?"":t.toFixed(2)}function g(t,e){var r=Array.isArray(t)?t:[];return r.length<=e?r.slice():r.slice(r.length-e)}function y(t){var e=d(t);return e?"".concat(e.getMonth()+1,"月").concat(e.getDate(),"日"):""}function m(){return h(new Date)}function b(t,e){var r=d(t);return r?(r.setDate(r.getDate()+e),h(r)):""}function T(t,e){return t&&e?"".concat(t," ~ ").concat(e):""}function S(t,e){var r=t.start,a=t.end;if(!a||a===r){var n=e&&e.periodLength?e.periodLength:l.periodLength;a=b(r,Math.max(0,n-1))}return{start:r,end:a}}function w(t,e,r){var a=r&&r.cycleLength?r.cycleLength:l.cycleLength,n=r&&r.lutealDays?r.lutealDays:l.lutealDays,o=e>0?e:a,i=b(t,o),c=b(i,-n),u=b(c,-5),s=b(c,1);return{nextStart:i,ovulationDay:c,fertileStart:u,fertileEnd:s,fertileRangeText:T(u,s)}}function P(t,e,r,a,n,o,i){var c=t.sexRecords||{},u=Array.isArray(t.sexDates)?t.sexDates:[],s=/(无|不避孕|未避孕|不使用|没用)/;function l(t,e,r){return t&&e&&r&&t>=e&&t<=r}function f(t){return a&&n&&l(t,a,n)?"period":o&&i&&l(t,o,i)?"ovulation":"other"}var h={period:{total:0,unprotected:0},ovulation:{total:0,unprotected:0},other:{total:0,unprotected:0}};return Object.keys(c).forEach((function(t){if(l(t,e,r)){var a=Array.isArray(c[t])?c[t]:[];if(a.length){var n=f(t);h[n].total+=a.length,a.forEach((function(t){var e=t&&t.method?String(t.method).trim():"";e&&!s.test(e)||(h[n].unprotected+=1)}))}}})),u.forEach((function(t){if(l(t,e,r)){var a=Array.isArray(c[t])?c[t]:[];if(!a.length){var n=f(t);h[n].total+=1,h[n].unprotected+=1}}})),h}var D={data:function(){return{hasData:!1,latestStart:"",latestEnd:"",latestPeriodLen:0,latestCycleLen:0,stabilityText:"",confidenceText:"",nextStart:"",ovulationDay:"",fertileRangeText:"",cycleChange:null,painSummaryText:"",painLevelText:"",painPeakText:"",sexSummaryText:"",sexFertileText:"",sexUnprotectedText:"",sexPrevSummaryText:"",sexPrevFertileText:"",sexPrevUnprotectedText:"",sexCycleTotal:0,sexPregRateText:"0.0%",sexPhaseBars:[],weight7SubText:"近7天体重：暂无记录",latest7WeightText:"--.--",weightHintText:"体重记录不足（建议在经期前后多记录几天）",canvasW:1,canvasH:1,canvasCssW:0,canvasCssH:0,dpr:1}},onLoad:function(){this.refresh()},onShow:function(){this.refresh()},methods:{onGoWeight:function(){t.navigateTo({fail:function(){return t.showToast({title:'“体重分析"页维护中，请等待更新',icon:"none"})}})},onGoLove:function(){t.navigateTo({url:"/pages/subperiod/love/love"})},refresh:function(){var e=this,r=function(t){if(t.settings=t.settings||s({},l),t.periodRecords=Array.isArray(t.periodRecords)?t.periodRecords:[],t.periodStarts=Array.isArray(t.periodStarts)?t.periodStarts:[],t.painRecords=t.painRecords&&"object"===(0,i.default)(t.painRecords)&&!Array.isArray(t.painRecords)?t.painRecords:{},t.sexRecords=t.sexRecords&&"object"===(0,i.default)(t.sexRecords)&&!Array.isArray(t.sexRecords)?t.sexRecords:{},t.sexDates=Array.isArray(t.sexDates)?t.sexDates:[],t.weightRecords=t.weightRecords||[],!Array.isArray(t.weightRecords)&&"object"===(0,i.default)(t.weightRecords)){var e=t.weightRecords;t.weightRecords=Object.keys(e).sort().map((function(t){var r=e[t]||{},a="number"===typeof r.weight?r.weight:"number"===typeof r.kg?r.kg:NaN;return{date:t,weight:a}})).filter((function(t){return t.date}))}if(Array.isArray(t.weightRecords)&&(t.weightRecords=t.weightRecords.map((function(t){if(!t)return null;var e=t.date||t.day||t.dateStr,r="number"===typeof t.weight?t.weight:"number"===typeof t.kg?t.kg:NaN;return{date:e,weight:r}})).filter((function(t){return t&&t.date})),t.weightRecords.sort((function(t,e){return(t.date||"").localeCompare(e.date||"")}))),0===t.periodRecords.length&&t.periodStarts.length>0){var r=(0,n.default)(t.periodStarts).sort();t.periodRecords=r.map((function(t){return{start:t,end:t}}))}return t.periodRecords.sort((function(t,e){return(t.start||"").localeCompare(e.start||"")})),t}(function(){var e=t.getStorageSync("period_record_v1");return e&&"object"===(0,i.default)(e)?e:{}}()),a=r.settings||l,o=r.periodRecords||[],c=this.buildWeight7Series(r.weightRecords);if(this.setData({weight7SubText:c.subText,latest7WeightText:c.latestText,weightHintText:c.hintText}),this.$nextTick((function(){return e.measureCanvasAndDraw(c)})),o.length){var u=g(o,1)[0],f=S(u,a),x=f.start,T=f.end,D=v(x,b(T,1)),M=g(o,2),R=0;M.length>=2&&(R=v(M[0].start,M[1].start));var A=function(t){var e=g(t,4);if(e.length<4)return{stdev:null,text:"数据不足（经期记录少于4次）"};for(var r=[],a=1;a<e.length;a++)r.push(v(e[a-1].start,e[a].start));var n=r.reduce((function(t,e){return t+e}),0)/r.length,o=r.reduce((function(t,e){return t+(e-n)*(e-n)}),0)/r.length,i=Math.sqrt(o),c="波动较大";return i<=3?c="较稳定":i<=6&&(c="略有波动"),{stdev:i,text:c}}(o),L=A.text,k=o.length>=6?"高（记录较多）":o.length>=4?"中（记录一般）":"低（记录偏少）",O=w(x,R,a),C=m(),E=O.nextStart?b(O.nextStart,-1):C,j=function(t,e,r,a){var n=t.sexRecords||{},o=Array.isArray(t.sexDates)?t.sexDates:[];function i(t,e,r){return t&&e&&r&&t>=e&&t<=r}var c=/(无|不避孕|未避孕|不使用|没用)/,u=0,s=0;Object.keys(n).forEach((function(t){if(i(t,e,r)){var a=Array.isArray(n[t])?n[t]:[];u+=a.length,a.forEach((function(t){var e=t&&t.method?String(t.method).trim():"";e&&(s+=1),e&&!c.test(e)||1}))}})),o.forEach((function(t){if(i(t,e,r)){var a=Array.isArray(n[t])?n[t]:[];a.length||(u+=1)}}));var l=0;if(a){var f=b(a,-5),h=b(a,1);Object.keys(n).forEach((function(t){if(i(t,f,h)){var e=Array.isArray(n[t])?n[t]:[];l+=e.length}})),o.forEach((function(t){if(i(t,f,h)){var e=Array.isArray(n[t])?n[t]:[];e.length||(l+=1)}}))}var d=Math.max(0,u-s);return{summary:"本周期记录爱爱 ".concat(u," 次"),fertile:a?"其中排卵期内 ".concat(l," 次（按推算）"):"排卵期数据不足，无法统计",unprotected:0===u?"暂无避孕方式记录":0===d?"避孕方式记录较完整":"有 ".concat(d,"/").concat(u," 次未记录避孕方式（或标记为未避孕）")}}(r,x,E,O.ovulationDay),F={summary:"上一周期数据不足",fertile:"",unprotected:""},_=P(r,x,E,x,T,O.fertileStart,O.fertileEnd),W={period:{total:0,unprotected:0},ovulation:{total:0,unprotected:0},other:{total:0,unprotected:0}},N=(o||[]).map((function(t){return t.start})).filter(Boolean).sort();if(N.length>=2){var U=o[o.length-2],H=S(U,a),B=H.start,G=H.end,I=b(x,-1),q=v(B,x),z=w(B,q,a);W=P(r,B,I,B,G,z.fertileStart,z.fertileEnd)}var J=[{label:"月经期",cur:_.period.total,prev:W.period.total},{label:"排卵期",cur:_.ovulation.total,prev:W.ovulation.total},{label:"其他时间",cur:_.other.total,prev:W.other.total}],$=Math.max.apply(Math,[0].concat((0,n.default)(J.map((function(t){return t.cur}))),(0,n.default)(J.map((function(t){return t.prev}))))),Q=$>0?$:1,Y=J.map((function(t){var e=Math.round(t.cur/Q*100),r=Math.round(t.prev/Q*100),a=t.cur>0?Math.max(10,e):0,n=t.prev>0?Math.max(10,r):0;return s(s({},t),{},{curPct:a,prevPct:n})})),K=J.reduce((function(t,e){return t+(e.cur||0)}),0),V=function(t){if(!t)return 0;var e=t.period||{total:0,unprotected:0},r=t.ovulation||{total:0,unprotected:0},a=t.other||{total:0,unprotected:0},n=(e.total||0)+(r.total||0)+(a.total||0);if(!n)return 0;var o=0;return o+=8*(r.unprotected||0),o+=2*(r.total||0),o+=1*(a.unprotected||0),p(o,0,45)}(_),X="".concat(V.toFixed(1),"%"),Z=function(t,e){var r=e&&e.cycleLength?e.cycleLength:l.cycleLength,a=(t||[]).map((function(t){return t.start})).filter(Boolean).sort();if(a.length<1)return null;var n=m(),o=a[a.length-1],i=v(o,n)+1,c="",u="",s=0,f=0;if(a.length>=2){c=a[a.length-2];var x=a[a.length-1];s=v(c,x);var g=d(x);g.setDate(g.getDate()-1),u=h(g)}if(a.length>=3){var b=a[a.length-3],T=a[a.length-2];f=v(b,T)}var S=s>=21&&s<=35?"正常":"偏离",w="—";if(s&&f){var P=s-f;w=0===P?"持平":P>0?"多 ".concat(P," 天"):"少 ".concat(Math.abs(P)," 天")}var D=[],M=i-r;D.push({dateLabel:y(o),status:M<=0?"准时":"推迟".concat(M,"天"),lenText:"今天为当前周期".concat(i,"天"),len:i,isCurrent:!0});for(var R=0,A=a.length-1;A>=1&&R<2;A--){var L=a[A-1],k=a[A],O=v(L,k);if(!(O<=0)){var C=O-r,E="准时";C>0?E="推迟".concat(C,"天"):C<0&&(E="提前".concat(Math.abs(C),"天")),D.push({dateLabel:y(L),status:E,lenText:"".concat(O,"天"),len:O,isCurrent:!1}),R++}}var j=Math.max(1,r+22);D.forEach((function(t){var e=t.len/j*100,r=Math.round(e);t.barPct=p(r,18,100),t.barStyle="width: ".concat(t.barPct,"%;")}));var F=c&&u?"最近 1 个周期（".concat(c," - ").concat(u,"）"):"最近 1 个周期（数据不足）";return{rangeText:F,lastLenText:s?"".concat(s,"天"):"—",normalTag:S,deltaText:w,items:D}}(o,a),tt=function(t,e,r){var a=t&&"object"===(0,i.default)(t)?t:{},n=["轻微","一般","严重","非常严重"],o={};n.forEach((function(t,e){return o[t]=e}));var c=[];Object.keys(a).forEach((function(t){if(function(t,e,r){return!!(t&&e&&r)&&(t>=e&&t<=r)}(t,e,r)){var n=Array.isArray(a[t])?a[t]:[];n.forEach((function(e){return c.push(s(s({},e),{},{_date:t}))}))}}));var u=c.length;if(!u)return{painSummaryText:"本周期未记录痛经",painLevelText:"",painPeakText:""};var l={},f="",h=-1;c.forEach((function(t){var e=t&&t.level?t.level:"未选择程度";l[e]=(l[e]||0)+1;var r=e in o?o[e]:-1;r>h&&(h=r,f=e)}));var d="",v=0;Object.keys(l).forEach((function(t){l[t]>v&&(v=l[t],d=t)}));var p=n.filter((function(t){return l[t]})).map((function(t){return"".concat(t).concat(l[t],"次")}));return l["未选择程度"]&&p.push("未选择".concat(l["未选择程度"],"次")),{painSummaryText:"本周期记录痛经 ".concat(u," 次（").concat(e," ~ ").concat(r,"）"),painLevelText:p.length?"程度分布：".concat(p.join("，")):"",painPeakText:f?"最严重程度：".concat(f,"；最常见：").concat(d):""}}(r.painRecords,x,E),et=tt.painSummaryText,rt=tt.painLevelText,at=tt.painPeakText;this.setData({hasData:!0,latestStart:x,latestEnd:T,latestPeriodLen:D,latestCycleLen:R,stabilityText:L,confidenceText:k,nextStart:O.nextStart,ovulationDay:O.ovulationDay,fertileRangeText:O.fertileRangeText,cycleChange:Z,painSummaryText:et,painLevelText:rt,painPeakText:at,sexSummaryText:j.summary,sexFertileText:j.fertile,sexUnprotectedText:j.unprotected,sexPrevSummaryText:F.summary,sexPrevFertileText:F.fertile,sexPrevUnprotectedText:F.unprotected,sexCycleTotal:K,sexPregRateText:X,sexPhaseBars:Y})}else this.setData({hasData:!1,latestStart:"",latestEnd:"",latestPeriodLen:0,latestCycleLen:0,stabilityText:"",confidenceText:"",nextStart:"",ovulationDay:"",fertileRangeText:"",cycleChange:null,painSummaryText:"",painLevelText:"",painPeakText:"",sexSummaryText:"",sexFertileText:"",sexUnprotectedText:"",sexPrevSummaryText:"",sexPrevFertileText:"",sexPrevUnprotectedText:"",sexCycleTotal:0,sexPregRateText:"0.0%",sexPhaseBars:[]})},buildWeight7Series:function(t){for(var e=new Date,r=[],a=[],o=6;o>=0;o--){var i=new Date(e);i.setDate(i.getDate()-o);var c=h(i);r.push(c),a.push("".concat(i.getMonth()+1,"/").concat(i.getDate()))}var u={};(t||[]).forEach((function(t){t&&t.date&&("number"!==typeof t.weight||Number.isNaN(t.weight)||(u[t.date]=t.weight))}));var s=r.map((function(t){return null!=u[t]?u[t]:null})),l=s.filter((function(t){return"number"===typeof t})),f=null,d=r[6];if(null!=u[d])f=u[d];else for(var v=6;v>=0;v--){var p=r[v];if(null!=u[p]){f=u[p];break}}var g="近7天体重：暂无记录",y="--.--",m="体重记录不足（建议在经期前后多记录几天）";if(l.length){var b=Math.min.apply(Math,(0,n.default)(l)),T=Math.max.apply(Math,(0,n.default)(l)),S=T-b;g="已记录 ".concat(l.length,"/7 天 · 最近 ").concat(x(f),"kg · 周期内最大波动 ").concat(x(S),"kg"),y=x(f),m=l.length>=3?"":"体重记录不足（建议在经期前后多记录几天）"}return{labels:a,values:s,subText:g,latestText:y,hintText:m}},measureCanvasAndDraw:function(e){var r=this;t.createSelectorQuery().in(this).select("#weight7Canvas").boundingClientRect((function(t){if(t&&t.width&&t.height){var a=Math.max(1,Math.round(t.width)),n=Math.max(1,Math.round(t.height));r.setData({canvasW:a,canvasH:n,canvasCssW:t.width,canvasCssH:t.height,dpr:1},(function(){return r.drawWeight7Canvas(e)}))}})).exec()},drawWeight7Canvas:function(e){var r=t.createCanvasContext("weight7Canvas",this),a=this.canvasW||300,o=this.canvasH||160;r.clearRect(0,0,a,o);var i=a-18-18,c=o-10-34;r.setStrokeStyle("#f2f2f2"),r.setLineWidth(1);for(var u=0;u<=3;u++){var s=10+Math.round(c*u/3);r.beginPath(),r.moveTo(18,s),r.lineTo(a-18,s),r.stroke()}for(var l=[],f=0;f<7;f++)l.push(18+Math.round(i*f/6));var h=e.values||[],d=e.labels||[];r.setFillStyle("#999"),r.setFontSize(9);for(var v=0;v<d.length;v++){var p=d[v]||"",x=l[v],g=5.2*p.length,y=x-g/2;y=Math.max(2,Math.min(a-g-2,y)),r.fillText(p,y,o-8)}var m=h.filter((function(t){return"number"===typeof t}));if(m.length){var b=Math.min.apply(Math,(0,n.default)(m)),T=Math.max.apply(Math,(0,n.default)(m));T-b<.6&&(T=b+.6);var S=function(t){var e=(t-b)/(T-b),r=10+c*(1-e);return Math.max(10,Math.min(10+c,r))};r.setStrokeStyle("#ff6b9a"),r.setLineWidth(3);var w=!1;h.forEach((function(t,e){if("number"!==typeof t)return w&&r.stroke(),void(w=!1);var a=l[e],n=S(t);w?r.lineTo(a,n):(r.beginPath(),r.moveTo(a,n),w=!0)})),w&&r.stroke();r.setFillStyle("#ff6b9a");r.setFontSize(10),r.setFillStyle("#444"),h.forEach((function(t,e){if("number"===typeof t){var n=l[e],i=S(t);r.setFillStyle("#ff6b9a"),r.beginPath(),r.arc(n,i,4,0,2*Math.PI),r.fill(),r.setFillStyle("#444");var c="".concat(t.toFixed(2),"kg"),u=5.5*c.length,s=n-u/2;s=Math.max(2,Math.min(a-u-2,s));var f=o-18,h=Math.min(f,i+16);r.fillText(c,s,h)}})),r.draw()}else r.draw()}}};e.default=D}).call(this,r("df3c")["default"])},c212:function(t,e,r){"use strict";r.r(e);var a=r("8f77"),n=r("ee59");for(var o in n)["default"].indexOf(o)<0&&function(t){r.d(e,t,(function(){return n[t]}))}(o);r("f561");var i=r("828b"),c=Object(i["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);e["default"]=c.exports},ee59:function(t,e,r){"use strict";r.r(e);var a=r("bd88"),n=r.n(a);for(var o in a)["default"].indexOf(o)<0&&function(t){r.d(e,t,(function(){return a[t]}))}(o);e["default"]=n.a},f561:function(t,e,r){"use strict";var a=r("f991"),n=r.n(a);n.a},f991:function(t,e,r){}},[["721e","common/runtime","common/vendor"]]]);