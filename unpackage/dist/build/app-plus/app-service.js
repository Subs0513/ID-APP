if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";const t="/static/assets/icons/粉_日期.svg",a=(e,t)=>{const a=e.__vccOpts||e;for(const[o,s]of t)a[o]=s;return a},o=require("../../utils/storage"),s=require("../../utils/date"),n="importantDaysOrderIds";function i(e,t){let a=s.daysTo(e);if(0===a)return{badgeFull:"就是今天!"};if(a>0)return{badgeFull:`还有 ${a} 天`,daysAbs:a,daysSign:"后"};const o=Math.abs(a);return{badgeFull:`已经 ${o}${t?" + 1":""} 天`,daysAbs:o,daysSign:"前"}}function l(e,t){if(!Array.isArray(t)||0===t.length)return e.slice();const a=new Map;e.forEach((e=>e&&null!=e.id&&a.set(String(e.id),e)));const o=new Set,s=[];return t.forEach((e=>{const t=String(e),n=a.get(t);n&&(s.push(n),o.add(t))})),e.forEach((e=>{const t=e&&null!=e.id?String(e.id):"";t&&!o.has(t)&&s.push(e)})),s}const c=a({data:()=>({statusBarHeight:0,navBarHeight:44,navTotalHeight:0,coupleStartDate:"",daysTogether:0,list:[],isDragging:!1,dragIndex:-1,dragOffsetY:0,lastY:0,itemHeight:0}),onLoad(){const e=uni.getSystemInfoSync().statusBarHeight||0;this.setData({statusBarHeight:e,navBarHeight:44,navTotalHeight:e+44}),this.refresh()},onShow(){this.refresh()},onTabItemTap(){this.refresh()},methods:{refresh(){const e=o.getCoupleStartDate(),t=s.todayStr(),a=e?s.diffDays(e,t)+1:0,c=function(e){const t=e.slice(),a=t.filter((e=>e&&e.isTop)),o=t.filter((e=>!e||!e.isTop));let i=[];try{i=uni.getStorageSync(n)||[]}catch(r){i=[]}if(Array.isArray(i)&&i.length>0)return l(a,i).concat(l(o,i));const c=e=>e.slice().sort(((e,t)=>Math.abs(s.daysTo(e.date))-Math.abs(s.daysTo(t.date))));return c(a).concat(c(o))}(o.getList()||[]),r=c.map((e=>({...e,...i(e.date,e.includeStart)})));this.setData({coupleStartDate:e,daysTogether:a,list:r})},goAdd(){uni.switchTab({url:"/pages/add/add"})},onTapItem(e){if(this.isDragging)return;const t=e&&e.currentTarget&&e.currentTarget.dataset?e.currentTarget.dataset.id:"";t&&uni.navigateTo({url:"/pages/detail/detail?id="+t})},onDragStart(e){const t=Number(e.currentTarget.dataset.index);if(Number.isNaN(t))return;const a=e.touches&&e.touches[0]?e.touches[0].clientY:0,o=this.itemHeight||74;this.setData({isDragging:!0,dragIndex:t,dragOffsetY:0,lastY:a,itemHeight:o}),uni.vibrateShort&&uni.vibrateShort()},onDragMove(e){if(!this.isDragging)return;if(!e.touches||!e.touches[0])return;const t=e.touches[0].clientY,a=t-this.lastY,o=this.dragOffsetY+a;this.setData({dragOffsetY:o,lastY:t});const s=this.itemHeight||74,n=Math.round(o/s);if(0===n)return;const i=this.dragIndex;let l=i+n;if(l<0&&(l=0),l>this.list.length-1&&(l=this.list.length-1),l===i)return;const c=this.list.slice(),[r]=c.splice(i,1);c.splice(l,0,r),this.setData({list:c,dragIndex:l,dragOffsetY:0})},onDragEnd(){if(this.isDragging){try{const e=(this.list||[]).map((e=>e.id));uni.setStorageSync(n,e)}catch(e){}this.setData({isDragging:!1,dragIndex:-1,dragOffsetY:0,lastY:0})}}}},[["render",function(a,o,s,n,i,l){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"custom-nav",style:e.normalizeStyle("height:"+i.navTotalHeight+"px;")},[e.createElementVNode("view",{class:"custom-nav__inner",style:e.normalizeStyle("padding-top:"+i.statusBarHeight+"px;height:"+i.navBarHeight+"px;")},[e.createElementVNode("text",{class:"custom-nav__title"},"我和你的重要时光")],4)],4),e.createElementVNode("view",{style:e.normalizeStyle("height:"+i.navTotalHeight+"px;")},null,4),e.createElementVNode("view",{class:"container page-bottom-space"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"big-card"},[e.createElementVNode("view",{class:"big-card-left"},[e.createElementVNode("text",{class:"big-title"},"我们已经在一起了"),e.createElementVNode("view",{class:"big-sub"},[e.createElementVNode("text",null,"起始日："),e.createElementVNode("text",null,e.toDisplayString(i.coupleStartDate?i.coupleStartDate:"未设置"),1)])]),e.createElementVNode("view",{class:"big-card-right"},[e.createElementVNode("text",{class:"big-num"},e.toDisplayString(i.daysTogether),1),e.createElementVNode("text",{class:"big-unit"},"days")])])]),e.createElementVNode("view",{class:"list-header"},[e.createElementVNode("view",{class:"list-title"},[e.createElementVNode("image",{class:"title-icon",src:t,mode:"aspectFit"}),e.createElementVNode("text",null,"重要的日子")])]),i.list&&0!==i.list.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.list,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["item",{dragging:i.isDragging&&i.dragIndex===a}]),key:t.id,style:e.normalizeStyle(i.isDragging&&i.dragIndex===a?"transform: translateY("+i.dragOffsetY+"px);":""),"data-index":a,"data-id":t.id,onTouchmove:o[3]||(o[3]=e.withModifiers(((...e)=>l.onDragMove&&l.onDragMove(...e)),["stop","prevent"])),onTouchend:o[4]||(o[4]=e.withModifiers(((...e)=>l.onDragEnd&&l.onDragEnd(...e)),["stop"])),onTouchcancel:o[5]||(o[5]=e.withModifiers(((...e)=>l.onDragEnd&&l.onDragEnd(...e)),["stop"]))},[e.createElementVNode("view",{class:"item-main",onClick:o[1]||(o[1]=(...e)=>l.onTapItem&&l.onTapItem(...e)),onLongpress:o[2]||(o[2]=(...e)=>l.onDragStart&&l.onDragStart(...e)),"data-index":a,"data-id":t.id},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("text",{class:"item-title"},e.toDisplayString(t.title),1)]),e.createElementVNode("view",{class:"item-right"},[t.badgeFull?(e.openBlock(),e.createElementBlock("view",{key:0,class:"badge"},[e.createElementVNode("text",{class:"badge-text"},e.toDisplayString(t.badgeFull),1)])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"count"},[e.createElementVNode("text",{class:"count-num"},e.toDisplayString(t.daysAbs),1),e.createElementVNode("text",{class:"count-unit"},e.toDisplayString(1===t.daysAbs?"day":"days"),1),e.createElementVNode("text",{class:"count-sign"},e.toDisplayString(t.daysSign),1)]))])],40,["data-index","data-id"])],46,["data-index","data-id"])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-card",onClick:o[0]||(o[0]=(...e)=>l.goAdd&&l.goAdd(...e))},[e.createElementVNode("text",{class:"empty-card-text"},"还没有重要日子哦，点击下方「新增」开始吧～")]))])])}],["__scopeId","data-v-6459b862"]]),r=require("../../utils/storage"),d=require("../../utils/date");const m=a({data:()=>({isEdit:!1,editId:"",typeOptions:[{value:"anniversary",text:"纪念日"},{value:"birthday",text:"生日"},{value:"other",text:"其他"}],typeIndex:0,form:{title:"",date:"",type:"anniversary",note:"",isTop:!1,includeStart:!1},text:""}),onShow(){const e=uni.getStorageSync("editingId");if(e)return uni.removeStorageSync("editingId"),void(this.isEdit&&this.editId===e||this.loadEdit(e));this.isEdit||this.form&&(this.form.title||this.form.note)?this.resetForm():this.form.date||this.resetForm()},onLoad(e){const t=e&&e.id?e.id:"";t?this.loadEdit(t):this.resetForm()},methods:{resetForm(){this.setData({isEdit:!1,editId:"",typeIndex:0,form:{title:"",date:d.todayStr(),type:"anniversary",note:"",isTop:!1,includeStart:!1}})},loadEdit(e){const t=r.getList().find((t=>t.id===e));if(!t)return uni.showToast({title:"未找到数据",icon:"none"}),void uni.switchTab({url:"/pages/home/home"});const a=this.typeOptions.findIndex((e=>e.value===t.type));this.setData({isEdit:!0,editId:e,typeIndex:a>=0?a:0,form:{title:t.title||"",date:t.date||d.todayStr(),type:t.type||"anniversary",note:t.note||"",isTop:!!t.isTop,includeStart:!!t.includeStart}}),uni.setNavigationBarTitle({title:"修改重要日子"})},onTitle(e){this.setData({form:{...this.form,title:e.detail.value}})},onDate(e){this.setData({form:{...this.form,date:e.detail.value}})},onType(e){const t=Number(e.detail.value)||0,a=this.typeOptions[t].value;this.setData({typeIndex:t,form:{...this.form,type:a}})},onNote(e){this.setData({form:{...this.form,note:e.detail.value}})},onTop(e){this.setData({form:{...this.form,isTop:e.detail.value}})},onIncludeStart(e){this.setData({form:{...this.form,includeStart:e.detail.value}})},validate(){const e=this.form;return e.title&&e.title.trim()?e.date?"":"请选择日期":"请填写标题"},save(){const e=this.validate();if(e)return void uni.showToast({title:e,icon:"none"});const t=r.getList(),a=Date.now(),o=this.form;if(this.isEdit){const e=t.map((e=>e.id!==this.editId?e:{...e,...o,updatedAt:a}));r.setList(e),uni.showToast({title:"已保存",icon:"success"});const s=uni.getStorageSync("backDetailId");return s?(uni.removeStorageSync("backDetailId"),void uni.redirectTo({url:"/pages/detail/detail?id="+s})):void uni.switchTab({url:"/pages/home/home"})}const s={id:"id_"+Date.now()+"_"+Math.floor(1e5*Math.random()),title:o.title.trim(),date:o.date,type:o.type,note:o.note||"",isTop:!!o.isTop,includeStart:!!o.includeStart,createdAt:a,updatedAt:a};r.setList([s,...t]),uni.showToast({title:"已添加",icon:"success"}),this.resetForm(),uni.switchTab({url:"/pages/home/home"})}}},[["render",function(a,o,s,n,i,l){return e.openBlock(),e.createElementBlock("view",{class:"container page-bottom-space"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"label row-left-with-icon"},[e.createElementVNode("image",{class:"label-icon",src:"/static/assets/icons/粉_标题.svg",mode:"aspectFit"}),e.createElementVNode("text",null,"标题")]),e.createElementVNode("view",{class:"field field--single"},[e.createElementVNode("input",{class:"field__input",placeholder:"例如：在一起一周年",value:i.form.title,onInput:o[0]||(o[0]=(...e)=>l.onTitle&&l.onTitle(...e))},null,40,["value"])]),e.createElementVNode("view",{class:"label row-left-with-icon"},[e.createElementVNode("image",{class:"label-icon",src:t,mode:"aspectFit"}),e.createElementVNode("text",null,"日期")]),e.createElementVNode("picker",{mode:"date",value:i.form.date,onChange:o[1]||(o[1]=(...e)=>l.onDate&&l.onDate(...e))},[e.createElementVNode("view",{class:"field field--single"},[e.createElementVNode("view",{class:e.normalizeClass("field__value "+(i.form.date?"":"field__placeholder"))},e.toDisplayString(i.form.date||"请选择日期"),3)])],40,["value"]),e.createElementVNode("view",{class:"label row-left-with-icon"},[e.createElementVNode("image",{class:"label-icon",src:"/static/assets/icons/粉_类型.svg",mode:"aspectFit"}),e.createElementVNode("text",null,"类型")]),e.createElementVNode("picker",{mode:"selector",range:i.typeOptions,"range-key":"text",value:i.typeIndex,onChange:o[2]||(o[2]=(...e)=>l.onType&&l.onType(...e))},[e.createElementVNode("view",{class:"field field--single"},[e.createElementVNode("view",{class:"field__value"},e.toDisplayString(i.typeOptions[i.typeIndex].text),1)])],40,["range","value"]),e.createElementVNode("view",{class:"label row-left-with-icon"},[e.createElementVNode("image",{class:"label-icon",src:"/static/assets/icons/粉_备注.svg",mode:"aspectFit"}),e.createElementVNode("text",null,"备注（可选）")]),e.createElementVNode("view",{class:"field field--multi"},[e.createElementVNode("textarea",{class:"field__textarea",placeholder:"写点什么吧...",value:i.form.note,onInput:o[3]||(o[3]=(...e)=>l.onNote&&l.onNote(...e))},null,40,["value"])]),e.createElementVNode("view",{class:"row",style:{"margin-top":"18rpx"}},[e.createElementVNode("view",{class:"row-left row-left-with-icon"},[e.createElementVNode("image",{class:"top-icon",src:"/static/assets/icons/粉_置顶.svg",mode:"aspectFit"}),e.createElementVNode("view",{class:"muted"},"是否置顶")]),e.createElementVNode("switch",{checked:i.form.isTop,onChange:o[4]||(o[4]=(...e)=>l.onTop&&l.onTop(...e)),color:"#f6a5b5"},null,40,["checked"])]),e.createElementVNode("view",{class:"row",style:{"margin-top":"18rpx"}},[e.createElementVNode("view",{class:"row-left row-left-with-icon"},[e.createElementVNode("image",{class:"include-icon",src:"/static/assets/icons/粉_加一.svg",mode:"aspectFit"}),e.createElementVNode("view",{class:"muted"},"正数包含起始日")]),e.createElementVNode("switch",{checked:i.form.includeStart,onChange:o[5]||(o[5]=(...e)=>l.onIncludeStart&&l.onIncludeStart(...e)),color:"#f6a5b5"},null,40,["checked"])]),e.createElementVNode("view",{style:{"margin-top":"28rpx",display:"flex","justify-content":"center"}},[e.createElementVNode("button",{class:"btn",onClick:o[6]||(o[6]=(...e)=>l.save&&l.save(...e)),style:{width:"520rpx",height:"92rpx","line-height":"92rpx","border-radius":"16rpx"}},"保存")])])])}]]),h="/static/assets/icons/粉_跳转.svg",u="/static/assets/icons/粉_加号.svg",p="/static/assets/icons/粉_双爱心.svg",g="period_record_v1",v={cycleLength:28,periodLength:5,lutealDays:14};function w(e){return(e<10?"0":"")+e}function E(e){return`${e.getFullYear()}-${w(e.getMonth()+1)}-${w(e.getDate())}`}function N(e){const[t,a,o]=e.split("-").map(Number);return new Date(t,a-1,o)}function y(e,t){const a=new Date(e.getTime());return a.setDate(a.getDate()+t),a}function f(){const e=uni.getStorageSync(g);return e&&"object"==typeof e?e:{periodStarts:[],periodRecords:[],sexDates:[],sexRecords:{},settings:{...v},weightRecords:{}}}function V(e){uni.setStorageSync(g,e)}function x(e){if(e.periodStarts=e.periodStarts||[],e.periodRecords=e.periodRecords||[],e.weightRecords=e.weightRecords||{},e.sexDates=e.sexDates||[],e.sexRecords=e.sexRecords||{},0===e.periodRecords.length&&e.periodStarts.length>0){const t=e.periodStarts.slice().sort(((e,t)=>N(e)-N(t)));e.periodRecords=t.map((e=>({start:e,end:e})))}e.periodRecords=(e.periodRecords||[]).filter((e=>e&&e.start)).map((e=>({start:e.start,end:e.end?e.end:e.start})))}function k(e,t){const a=N(t),o=e.periodRecords||[];for(let s=0;s<o.length;s++){const e=o[s],t=N(e.start),n=N(e.end);if(a>=t&&a<=n)return{record:e,index:s}}return null}const S=a({data:()=>({weekNames:["日","一","二","三","四","五","六"],year:0,month:0,cells:[],selectedDate:"",periodSwitchOn:!1,touchStartX:0,touchStartY:0,showWeightPopup:!1,weightUnit:"kg",weightInput:"",weightDisplay:"0",hasWeight:!1,selectedWeightText:"",hasSex:!1,selectedSexText:"",hasPain:!1,selectedPainText:""}),onLoad(){const e=new Date;this.setData({year:e.getFullYear(),month:e.getMonth()+1,selectedDate:E(e)}),this.refreshAll()},onShow(){this.refreshAll()},methods:{noop(){},refreshAll(){const e=f();x(e);const t=this.selectedDate,a=e.periodRecords&&e.periodRecords.length>0?this.computeMaps(e):{periodDays:new Set,predPeriodDays:new Set,ovulationDays:new Set,ovulationDay:new Set},o=a.periodDays.has(t),s=this.buildCalendarCells(e,a),n=e.weightRecords&&e.weightRecords[t],i=!!(n&&"number"==typeof n.kg&&n.kg>0),l=i?n.kg.toFixed(2)+"公斤":"",c=(e.sexRecords&&e.sexRecords[t]?e.sexRecords[t]:[]).length||((e.sexDates||[]).includes(t)?1:0),r=c>0,d=r?`${c}次`:"";e.painRecords=e.painRecords||{};const m=(e.painRecords[t]||[]).length,h=m>0,u=h?`${m}次`:"";this.setData({cells:s,periodSwitchOn:o,hasWeight:i,selectedWeightText:l,hasSex:r,selectedSexText:d,hasPain:h,selectedPainText:u}),V(e)},buildCalendarCells(e,t){const{year:a,month:o,selectedDate:s}=this,n=t||{periodDays:new Set,predPeriodDays:new Set,ovulationDays:new Set,ovulationDay:new Set},i=new Set(e.sexDates||[]),l=e.sexRecords||{};function c(e){const t=l[e];return Array.isArray(t)&&t.length>0||i.has(e)}const r=new Date(a,o-1,1),d=r.getDay(),m=y(r,-d),h=E(new Date),u=[];for(let p=0;p<42;p++){const e=y(m,p),t=E(e);let a="";e.getMonth()===o-1||(a+=" other"),n.periodDays.has(t)?a+=" period":n.predPeriodDays.has(t)?a+=" pred":n.ovulationDays.has(t)&&(a+=" ovulation"),t===s&&(a+=" selected"),t===h&&(a+=" today"),u.push({dateStr:t,day:e.getDate(),cls:a.trim(),isToday:t===h,hasHeart:c(t),isOvulationDay:n.ovulationDay.has(t)})}return u},computeMaps(e){const t=e.settings||v,a=t.cycleLength||v.cycleLength,o=t.periodLength||v.periodLength,s=t.lutealDays||v.lutealDays;x(e);const n=new Set,i=new Set,l=new Set,c=new Set;(e.periodRecords||[]).slice().sort(((e,t)=>N(e.start)-N(t.start))).forEach((e=>{const t=N(e.start),a=N(e.end);if(a<t)return;const s=Math.floor((a-t)/864e5);for(let o=0;o<=s;o++)n.add(E(y(t,o)));const l=y(t,o-1);if(a<l){const e=y(a,1),t=Math.floor((l-e)/864e5);for(let a=0;a<=t;a++)i.add(E(y(e,a)))}}));const r=function(e){const t=(e.periodRecords||[]).slice();return 0===t.length?null:(t.sort(((e,t)=>N(e.start)-N(t.start))),t[t.length-1].start)}(e);if(r){const e=N(r);for(let t=1;t<=6;t++){const r=y(e,a*t);for(let e=0;e<o;e++){const t=E(y(r,e));n.has(t)||i.add(t)}const d=y(r,-s);c.add(E(d));for(let e=-2;e<=2;e++)l.add(E(y(d,e)))}}return{periodDays:n,predPeriodDays:i,ovulationDays:l,ovulationDay:c}},buildMonth(e,t){this.setData({year:e,month:t}),this.refreshAll()},goPrevMonth(){let e=this.year,t=this.month-1;t<1&&(t=12,e--),this.buildMonth(e,t)},goNextMonth(){let e=this.year,t=this.month+1;t>12&&(t=1,e++),this.buildMonth(e,t)},goToday(){const e=new Date;this.setData({year:e.getFullYear(),month:e.getMonth()+1,selectedDate:E(e)}),this.refreshAll()},onTapDate(e){const t=e.currentTarget.dataset.date;t&&(this.setData({selectedDate:t}),this.refreshAll())},onTogglePeriod(e){const t=e.detail.value,a=f();x(a);const o=this.selectedDate,s=(a.settings||v).periodLength||v.periodLength;if(t){if(k(a,o))return void this.refreshAll();const e=function(e,t,a){const o=N(t),s=e.periodRecords||[];for(let n=0;n<s.length;n++){const e=s[n],t=N(e.start),i=y(t,a-1);if(o>N(e.end)&&o>=t&&o<=i)return{record:e,index:n}}return null}(a,o,s);if(e)return e.record.end=o,V(a),void this.refreshAll();const t=function(e,t){const a=e.periodRecords||[];let o=null;for(let s=0;s<a.length;s++){const e=a[s];E(y(N(e.end),1))===t&&(!o||N(e.end)>N(o.record.end))&&(o={record:e,index:s})}return o}(a,o);if(t)return t.record.end=o,V(a),void this.refreshAll();a.periodRecords=a.periodRecords||[],a.periodRecords.push({start:o,end:o}),V(a),this.refreshAll()}else{const e=k(a,o);if(e){const t=e.record,s=N(t.start),n=N(t.end),i=N(o);if(t.start===t.end)a.periodRecords.splice(e.index,1);else if(i.getTime()===s.getTime())t.start=E(y(s,1));else if(i.getTime()===n.getTime())t.end=E(y(n,-1));else{const o={start:t.start,end:E(y(i,-1))},s={start:E(y(i,1)),end:t.end};a.periodRecords.splice(e.index,1,o,s)}V(a)}this.refreshAll()}},onTouchStart(e){e.touches&&e.touches.length&&this.setData({touchStartX:e.touches[0].clientX,touchStartY:e.touches[0].clientY})},onTouchEnd(e){if(!e.changedTouches||!e.changedTouches.length)return;const t=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY,o=t-this.touchStartX,s=a-this.touchStartY;Math.abs(o)<60||Math.abs(o)<1.2*Math.abs(s)||(o<0?this.goNextMonth():this.goPrevMonth())},goPeriodAnalysis(){uni.navigateTo({url:"/pages/subperiod/analysis/analysis"})},onGoPain(){const e=this.selectedDate;uni.navigateTo({url:`/pages/subperiod/pain/pain?date=${e}`})},onAddWeight(){uni.hideTabBar({animation:!0});const e=f();x(e);const t=this.selectedDate,a=e.weightRecords&&e.weightRecords[t],o=a&&"number"==typeof a.kg?a.kg:0;let s="";o>0&&(s=o.toFixed(2)),this.setData({showWeightPopup:!0,weightInput:s,weightDisplay:s||"0"})},onWeightCancel(){this.setData({showWeightPopup:!1}),uni.showTabBar({animation:!0})},onWeightKey(e){const t=e.currentTarget.dataset.k;let a=this.weightInput||"";if("."===t){if(a.includes("."))return;""===a&&(a="0"),a+="."}else"0"===a?a=t:a+=t;const o=a.match(/^(\d{0,3})(?:\.(\d{0,2}))?/);if(o){const e=o[1]||"",t=a.includes(".")?".":"",s=(a.split(".")[1]||"").slice(0,2);a=e+(t?t+s:"")}this.setData({weightInput:a,weightDisplay:""===a?"0":a})},onWeightDel(){let e=this.weightInput||"";e?(e=e.slice(0,-1),this.setData({weightInput:e,weightDisplay:""===e?"0":e})):this.setData({weightDisplay:"0"})},onWeightConfirm(){let e=(this.weightInput||"").trim();""===e&&(e=(this.weightDisplay||"").trim()),""===e&&(e="0");const t=parseFloat(e);if(isNaN(t))return void uni.showToast({title:"请输入有效体重",icon:"none"});const a=f();x(a);const o=this.selectedDate;if(a.weightRecords=a.weightRecords||{},0===t)return a.weightRecords[o]?(delete a.weightRecords[o],V(a),uni.showToast({title:"已删除体重记录",icon:"none"})):uni.showToast({title:"当天未记录体重",icon:"none"}),this.setData({showWeightPopup:!1}),uni.showTabBar({animation:!0}),void this.refreshAll();if(t<0)return void uni.showToast({title:"请输入有效体重",icon:"none"});const s=t;a.weightRecords[o]={kg:Number(s.toFixed(2))},V(a),this.setData({showWeightPopup:!1}),uni.showTabBar({animation:!0}),uni.showToast({title:"已记录体重",icon:"none"}),this.refreshAll()},onGoLove(){const e=this.selectedDate;uni.navigateTo({url:`/pages/subperiod/love/love?date=${e}`})}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"page-wrap"},[e.createElementVNode("scroll-view",{class:"page","scroll-y":!0},[e.createElementVNode("view",{class:"cal-header"},[e.createElementVNode("view",{class:"nav-btn",onClick:a[0]||(a[0]=(...e)=>i.goPrevMonth&&i.goPrevMonth(...e))},"‹"),e.createElementVNode("view",{class:"header-center"},[e.createElementVNode("text",{class:"ym-text"},e.toDisplayString(n.year)+"年"+e.toDisplayString(n.month)+"月",1),e.createElementVNode("view",{class:"today-btn",onClick:a[1]||(a[1]=(...e)=>i.goToday&&i.goToday(...e))},"回到今天")]),e.createElementVNode("view",{class:"nav-btn",onClick:a[2]||(a[2]=(...e)=>i.goNextMonth&&i.goNextMonth(...e))},"›")]),e.createElementVNode("view",{class:"week-row"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.weekNames,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"week-item",key:a},e.toDisplayString(t),1)))),128))]),e.createElementVNode("view",{class:"grid",onTouchstart:a[4]||(a[4]=(...e)=>i.onTouchStart&&i.onTouchStart(...e)),onTouchend:a[5]||(a[5]=(...e)=>i.onTouchEnd&&i.onTouchEnd(...e))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.cells,((t,o)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass("cell "+t.cls),onClick:a[3]||(a[3]=(...e)=>i.onTapDate&&i.onTapDate(...e)),"data-date":t.dateStr,key:o},[e.createElementVNode("view",{class:"top-mark"},[t.hasHeart?(e.openBlock(),e.createElementBlock("text",{key:0,class:"heart"},"♡")):e.createCommentVNode("",!0),t.isOvulationDay?(e.openBlock(),e.createElementBlock("view",{key:1,class:"ovu-dot"})):e.createCommentVNode("",!0)]),e.createElementVNode("text",{class:"num"},e.toDisplayString(t.day),1),t.isToday?(e.openBlock(),e.createElementBlock("text",{key:0,class:"today-tag"},"今天")):e.createCommentVNode("",!0)],10,["data-date"])))),128))],32),e.createElementVNode("view",{class:"legend"},[e.createElementVNode("view",{class:"leg-item"},[e.createElementVNode("view",{class:"box b-period"}),e.createElementVNode("text",null,"月经期")]),e.createElementVNode("view",{class:"leg-item"},[e.createElementVNode("view",{class:"box b-pred"}),e.createElementVNode("text",null,"预测经期")]),e.createElementVNode("view",{class:"leg-item"},[e.createElementVNode("view",{class:"box b-ovu"}),e.createElementVNode("text",null,"排卵期")]),e.createElementVNode("view",{class:"leg-item"},[e.createElementVNode("view",{class:"dot"}),e.createElementVNode("text",null,"排卵日")])]),e.createElementVNode("view",{class:"mini-card tappable",onClick:a[6]||(a[6]=(...e)=>i.goPeriodAnalysis&&i.goPeriodAnalysis(...e))},[e.createElementVNode("view",{class:"mini-left"},[e.createElementVNode("image",{class:"mini-icon",src:"/static/assets/icons/粉_分析.svg",mode:"aspectFit"}),e.createElementVNode("text",{class:"mini-title"},"经期健康分析")]),e.createElementVNode("image",{class:"mini-go",src:h,mode:"aspectFit"})]),e.createElementVNode("view",{class:"panel"},[e.createElementVNode("view",{class:"row"},[e.createElementVNode("view",{class:"row-left row-left-with-icon"},[e.createElementVNode("image",{class:"row-icon",src:"/static/assets/icons/粉_水滴.svg",mode:"aspectFit"}),e.createElementVNode("text",{class:"row-title"},"月经来了")]),e.createElementVNode("switch",{checked:n.periodSwitchOn,color:"#ff4d6d",onChange:a[7]||(a[7]=(...e)=>i.onTogglePeriod&&i.onTogglePeriod(...e))},null,40,["checked"])]),e.createElementVNode("view",{class:"row tappable",onClick:a[8]||(a[8]=(...e)=>i.onGoPain&&i.onGoPain(...e))},[e.createElementVNode("view",{class:"row-left row-left-with-icon"},[e.createElementVNode("image",{class:"row-icon",src:"/static/assets/icons/粉_疼.svg",mode:"aspectFit"}),e.createElementVNode("text",{class:"row-title"},"痛经")]),e.createElementVNode("view",{class:"row-right"},[n.selectedPainText?(e.openBlock(),e.createElementBlock("text",{key:0,class:"row-value"},e.toDisplayString(n.selectedPainText),1)):e.createCommentVNode("",!0),e.createElementVNode("image",{class:"plus-icon",src:"/static/assets/icons/"+(n.hasPain?"粉_修改.svg":"粉_加号.svg"),mode:"aspectFit"},null,8,["src"])])]),e.createElementVNode("view",{class:"row tappable",onClick:a[9]||(a[9]=(...e)=>i.onAddWeight&&i.onAddWeight(...e))},[e.createElementVNode("view",{class:"row-left row-left-with-icon"},[e.createElementVNode("image",{class:"row-icon",src:"/static/assets/icons/粉_体重.svg",mode:"aspectFit"}),e.createElementVNode("text",{class:"row-title"},"体重")]),e.createElementVNode("view",{class:"row-right"},[n.hasWeight?(e.openBlock(),e.createElementBlock("text",{key:0,class:"row-value"},e.toDisplayString(n.selectedWeightText),1)):e.createCommentVNode("",!0),n.hasWeight?(e.openBlock(),e.createElementBlock("image",{key:2,class:"plus-icon",src:"/static/assets/icons/粉_修改.svg",mode:"aspectFit"})):(e.openBlock(),e.createElementBlock("image",{key:1,class:"plus-icon",src:u,mode:"aspectFit"}))])]),e.createElementVNode("view",{class:"row tappable",onClick:a[10]||(a[10]=(...e)=>i.onGoLove&&i.onGoLove(...e))},[e.createElementVNode("view",{class:"row-left row-left-with-icon"},[e.createElementVNode("image",{class:"row-icon",src:p,mode:"aspectFit"}),e.createElementVNode("text",{class:"row-title"},"爱爱")]),e.createElementVNode("view",{class:"row-right"},[n.selectedSexText?(e.openBlock(),e.createElementBlock("text",{key:0,class:"row-value"},e.toDisplayString(n.selectedSexText),1)):e.createCommentVNode("",!0),e.createElementVNode("image",{class:"plus-icon",src:"/static/assets/icons/"+(n.hasSex?"粉_修改.svg":"粉_加号.svg")},null,8,["src"])])])]),e.createElementVNode("view",{class:"bottom-spacer"})]),n.showWeightPopup?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",{class:"sheet-mask",onClick:a[11]||(a[11]=(...e)=>i.onWeightCancel&&i.onWeightCancel(...e)),onTouchmove:a[12]||(a[12]=e.withModifiers(((...e)=>i.noop&&i.noop(...e)),["stop","prevent"]))},null,32),e.createElementVNode("view",{class:"sheet",onClick:a[27]||(a[27]=e.withModifiers(((...e)=>i.noop&&i.noop(...e)),["stop","prevent"])),onTouchmove:a[28]||(a[28]=e.withModifiers(((...e)=>i.noop&&i.noop(...e)),["stop","prevent"]))},[e.createElementVNode("view",{class:"sheet-header"},[e.createElementVNode("text",{class:"sheet-btn",onClick:a[13]||(a[13]=(...e)=>i.onWeightCancel&&i.onWeightCancel(...e))},"取消"),e.createElementVNode("text",{class:"sheet-title"},"体重"),e.createElementVNode("text",{class:"sheet-btn sheet-btn-primary",onClick:a[14]||(a[14]=(...e)=>i.onWeightConfirm&&i.onWeightConfirm(...e))},"确定")]),e.createElementVNode("view",{class:"sheet-value"},[e.createElementVNode("text",{class:"value-num"},e.toDisplayString(n.weightDisplay),1),e.createElementVNode("text",{class:"value-unit"},e.toDisplayString("kg"===n.weightUnit?"公斤":"斤"),1)]),e.createElementVNode("view",{class:"sheet-keypad"},[e.createElementVNode("view",{class:"key-row"},[e.createElementVNode("view",{class:"key","data-k":"1",onClick:a[15]||(a[15]=(...e)=>i.onWeightKey&&i.onWeightKey(...e))},"1"),e.createElementVNode("view",{class:"key","data-k":"2",onClick:a[16]||(a[16]=(...e)=>i.onWeightKey&&i.onWeightKey(...e))},"2"),e.createElementVNode("view",{class:"key","data-k":"3",onClick:a[17]||(a[17]=(...e)=>i.onWeightKey&&i.onWeightKey(...e))},"3")]),e.createElementVNode("view",{class:"key-row"},[e.createElementVNode("view",{class:"key","data-k":"4",onClick:a[18]||(a[18]=(...e)=>i.onWeightKey&&i.onWeightKey(...e))},"4"),e.createElementVNode("view",{class:"key","data-k":"5",onClick:a[19]||(a[19]=(...e)=>i.onWeightKey&&i.onWeightKey(...e))},"5"),e.createElementVNode("view",{class:"key","data-k":"6",onClick:a[20]||(a[20]=(...e)=>i.onWeightKey&&i.onWeightKey(...e))},"6")]),e.createElementVNode("view",{class:"key-row"},[e.createElementVNode("view",{class:"key","data-k":"7",onClick:a[21]||(a[21]=(...e)=>i.onWeightKey&&i.onWeightKey(...e))},"7"),e.createElementVNode("view",{class:"key","data-k":"8",onClick:a[22]||(a[22]=(...e)=>i.onWeightKey&&i.onWeightKey(...e))},"8"),e.createElementVNode("view",{class:"key","data-k":"9",onClick:a[23]||(a[23]=(...e)=>i.onWeightKey&&i.onWeightKey(...e))},"9")]),e.createElementVNode("view",{class:"key-row"},[e.createElementVNode("view",{class:"key","data-k":".",onClick:a[24]||(a[24]=(...e)=>i.onWeightKey&&i.onWeightKey(...e))},"."),e.createElementVNode("view",{class:"key","data-k":"0",onClick:a[25]||(a[25]=(...e)=>i.onWeightKey&&i.onWeightKey(...e))},"0"),e.createElementVNode("view",{class:"key key-del",onClick:a[26]||(a[26]=(...e)=>i.onWeightDel&&i.onWeightDel(...e))},[e.createElementVNode("image",{class:"key-del-icon",src:"/static/assets/icons/键盘删除.svg",mode:"aspectFit"})])])])],32)])):e.createCommentVNode("",!0)])}]]);function D(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}const b=require("../../utils/storage"),T="period_record_v1",C={cycleLength:28,periodLength:5,lutealDays:14};function _(e){const t=uni.getStorageSync(T)||{},a=t&&t.settings?t.settings:{};t.settings={...C,...a,...e},uni.setStorageSync(T,t)}const B=a({data:()=>({draftAvatarUrl:"",defaultAvatar:"/static/assets/images/default-avatar.png",userProfile:null,isLoggedIn:!1,coupleStartDate:"",showSheet:!1,draftAvatarUrl:"",draftNickName:"",periodLength:C.periodLength,cycleLength:C.cycleLength,periodOptions:[],cycleOptions:[],periodIndex:0,cycleIndex:0}),onShow(){const e=b.getUserProfile?b.getUserProfile():null,t=!(!e||!e.nickName),a=function(){const e=uni.getStorageSync(T),t=e&&e.settings?e.settings:{};return{cycleLength:Number(t.cycleLength||C.cycleLength),periodLength:Number(t.periodLength||C.periodLength)}}(),o=[];for(let l=2;l<=20;l++)o.push(l);const s=[];for(let l=16;l<=60;l++)s.push(l);const n=Math.max(0,o.indexOf(a.periodLength)),i=Math.max(0,s.indexOf(a.cycleLength));this.setData({userProfile:t?e:null,isLoggedIn:t,coupleStartDate:b.getCoupleStartDate&&b.getCoupleStartDate()||"",periodLength:a.periodLength,cycleLength:a.cycleLength,periodOptions:o,cycleOptions:s,periodIndex:n,cycleIndex:i})},onShareAppMessage:()=>({title:"重要日子：记录我们在一起的每一天",path:"/pages/home/home"}),methods:{openLoginSheet(){const e=this.userProfile||{};this.setData({showSheet:!0,draftAvatarUrl:e.avatarUrl||"",draftNickName:e.nickName||""})},closeSheet(){this.setData({showSheet:!1})},onChooseAvatar(e){const t=e.detail&&e.detail.avatarUrl?e.detail.avatarUrl:"";t&&this.setData({draftAvatarUrl:t})},onNickInput(e){this.setData({draftNickName:e.detail.value||""})},confirmLogin(){const e=(this.draftNickName||"").trim(),t=this.draftAvatarUrl||"";if(!e)return void uni.showToast({title:"请先填写昵称",icon:"none"});const a={nickName:e,avatarUrl:t};b.setUserProfile(a),this.setData({userProfile:a,isLoggedIn:!0,showSheet:!1}),uni.showToast({title:"已保存",icon:"success"})},logout(){D("log","at pages/me/me.vue:277","logout tapped"),uni.showModal({title:"退出登录",content:"退出后将清空所有本地数据：在一起日期、重要日子列表、经期记录等。",confirmText:"退出",confirmColor:"#e5484d",success:e=>{if(D("log","at pages/me/me.vue:284","showModal success:",e),e.confirm){try{if(b&&"function"==typeof b.clearAllLocalData){b.clearAllLocalData();try{uni.removeStorageSync(T)}catch(t){D("log","at pages/me/me.vue:295","CatchClause",t),D("log","at pages/me/me.vue:296","CatchClause",t)}D("log","at pages/me/me.vue:298","clearAllLocalData ok")}else{D("log","at pages/me/me.vue:300","clearAllLocalData not found, fallback remove keys"),uni.removeStorageSync("USER_PROFILE"),uni.removeStorageSync("COUPLE_START_DATE"),uni.removeStorageSync("IMPORTANT_DAYS_LIST"),uni.removeStorageSync("userProfile");try{uni.removeStorageSync(T)}catch(t){D("log","at pages/me/me.vue:309","CatchClause",t),D("log","at pages/me/me.vue:310","CatchClause",t)}}}catch(a){D("log","at pages/me/me.vue:314","CatchClause",a),D("log","at pages/me/me.vue:315","CatchClause",a),D("error","at pages/me/me.vue:316","clear local data error:",a);try{uni.clearStorageSync(),D("log","at pages/me/me.vue:319","wx.clearStorageSync ok")}catch(o){D("log","at pages/me/me.vue:321","CatchClause",o),D("log","at pages/me/me.vue:322","CatchClause",o),D("error","at pages/me/me.vue:323","wx.clearStorageSync failed:",o)}}this.setData({userProfile:null,isLoggedIn:!1,coupleStartDate:"",draftAvatarUrl:"",draftNickName:"",showSheet:!1}),uni.showToast({title:"已清空",icon:"success"}),uni.switchTab({url:"/pages/home/home",success:()=>D("log","at pages/me/me.vue:340","switchTab ok"),fail:e=>{D("error","at pages/me/me.vue:342","switchTab failed:",e),uni.reLaunch({url:"/pages/home/home"})}})}},fail:e=>{D("error","at pages/me/me.vue:350","showModal failed:",e),uni.showToast({title:"弹窗调用失败",icon:"none"})},complete:()=>{D("log","at pages/me/me.vue:357","showModal complete")}})},onPickDate(e){const t=e.detail.value;b.setCoupleStartDate(t),this.setData({coupleStartDate:t}),uni.showToast({title:"已保存",icon:"success"})},onPickPeriodLength(e){const t=Number(e.detail.value),a=this.periodOptions[t];_({periodLength:a}),this.setData({periodLength:a,periodIndex:t}),uni.showToast({title:"已保存",icon:"success"})},onPickCycleLength(e){const t=Number(e.detail.value),a=this.cycleOptions[t];_({cycleLength:a}),this.setData({cycleLength:a,cycleIndex:t}),uni.showToast({title:"已保存",icon:"success"})},goAbout(){uni.navigateTo({url:"/pages/about/about"})},noop(){}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"card user-card"},[e.createElementVNode("image",{class:"avatar",src:n.userProfile&&n.userProfile.avatarUrl?n.userProfile.avatarUrl:n.defaultAvatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("view",{class:"nickname"},e.toDisplayString(n.userProfile&&n.userProfile.nickName?n.userProfile.nickName:"未登录"),1),e.createElementVNode("view",{class:"desc"},e.toDisplayString(n.isLoggedIn?"已使用本地存储":"登录后可使用头像与昵称"),1)]),e.createElementVNode("button",{class:"wx-login-btn",onClick:a[0]||(a[0]=(...e)=>i.openLoginSheet&&i.openLoginSheet(...e))},e.toDisplayString(n.isLoggedIn?"切换/登出":"登录"),1)]),e.createElementVNode("view",{class:"card list-card"},[e.createElementVNode("view",{class:"row"},[e.createElementVNode("view",{class:"row-left"},[e.createElementVNode("view",{class:"row-title"},"我们在一起的日期"),e.createElementVNode("view",{class:"row-sub"},"起始日："+e.toDisplayString(n.coupleStartDate?n.coupleStartDate:"未设置"),1)]),e.createElementVNode("picker",{mode:"date",value:n.coupleStartDate,onChange:a[1]||(a[1]=(...e)=>i.onPickDate&&i.onPickDate(...e))},[e.createElementVNode("button",{class:"row-action"},"修改")],40,["value"])]),e.createElementVNode("view",{class:"divider"}),e.createElementVNode("view",{class:"row"},[e.createElementVNode("view",{class:"row-left"},[e.createElementVNode("view",{class:"row-title"},"经期长度："+e.toDisplayString(n.periodLength)+"天",1),e.createElementVNode("view",{class:"row-sub"},"您的月经大概几天")]),e.createElementVNode("picker",{mode:"selector",range:n.periodOptions,value:n.periodIndex,onChange:a[2]||(a[2]=(...e)=>i.onPickPeriodLength&&i.onPickPeriodLength(...e))},[e.createElementVNode("button",{class:"row-action"},"修改")],40,["range","value"])]),e.createElementVNode("view",{class:"divider"}),e.createElementVNode("view",{class:"row"},[e.createElementVNode("view",{class:"row-left"},[e.createElementVNode("view",{class:"row-title"},"周期长度："+e.toDisplayString(n.cycleLength)+"天",1),e.createElementVNode("view",{class:"row-sub"},"两次月经开始日大概间隔多久")]),e.createElementVNode("picker",{mode:"selector",range:n.cycleOptions,value:n.cycleIndex,onChange:a[3]||(a[3]=(...e)=>i.onPickCycleLength&&i.onPickCycleLength(...e))},[e.createElementVNode("button",{class:"row-action"},"修改")],40,["range","value"])]),e.createElementVNode("view",{class:"divider"}),e.createElementVNode("view",{class:"row"},[e.createElementVNode("view",{class:"row-left"},[e.createElementVNode("view",{class:"row-title"},"分享“我和你的重要时光”"),e.createElementVNode("view",{class:"row-sub"},"发给 TA 一起用")]),e.createElementVNode("button",{class:"row-action","open-type":"share"},"分享")]),e.createElementVNode("view",{class:"divider"}),e.createElementVNode("view",{class:"row",onClick:a[4]||(a[4]=(...e)=>i.goAbout&&i.goAbout(...e))},[e.createElementVNode("view",{class:"row-left"},[e.createElementVNode("view",{class:"row-title"},"关于"),e.createElementVNode("view",{class:"row-sub"},"版本信息与说明")]),e.createElementVNode("button",{class:"row-action"},"查看")])]),n.showSheet?(e.openBlock(),e.createElementBlock("view",{key:0,class:"mask",onTouchmove:a[10]||(a[10]=e.withModifiers(((...e)=>i.noop&&i.noop(...e)),["stop","prevent"])),onClick:a[11]||(a[11]=e.withModifiers(((...e)=>i.closeSheet&&i.closeSheet(...e)),["stop","prevent"]))},[e.createElementVNode("view",{class:"sheet",onClick:a[9]||(a[9]=e.withModifiers(((...e)=>i.noop&&i.noop(...e)),["stop","prevent"]))},[e.createElementVNode("view",{class:"sheet-header"},[e.createElementVNode("view",{class:"sheet-handle"}),e.createElementVNode("view",{class:"sheet-title"},"登录")]),e.createElementVNode("view",{class:"sheet-body"},[e.createElementVNode("view",{class:"field avatar-field"},[n.draftAvatarUrl?(e.openBlock(),e.createElementBlock("view",{key:1,class:"avatar-only-wrap"},[e.createElementVNode("image",{class:"avatar-only",src:n.draftAvatarUrl,mode:"aspectFill"},null,8,["src"])])):(e.openBlock(),e.createElementBlock("view",{key:0,class:"field-main"},[e.createElementVNode("view",{class:"field-label"},"头像"),e.createElementVNode("view",{class:"field-value placeholder"},"点击选择")])),e.createElementVNode("button",{class:"cover-btn","open-type":"chooseAvatar",onChooseavatar:a[5]||(a[5]=(...e)=>i.onChooseAvatar&&i.onChooseAvatar(...e))},null,32)]),e.createElementVNode("view",{class:"field nickname-field"},[n.draftNickName?(e.openBlock(),e.createElementBlock("view",{key:1,class:"nickname-only"},e.toDisplayString(n.draftNickName),1)):(e.openBlock(),e.createElementBlock("view",{key:0,class:"field-main"},[e.createElementVNode("view",{class:"field-label"},"昵称"),e.createElementVNode("input",{class:"field-input",type:"nickname",placeholder:"使用微信昵称（或手动输入）",value:n.draftNickName,onInput:a[6]||(a[6]=(...e)=>i.onNickInput&&i.onNickInput(...e))},null,40,["value"])]))]),e.createElementVNode("button",{class:"action primary",onClick:a[7]||(a[7]=(...e)=>i.confirmLogin&&i.confirmLogin(...e))},"确定"),n.isLoggedIn?(e.openBlock(),e.createElementBlock("button",{key:0,class:"action danger",onClick:a[8]||(a[8]=(...e)=>i.logout&&i.logout(...e))},"退出登录")):e.createCommentVNode("",!0)])])],32)):e.createCommentVNode("",!0)])}]]),L=require("../../utils/storage"),A=require("../../utils/date");const P=a({data:()=>({id:"",item:null,typeText:"",heroLabel:"",heroSub:"",heroNumber:"0",heroUnit:"天"}),onLoad(e){const t=e.id||"";if(!t)return uni.showToast({title:"缺少参数",icon:"none"}),void uni.switchTab({url:"/pages/home/home"});this.setData({id:t}),this.refresh()},onShow(){this.id&&this.refresh()},methods:{refresh(){const e=L.getList().find((e=>e.id===this.id));if(!e)return uni.showToast({title:"记录不存在或已删除",icon:"none"}),void uni.switchTab({url:"/pages/home/home"});const t=function(e,t){let a=A.daysTo(e);return 0===a?{heroLabel:"就是今天！",heroSub:"别忘了好好庆祝一下～",heroNumber:"0",heroUnit:"days"}:a>0?(t&&(a+=1),{heroLabel:"还有",heroSub:"倒计时进行中",heroNumber:String(a),heroUnit:"天"}):{heroLabel:"已经",heroSub:"这一天已经过去",heroNumber:String(Math.abs(a)),heroUnit:"天"}}(e.date,e.includeStart);var a;this.setData({item:e,typeText:(a=e.type,"anniversary"===a?"纪念日":"birthday"===a?"生日":"其他"),...t})},goEdit(){uni.navigateTo({url:"/pages/editDetail/editDetail?id="+this.id})},goHome(){uni.switchTab({url:"/pages/home/home"})},remove(){uni.showModal({title:"确认删除",content:"删除后无法恢复，确定要删除吗？",success:e=>{if(!e.confirm)return;const t=L.getList();L.setList(t.filter((e=>e.id!==this.id))),uni.showToast({title:"已删除",icon:"success"}),uni.switchTab({url:"/pages/home/home"})}})}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"card detail-card"},[e.createElementVNode("view",{class:"top-row"},[e.createElementVNode("view",{class:"detail-title"},e.toDisplayString(n.item.title),1),n.item.isTop?(e.openBlock(),e.createElementBlock("view",{key:0,class:"tag"},"置顶")):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"meta"},[e.createElementVNode("view",{class:"meta-row"},[e.createElementVNode("text",{class:"meta-label"},"日期："),e.createElementVNode("text",{class:"meta-value"},e.toDisplayString(n.item.date),1)]),e.createElementVNode("view",{class:"meta-row"},[e.createElementVNode("text",{class:"meta-label"},"类型："),e.createElementVNode("text",{class:"meta-value"},e.toDisplayString(n.typeText),1)]),n.item.note?(e.openBlock(),e.createElementBlock("view",{key:0,class:"note"},[e.createElementVNode("view",{class:"note-title"},"备注"),e.createElementVNode("view",{class:"note-text"},e.toDisplayString(n.item.note),1)])):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"card hero-card"},[e.createElementVNode("view",{class:"hero-left"},[e.createElementVNode("view",{class:"hero-label"},e.toDisplayString(n.heroLabel),1),e.createElementVNode("view",{class:"hero-sub"},e.toDisplayString(n.heroSub),1)]),e.createElementVNode("view",{class:"hero-right"},[e.createElementVNode("view",{class:"hero-number"},e.toDisplayString(n.heroNumber),1),e.createElementVNode("view",{class:"hero-unit"},e.toDisplayString(n.heroUnit),1)])]),e.createElementVNode("view",{class:"actions"},[e.createElementVNode("button",{class:"btn btn-secondary action-btn",onClick:a[0]||(a[0]=(...e)=>i.goEdit&&i.goEdit(...e))},"编辑"),e.createElementVNode("button",{class:"btn btn-danger action-btn",onClick:a[1]||(a[1]=(...e)=>i.remove&&i.remove(...e))},"删除")])])}]]);const I=a({data:()=>({version:"0.0.1"}),onLoad(){},methods:{onIntro(){uni.navigateTo({url:"/pages/subabout/intro/intro"})},onFeedback(){},onChangelog(){uni.navigateTo({url:"/pages/subabout/changelog/changelog"})},onTapagreement(){uni.navigateTo({url:"/pages/subabout/agreement/agreement"})},onTapPrivacy(){uni.navigateTo({url:"/pages/subabout/privacy/privacy"})}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{class:"about-page"},[e.createElementVNode("view",{class:"app-header"},[e.createElementVNode("image",{class:"app-logo",src:"/static/assets/images/app.png",mode:"aspectFit"}),e.createElementVNode("text",{class:"app-version"},"Version: "+e.toDisplayString(n.version),1)]),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"card-item","hover-class":"card-item-active",onClick:a[0]||(a[0]=(...e)=>i.onIntro&&i.onIntro(...e))},[e.createElementVNode("view",{class:"left"},[e.createElementVNode("image",{class:"item-icon",src:"/static/assets/icons/粉_功能介绍.svg"}),e.createElementVNode("text",{class:"item-text"},"功能介绍")]),e.createElementVNode("text",{class:"arrow"},"›")]),e.createElementVNode("view",{class:"divider"}),e.createElementVNode("view",{class:"card-item","hover-class":"card-item-active",onClick:a[1]||(a[1]=(...e)=>i.onFeedback&&i.onFeedback(...e))},[e.createElementVNode("view",{class:"left"},[e.createElementVNode("image",{class:"item-icon",src:"/static/assets/icons/粉_帮助反馈.svg"}),e.createElementVNode("text",{class:"item-text"},"帮助反馈")]),e.createElementVNode("text",{class:"arrow"},"›")]),e.createElementVNode("view",{class:"divider"}),e.createElementVNode("view",{class:"card-item","hover-class":"card-item-active",onClick:a[2]||(a[2]=(...e)=>i.onChangelog&&i.onChangelog(...e))},[e.createElementVNode("view",{class:"left"},[e.createElementVNode("image",{class:"item-icon",src:"/static/assets/icons/粉_更新日志.svg"}),e.createElementVNode("text",{class:"item-text"},"更新日志")]),e.createElementVNode("text",{class:"arrow"},"›")])])]),e.createElementVNode("view",{class:"about-footer"},[e.createElementVNode("view",{class:"footer-links"},[e.createElementVNode("text",{class:"footer-link",onClick:a[3]||(a[3]=(...e)=>i.onTapagreement&&i.onTapagreement(...e))},"服务协议"),e.createElementVNode("text",{class:"footer-sep"},"|"),e.createElementVNode("text",{class:"footer-link",onClick:a[4]||(a[4]=(...e)=>i.onTapPrivacy&&i.onTapPrivacy(...e))},"隐私政策")]),e.createElementVNode("view",{class:"footer-text"},[e.createElementVNode("text",null,"Copyright© 2025-2026 Sebastian. All Rights Reserved")]),e.createElementVNode("view",{class:"footer-text"},[e.createElementVNode("text",null,"ICP 备案号：苏ICP备2025153648号-2X")]),e.createElementVNode("view",{class:"footer-text"},[e.createElementVNode("text")]),e.createElementVNode("view",{class:"safe-spacer"})])])}]]),R=require("../../utils/storage"),M=require("../../utils/date");const F=a({data:()=>({editId:"",typeOptions:[{value:"anniversary",text:"纪念日"},{value:"birthday",text:"生日"},{value:"other",text:"其他"}],typeIndex:0,form:{title:"",date:"",type:"anniversary",note:"",isTop:!1,includeStart:!1},text:""}),onLoad(e){const t=e&&e.id?e.id:"";if(!t)return uni.showToast({title:"缺少参数",icon:"none"}),void uni.navigateBack();this.loadEdit(t)},methods:{loadEdit(e){const t=R.getList().find((t=>t.id===e));if(!t)return uni.showToast({title:"未找到数据",icon:"none"}),void uni.navigateBack();const a=this.typeOptions.findIndex((e=>e.value===t.type));this.setData({editId:e,typeIndex:a>=0?a:0,form:{title:t.title||"",date:t.date||M.todayStr(),type:t.type||"anniversary",note:t.note||"",isTop:!!t.isTop,includeStart:!!t.includeStart}}),uni.setNavigationBarTitle({title:"修改重要日子"})},onTitle(e){this.setData({form:{...this.form,title:e.detail.value}})},onDate(e){this.setData({form:{...this.form,date:e.detail.value}})},onType(e){const t=Number(e.detail.value)||0,a=this.typeOptions[t].value;this.setData({typeIndex:t,form:{...this.form,type:a}})},onNote(e){this.setData({form:{...this.form,note:e.detail.value}})},onTop(e){this.setData({form:{...this.form,isTop:e.detail.value}})},onIncludeStart(e){this.setData({form:{...this.form,includeStart:e.detail.value}})},validate(){const e=this.form;return e.title&&e.title.trim()?e.date?"":"请选择日期":"请填写标题"},save(){const e=this.validate();if(e)return void uni.showToast({title:e,icon:"none"});const t=R.getList(),a=Date.now(),o=this.form,s=t.map((e=>e.id!==this.editId?e:{...e,...o,updatedAt:a}));R.setList(s),uni.showToast({title:"已保存",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),300)}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container page-bottom-space"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"label"},"标题"),e.createElementVNode("view",{class:"field field--single"},[e.createElementVNode("input",{class:"field__input",placeholder:"例如：在一起一周年",value:n.form.title,onInput:a[0]||(a[0]=(...e)=>i.onTitle&&i.onTitle(...e))},null,40,["value"])]),e.createElementVNode("view",{class:"label"},"日期"),e.createElementVNode("picker",{mode:"date",value:n.form.date,onChange:a[1]||(a[1]=(...e)=>i.onDate&&i.onDate(...e))},[e.createElementVNode("view",{class:"field field--single"},[e.createElementVNode("view",{class:e.normalizeClass("field__value "+(n.form.date?"":"field__placeholder"))},e.toDisplayString(n.form.date||"请选择日期"),3)])],40,["value"]),e.createElementVNode("view",{class:"label"},"类型"),e.createElementVNode("picker",{mode:"selector",range:n.typeOptions,"range-key":"text",value:n.typeIndex,onChange:a[2]||(a[2]=(...e)=>i.onType&&i.onType(...e))},[e.createElementVNode("view",{class:"field field--single"},[e.createElementVNode("view",{class:"field__value"},e.toDisplayString(n.typeOptions[n.typeIndex].text),1)])],40,["range","value"]),e.createElementVNode("view",{class:"label"},"备注（可选）"),e.createElementVNode("view",{class:"field field--multi"},[e.createElementVNode("textarea",{class:"field__textarea",placeholder:"写点说明...",value:n.form.note,onInput:a[3]||(a[3]=(...e)=>i.onNote&&i.onNote(...e))},null,40,["value"])]),e.createElementVNode("view",{class:"row",style:{"margin-top":"18rpx"}},[e.createElementVNode("view",{class:"muted"},"是否置顶"),e.createElementVNode("switch",{checked:n.form.isTop,onChange:a[4]||(a[4]=(...e)=>i.onTop&&i.onTop(...e)),color:"#f6a5b5"},null,40,["checked"])]),e.createElementVNode("view",{class:"row",style:{"margin-top":"18rpx"}},[e.createElementVNode("view",{class:"muted"},"正数包含起始日"),e.createElementVNode("switch",{checked:n.form.includeStart,onChange:a[5]||(a[5]=(...e)=>i.onIncludeStart&&i.onIncludeStart(...e)),color:"#f6a5b5"},null,40,["checked"])]),e.createElementVNode("view",{style:{"margin-top":"28rpx",display:"flex","justify-content":"center"}},[e.createElementVNode("button",{class:"btn",onClick:a[6]||(a[6]=(...e)=>i.save&&i.save(...e)),style:{width:"520rpx",height:"92rpx","line-height":"92rpx","border-radius":"16rpx"}},"保存")])])])}]]);const $=a({data:()=>({}),onLoad(e){},onReady(){},onShow(){},onHide(){},onUnload(){},onPullDownRefresh(){},onReachBottom(){},onShareAppMessage(){},methods:{}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"container"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"title"},"隐私保护指引"),e.createElementVNode("view",{class:"paragraph"},"本指引是《我和你的重要时光》小程序开发者（以下简称“开发者”）为处理你的个人信息而制定。"),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"1. 开发者处理的信息"),e.createElementVNode("view",{class:"item"},"• 开发者收集你选中的文件，用于登录账号。"),e.createElementVNode("view",{class:"item"},"• 开发者收集你选中的照片或视频信息，用于登录账号、作为用户个人头像/背景。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"2. 未成年人保护"),e.createElementVNode("view",{class:"paragraph"}," 根据相关法律法规的规定，若你是14周岁以下的未成年人，你需要和你的监护人共同阅读并同意本指引，并在征得监护人同意后继续使用小程序服务。开发者将根据法律法规的规定及本指引内容， 处理经监护人同意而收集的未成年人用户信息，并通过【本指引你的权益部分】披露的内容保障未成年人在个人信息处理活动中的各项权利。 ")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"3. 你的权益"),e.createElementVNode("view",{class:"item"},"3.1 关于你的个人信息，你可以通过以下方式与开发者联系，行使查询、复制、更正、删除等法定权利。"),e.createElementVNode("view",{class:"item"}," 3.2 若你在小程序中注册了账号，你可以通过以下方式与开发者联系，申请注销你在小程序中使用的账号。在受理你的申请后，开发者承诺在十五个工作日内完成核查和处理，并按照法律法规要求处理你的相关信息。 "),e.createElementVNode("view",{class:"contact"},"联系电话：13776913405")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"4. 开发者对信息的存储"),e.createElementVNode("view",{class:"paragraph"},"开发者承诺，除法律法规另有规定外，对你的信息的保存期限应当为实现处理目的所必需的最短时间。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"5. 信息的使用规则"),e.createElementVNode("view",{class:"item"},"5.1 开发者将会在本指引所明示的用途内使用收集的信息。"),e.createElementVNode("view",{class:"item"},"5.2 如开发者使用你的信息超出本指引目的或合理范围，开发者必须在变更使用目的或范围前，再次以电子邮件方式告知并征得你的明示同意。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"6. 信息对外提供"),e.createElementVNode("view",{class:"item"},"6.1 开发者承诺，不会主动共享或转让你的信息至任何第三方，如存在确需共享或转让时，开发者应当直接征得或确认第三方征得你的单独同意。"),e.createElementVNode("view",{class:"item"}," 6.2 开发者承诺，不会对外公开披露你的信息，如必须公开披露时，开发者应当向你告知公开披露的目的、披露信息的类型及可能涉及的信息，并征得你的单独同意。 ")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"7. 投诉与反馈"),e.createElementVNode("view",{class:"paragraph"},"若你认为开发者未遵守上述约定，或有其他的投诉建议、或未成年人个人信息保护相关问题，可通过以下方式与开发者联系;或者向微信进行投诉。"),e.createElementVNode("view",{class:"contact"},"联系电话：13776913405")]),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("view",null,"更新日期：2025年12月31日"),e.createElementVNode("view",null,"生效日期：2025年12月31日")])])])])}]]);const W=a({data:()=>({}),onLoad(e){},onReady(){},onShow(){},onHide(){},onUnload(){},onPullDownRefresh(){},onReachBottom(){},onShareAppMessage(){},methods:{}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"container"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"title"},"服务协议"),e.createElementVNode("view",{class:"paragraph"}," 欢迎你使用《我和你的重要时光》小程序。 在使用本小程序服务前，请你仔细阅读并充分理解本《服务协议》。 你一旦开始使用本小程序服务，即视为你已阅读、理解并同意本协议的全部内容。 "),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"一、服务内容"),e.createElementVNode("view",{class:"item"},"1. 本小程序为用户提供重要日期记录、提醒及相关辅助功能，具体功能以小程序实际提供为准。"),e.createElementVNode("view",{class:"item"},"2. 开发者有权根据实际情况对服务内容进行调整、更新或优化，并不保证所有功能永久可用。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"二、用户行为规范"),e.createElementVNode("view",{class:"item"},"1. 用户在使用本小程序过程中，应遵守国家相关法律法规，不得利用本小程序从事违法违规行为。"),e.createElementVNode("view",{class:"item"},"2. 用户不得通过任何方式干扰或破坏本小程序的正常运行。"),e.createElementVNode("view",{class:"item"},"3. 用户应对其在小程序中填写和操作的内容真实性负责。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"三、账号与数据"),e.createElementVNode("view",{class:"item"},"1. 用户应妥善保管自己的账号信息，因用户自身原因造成的损失由用户自行承担。"),e.createElementVNode("view",{class:"item"},"2. 用户理解并同意，开发者可能因系统维护、升级或其他原因暂时中断服务。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"四、知识产权"),e.createElementVNode("view",{class:"item"},"1. 本小程序及其相关内容（包括但不限于界面设计、文字、图标等）的知识产权归开发者所有或依法享有。"),e.createElementVNode("view",{class:"item"},"2. 未经开发者书面许可，用户不得擅自使用、复制或传播。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"五、责任限制"),e.createElementVNode("view",{class:"item"},"1. 在法律允许的范围内，开发者不对因不可抗力、网络原因或第三方原因导致的服务中断或数据异常承担责任。"),e.createElementVNode("view",{class:"item"},"2. 本小程序提供的内容仅供参考，不构成任何形式的保证或承诺。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"六、协议变更"),e.createElementVNode("view",{class:"paragraph"},"开发者有权根据法律法规或业务调整需要对本协议进行修改。 协议更新后将在小程序内进行公示，用户继续使用服务即视为接受修改后的协议。")]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-title"},"七、联系我们"),e.createElementVNode("view",{class:"paragraph"},"如你对本协议内容有任何疑问、意见或建议，可通过以下方式与开发者联系："),e.createElementVNode("view",{class:"contact"},"联系电话：13776913405")]),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("view",null,"更新日期：2025年12月31日"),e.createElementVNode("view",null,"生效日期：2025年12月31日")])])])])}]]);const O=a({data:()=>({sections:[{title:"仅限高小雅使用",desc:"测试版本，仅限高小雅使用",isNew:!0},{title:"重要日子管理",desc:"把纪念日、倒计时、生日等重要时间记录下来。",items:["支持新增 / 编辑 / 删除","支持正数/倒数计算（可包含起始日）","支持置顶显示"]},{title:"主页卡片拖拽排序",desc:"长按卡片可上下拖动，自定义你喜欢的顺序。",items:["拖动后自动保存排序","优化拖动手感与回弹逻辑"]},{title:"经期记录与预测",desc:"记录经期开始日，结合周期/经期长度进行预测展示。",items:["记录经期开始/结束","浅色展示预测经期","支持修改周期长度与经期长度"]},{title:"备注与提示",desc:"给某一天写点小备注，日历上会出现一个小点提示。",items:["备注支持多行输入","有备注的日期会显示提示小点"]},{title:"隐私与数据",desc:"数据仅存储在本地，退出登录时可自动清除个人缓存。",items:["退出登录自动删除个人数据缓存","提供服务协议与隐私政策入口"]}]}),methods:{}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"header-card"},[e.createElementVNode("text",{class:"title"},"功能介绍"),e.createElementVNode("text",{class:"subtitle"},"把和小雅的重要日子，都放进这里")]),e.createElementVNode("view",{class:"card"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.sections,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"section",key:a},[e.createElementVNode("view",{class:"sec-title-row"},[e.createElementVNode("text",{class:"sec-title"},e.toDisplayString(t.title),1),t.isNew?(e.openBlock(),e.createElementBlock("text",{key:0,class:"new-tag"},"NEW")):e.createCommentVNode("",!0)]),e.createElementVNode("text",{class:"sec-desc"},e.toDisplayString(t.desc),1),t.items&&t.items.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"items"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.items,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"item",key:a},[e.createElementVNode("text",{class:"dot"},"·"),e.createElementVNode("text",{class:"text"},e.toDisplayString(t),1)])))),128))])):e.createCommentVNode("",!0)])))),128))]),e.createElementVNode("view",{class:"footer-space"})])}]]);const U=a({data:()=>({}),onLoad(e){},onReady(){},onShow(){},onHide(){},onUnload(){},onPullDownRefresh(){},onReachBottom(){},onShareAppMessage(){},methods:{}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("text",null,"pages/about/feedback/feedback.wxml")])}]]);const Y=a({data:()=>({logs:[{version:"0.0.1",desc:"功能更新",isLatest:!0,items:["基本迁移 基本功能"]},{version:"0.0.0",desc:"初始版本",items:["基本框架"]}]}),methods:{}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"header-card"},[e.createElementVNode("text",{class:"title"},"更新日志"),e.createElementVNode("text",{class:"subtitle"},"加班加点写新功能中……")]),e.createElementVNode("view",{class:"card"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.logs,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"version-block",key:a},[e.createElementVNode("view",{class:"version-row"},[e.createElementVNode("view",{class:"ver-left"},[e.createElementVNode("text",{class:"version"},"v"+e.toDisplayString(t.version),1),t.isLatest?(e.openBlock(),e.createElementBlock("text",{key:0,class:"new-tag"},"NEW")):e.createCommentVNode("",!0),e.createElementVNode("text",{class:"desc"},e.toDisplayString(t.desc),1)])]),e.createElementVNode("view",{class:"items"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.items,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"item",key:a},[e.createElementVNode("text",{class:"dot"},"·"),e.createElementVNode("text",{class:"text"},e.toDisplayString(t),1)])))),128))])])))),128))]),e.createElementVNode("view",{class:"footer-space"})])}]]),H={cycleLength:28,periodLength:5,lutealDays:14};function K(e){return(e<10?"0":"")+e}function z(e){return`${e.getFullYear()}-${K(e.getMonth()+1)}-${K(e.getDate())}`}function X(e){if(!e)return null;const[t,a,o]=e.split("-").map(Number);return new Date(t,a-1,o)}function q(e,t){const a=X(e),o=X(t);return a&&o?Math.round((o-a)/864e5):0}function j(e){return Math.round(10*e)/10}function G(e,t){const a=Array.isArray(e)?e:[];return a.length<=t?a.slice():a.slice(a.length-t)}function J(e){const t=X(e);return t?`${t.getMonth()+1}月${t.getDate()}日`:""}function Z(e,t){const a=t&&t.cycleLength?t.cycleLength:H.cycleLength,o=(e||[]).map((e=>e.start)).filter(Boolean).sort();if(o.length<1)return null;const s=z(new Date),n=o[o.length-1],i=q(n,s)+1;let l="",c="",r=0,d=0;if(o.length>=2){l=o[o.length-2];const e=o[o.length-1];r=q(l,e);const t=X(e);t.setDate(t.getDate()-1),c=z(t)}if(o.length>=3){d=q(o[o.length-3],o[o.length-2])}const m=r>=21&&r<=35?"正常":"偏离";let h="—";if(r&&d){const e=r-d;h=0===e?"持平":e>0?`多 ${e} 天`:`少 ${Math.abs(e)} 天`}const u=[],p=i-a;u.push({dateLabel:J(n),status:p<=0?"准时":`推迟${p}天`,lenText:`当前周期${i}天`,len:i,isCurrent:!0});let g=0;for(let w=o.length-1;w>=1&&g<2;w--){const e=o[w-1],t=q(e,o[w]);if(t<=0)continue;const s=t-a;let n="准时";s>0?n=`推迟${s}天`:s<0&&(n=`提前${Math.abs(s)}天`),u.push({dateLabel:J(e),status:n,lenText:`${t}天`,len:t,isCurrent:!1}),g++}const v=Math.max(...u.map((e=>e.len||0)),a,1);u.forEach((e=>{const t=Math.round(e.len/v*100);var a,o,s;e.barPct=(a=t,o=30,s=100,Math.max(o,Math.min(s,a)))}));return{rangeText:l&&c?`最近 1 个周期（${l} - ${c}）`:"最近 1 个周期（数据不足）",lastLenText:r?`${r}天`:"—",normalTag:m,deltaText:h,items:u}}function Q(e,t){const a=X(e);return a?(a.setDate(a.getDate()+t),z(a)):""}const ee=a({data:()=>({hasData:!1,latestStart:"",latestEnd:"",latestPeriodLen:0,latestCycleLen:0,stabilityText:"",confidenceText:"",nextStart:"",ovulationDay:"",fertileRangeText:"",cycleChange:null,painSummaryText:"",painLevelText:"",painPeakText:"",sexSummaryText:"",sexFertileText:"",sexUnprotectedText:"",weightText:""}),onLoad(){this.refresh()},onShow(){this.refresh()},methods:{refresh(){const e=function(e){if(e.settings=e.settings||{...H},e.periodRecords=Array.isArray(e.periodRecords)?e.periodRecords:[],e.periodStarts=Array.isArray(e.periodStarts)?e.periodStarts:[],e.painRecords=Array.isArray(e.painRecords)?e.painRecords:[],e.sexRecords=Array.isArray(e.sexRecords)?e.sexRecords:[],e.sexDates=Array.isArray(e.sexDates)?e.sexDates:[],e.weightRecords=Array.isArray(e.weightRecords)?e.weightRecords:[],0===e.periodRecords.length&&e.periodStarts.length>0){const t=[...e.periodStarts].sort();e.periodRecords=t.map((e=>({start:e,end:e})))}return e.periodRecords.sort(((e,t)=>(e.start||"").localeCompare(t.start||""))),e}(function(){const e=uni.getStorageSync("period_record_v1");return e&&"object"==typeof e?e:{}}()),t=e.settings||H,a=t.cycleLength||H.cycleLength;t.lutealDays;const o=e.periodRecords||[];if(!o.length)return void this.setData({hasData:!1});const s=function(e,t){const a=e.start;let o=e.end;if(!o||o===a){const e=t&&t.periodLength?t.periodLength:H.periodLength;o=Q(a,Math.max(0,e-1))}return{start:a,end:o}}(G(o,1)[0],t),n=s.start,i=s.end,l=q(n,Q(i,1)),c=G(o,2);let r=0;c.length>=2&&(r=q(c[0].start,c[1].start));const d=function(e){const t=G(e,4);if(t.length<4)return{stdev:null,text:"数据不足（建议至少记录4次经期）"};const a=[];for(let l=1;l<t.length;l++)a.push(q(t[l-1].start,t[l].start));const o=a.reduce(((e,t)=>e+t),0)/a.length,s=a.reduce(((e,t)=>e+(t-o)*(t-o)),0)/a.length,n=Math.sqrt(s);let i="波动较大";return n<=3?i="较稳定":n<=6&&(i="略有波动"),{stdev:n,text:i}}(o),m=d.text,h=o.length>=6?"高（记录较多）":o.length>=4?"中（记录一般）":"低（记录偏少）",u=function(e,t,a){const o=a&&a.cycleLength?a.cycleLength:H.cycleLength,s=a&&a.lutealDays?a.lutealDays:H.lutealDays,n=Q(e,t>0?t:o),i=Q(n,-s),l=Q(i,-5),c=Q(i,1);return{nextStart:n,ovulationDay:i,fertileRangeText:(r=l,d=c,r&&d?`${r} ~ ${d}`:"")};var r,d}(n,r,t),p=u.nextStart,g=u.ovulationDay,v=u.fertileRangeText,w=Z(o,t),E=function(e,t,a){const o=G(t,2);if(o.length<2)return{summary:"痛经：数据不足（至少需要2次经期开始日期）",levelText:"",peakText:""};const s=o[o.length-1].start;o[o.length-2].start;const n=Q(s,-2*(a||H.cycleLength)),i=Q(s,1),l=(e||[]).filter((e=>e&&e.date>=n&&e.date<=i));if(!l.length)return{summary:"最近3个周期未记录痛经",levelText:"",peakText:""};const c=l.length,r={mild:0,moderate:0,severe:0,unknown:0};l.forEach((e=>{const t=e.level||"unknown";null==r[t]?r.unknown++:r[t]++}));const d={};l.forEach((e=>{const t=q(s,e.date)+1,a=String(t);d[a]=(d[a]||0)+1}));let m="",h=0;return Object.keys(d).forEach((e=>{d[e]>h&&(h=d[e],m=e)})),{summary:`最近3个周期共记录痛经 ${c} 次`,levelText:`轻度 ${r.mild} 次，中度 ${r.moderate} 次，重度 ${r.severe} 次`,peakText:m?`更常出现在周期第 ${m} 天（${h} 次）`:""}}(e.painRecords,o,r||a),N=E.summary,y=E.levelText,f=E.peakText,V=function(e,t,a,o){const s=t,n=Q(a,-1),i=(e||[]).filter((e=>e&&e.date>=s&&e.date<=n));let l="",c="";if(o){const e=o.split("~").map((e=>e.trim()));l=e[0],c=e[1]}const r=l&&c?i.filter((e=>e.date>=l&&e.date<=c)):[],d=i.filter((e=>!e.contraception||"无"===e.contraception||"未填写"===e.contraception)).length;return{cycleCount:i.length,fertileCount:r.length,unprotectedCount:d}}(e.sexRecords,n,p,v),x=`最近一个周期记录爱爱 ${V.cycleCount} 次`,k=v?`其中排卵期内 ${V.fertileCount} 次`:"排卵期：数据不足",S=V.unprotectedCount>0?`其中“无措施/未填写” ${V.unprotectedCount} 次`:"避孕方式记录较完整",D=function(e,t,a){const o=Q(t,-3),s=Q(t,-1),n=(e||[]).filter((e=>e&&e.date>=o&&e.date<=s&&"number"==typeof e.weight)),i=(e||[]).filter((e=>e&&e.date>=t&&e.date<=a&&"number"==typeof e.weight)),l=e=>e.length?e.reduce(((e,t)=>e+t.weight),0)/e.length:0,c=j(l(n)),r=j(l(i)),d=j(r-c);return{preCount:n.length,inCount:i.length,preAvg:c,inAvg:r,delta:d}}(e.weightRecords,n,i);let b="体重记录不足（建议在经期前后多记录几天）";if(D.preCount>=1&&D.inCount>=1){const e=D.delta>0?"+":"";b=`经期前3天均值 ${D.preAvg}kg；经期中均值 ${D.inAvg}kg；变化 ${e}${D.delta}kg`}this.setData({hasData:!0,latestStart:n,latestEnd:i,latestPeriodLen:l,latestCycleLen:r,stabilityText:m,confidenceText:h,nextStart:p,ovulationDay:g,fertileRangeText:v,cycleChange:w,painSummaryText:N,painLevelText:y,painPeakText:f,sexSummaryText:x,sexFertileText:k,sexUnprotectedText:S,weightText:b})}}},[["render",function(a,o,s,n,i,l){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"经期健康分析"),i.hasData?(e.openBlock(),e.createElementBlock("text",{key:0,class:"sub"},"基于已有记录生成（仅供参考）")):(e.openBlock(),e.createElementBlock("text",{key:1,class:"sub"},"暂无经期记录，先在日历里记录“月经来了”再回来看看"))])]),i.hasData?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"card-title"},"本周期概览"),e.createElementVNode("view",{class:"kv"},[e.createElementVNode("text",{class:"k"},"最近经期"),e.createElementVNode("text",{class:"v"},e.toDisplayString(i.latestStart)+" ~ "+e.toDisplayString(i.latestEnd),1)]),e.createElementVNode("view",{class:"kv"},[e.createElementVNode("text",{class:"k"},"经期长度"),e.createElementVNode("text",{class:"v"},e.toDisplayString(i.latestPeriodLen)+" 天",1)]),e.createElementVNode("view",{class:"kv"},[e.createElementVNode("text",{class:"k"},"周期长度"),e.createElementVNode("text",{class:"v"},e.toDisplayString(i.latestCycleLen)+" 天",1)]),e.createElementVNode("view",{class:"kv"},[e.createElementVNode("text",{class:"k"},"周期稳定性"),e.createElementVNode("text",{class:"v"},e.toDisplayString(i.stabilityText),1)]),e.createElementVNode("view",{class:"kv"},[e.createElementVNode("text",{class:"k"},"可信度"),e.createElementVNode("text",{class:"v"},e.toDisplayString(i.confidenceText),1)])]),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"card-title"},"预测与排卵期"),e.createElementVNode("view",{class:"kv"},[e.createElementVNode("text",{class:"k"},"下次预计开始"),e.createElementVNode("text",{class:"v"},e.toDisplayString(i.nextStart||"数据不足"),1)]),e.createElementVNode("view",{class:"kv"},[e.createElementVNode("text",{class:"k"},"排卵日（推算）"),e.createElementVNode("text",{class:"v"},e.toDisplayString(i.ovulationDay||"数据不足"),1)]),e.createElementVNode("view",{class:"kv"},[e.createElementVNode("text",{class:"k"},"排卵期范围"),e.createElementVNode("text",{class:"v"},e.toDisplayString(i.fertileRangeText||"数据不足"),1)])]),i.cycleChange?(e.openBlock(),e.createElementBlock("view",{key:0,class:"card"},[e.createElementVNode("view",{class:"cycle-head"},[e.createElementVNode("view",{class:"cycle-head-left"},[e.createElementVNode("image",{class:"cycle-icon",src:t,mode:"aspectFit"}),e.createElementVNode("text",{class:"cycle-title"},"周期变化")]),e.createElementVNode("image",{class:"cycle-arrow",src:h,mode:"aspectFit"})]),e.createElementVNode("view",{class:"cycle-sub"},e.toDisplayString(i.cycleChange.rangeText),1),e.createElementVNode("view",{class:"cycle-summary"},[e.createElementVNode("view",{class:"cycle-summary-left"},[e.createElementVNode("view",{class:"cycle-label"},"周期天数"),e.createElementVNode("view",{class:"cycle-big"},[e.createElementVNode("text",{class:"cycle-num"},e.toDisplayString(i.cycleChange.lastLenText),1),e.createElementVNode("text",{class:"cycle-tag"},e.toDisplayString(i.cycleChange.normalTag),1)])]),e.createElementVNode("view",{class:"cycle-summary-right"},[e.createElementVNode("view",{class:"cycle-label"},"比前 1 个周期"),e.createElementVNode("view",{class:"cycle-delta"},e.toDisplayString(i.cycleChange.deltaText),1)])]),e.createElementVNode("view",{class:"cycle-list-title"},"近期周期天数"),e.createElementVNode("view",{class:"cycle-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.cycleChange.items,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"cycle-item",key:a},[e.createElementVNode("view",{class:"cycle-item-left"},[e.createElementVNode("text",{class:"cycle-date"},e.toDisplayString(t.dateLabel),1),e.createElementVNode("text",{class:"cycle-status"},e.toDisplayString(t.status),1)]),e.createElementVNode("view",{class:"cycle-bar-wrap"},[e.createElementVNode("view",{class:"cycle-bar",style:e.normalizeStyle(t.barStyle)},[e.createElementVNode("text",{class:"cycle-bar-text"},e.toDisplayString(t.lenText),1)],4)])])))),128))])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"card-title"},"痛经情况"),e.createElementVNode("view",{class:"p"},e.toDisplayString(i.painSummaryText),1),e.createElementVNode("view",{class:"p"},e.toDisplayString(i.painLevelText),1),e.createElementVNode("view",{class:"p"},e.toDisplayString(i.painPeakText),1)]),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"card-title"},"行为与风险提示"),e.createElementVNode("view",{class:"p"},e.toDisplayString(i.sexSummaryText),1),e.createElementVNode("view",{class:"p"},e.toDisplayString(i.sexFertileText),1),e.createElementVNode("view",{class:"p"},e.toDisplayString(i.sexUnprotectedText),1)]),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"card-title"},"体重变化（围绕最近经期）"),e.createElementVNode("view",{class:"p"},e.toDisplayString(i.weightText),1)])])):e.createCommentVNode("",!0)])}]]),te="period_record_v1";function ae(){return uni.getStorageSync(te)||{}}function oe(e){uni.setStorageSync(te,e)}const se=a({data:()=>({date:"",records:[],showPopup:!1,time:"12:00",method:"无措施",methods:["无措施","避孕套","体外排精","未射精","紧急避孕药","短效避孕药","长效避孕药","替他措施"],startX_var:0,startY_var:0,activeIndex_var:-1,rpxPerPx_var:2}),onLoad(e){var t;const a=e.date,o=750/uni.getSystemInfoSync().windowWidth,s=(null==(t=ae().sexRecords)?void 0:t[a])||[];this.setData({date:a,rpxPerPx_var:o,records:this.initSwipe(s)})},methods:{onAddTap(){this.setData({showPopup:!0})},onCancel(){this.setData({showPopup:!1})},onTimeChange(e){this.setData({time:e.detail.value})},onMethodChange(e){this.setData({method:this.methods[e.detail.value]})},onConfirm(){const e=ae();e.sexRecords=e.sexRecords||{},e.sexRecords[this.date]=e.sexRecords[this.date]||[],e.sexRecords[this.date].push({time:this.time,method:this.method}),oe(e),this.setData({records:this.initSwipe(e.sexRecords[this.date]),showPopup:!1,activeIndex_var:-1})},onDelete(e){const t=e.currentTarget.dataset.index,a=ae();a.sexRecords=a.sexRecords||{},a.sexRecords[this.date]=a.sexRecords[this.date]||[],t<0||t>=a.sexRecords[this.date].length||(a.sexRecords[this.date].splice(t,1),oe(a),this.setData({records:this.initSwipe(a.sexRecords[this.date]),activeIndex_var:-1}))},initSwipe:e=>(e||[]).map((e=>({...e,_x:0,_moving:!1}))),closeAllSwipe(){const e=(this.records||[]).map((e=>({...e,_x:0,_moving:!1})));this.setData({records:e,activeIndex_var:-1})},onSwipeTap(e){var t;const a=e.currentTarget.dataset.index,o=null==(t=this.records)?void 0:t[a];o&&0!==o._x&&this.closeAllSwipe()},onSwipeStart(e){const t=e.currentTarget.dataset.index;-1!==this._activeIndex&&this._activeIndex!==t&&this.closeAllSwipe();const a=e.touches[0];this.setData({startX_var:a.clientX,startY_var:a.clientY,activeIndex_var:t});const o=this.records.slice();o[t]&&(o[t]._moving=!0),this.setData({records:o})},onSwipeMove(e){const t=this._activeIndex;if(t<0)return;const a=e.touches[0],o=a.clientX-this._startX,s=a.clientY-this._startY;if(Math.abs(o)<Math.abs(s))return;const n=this.records.slice(),i=n[t];if(!i)return;const l=o*this._rpxPerPx;let c=l;-160===i._x&&(c=-160+l),c<-160&&(c=-160),c>0&&(c=0),i._x=c,n[t]=i,this.setData({records:n})},onSwipeEnd(){const e=this._activeIndex;if(e<0)return;const t=this.records.slice(),a=t[e];if(!a)return;const o=a._x<-80;a._x=o?-160:0,a._moving=!1,t[e]=a,this.setData({records:t,activeIndex_var:o?e:-1})}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"add-btn",onClick:a[0]||(a[0]=(...e)=>i.onAddTap&&i.onAddTap(...e)),"hover-class":"btn-active","hover-stay-time":"80"},[e.createElementVNode("image",{src:u,class:"icon",mode:"aspectFit"}),e.createElementVNode("text",null,"添加爱爱记录")]),n.records.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.records,((t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"swipe-item","data-index":o,onTouchstart:a[3]||(a[3]=(...e)=>i.onSwipeStart&&i.onSwipeStart(...e)),onTouchmove:a[4]||(a[4]=(...e)=>i.onSwipeMove&&i.onSwipeMove(...e)),onTouchend:a[5]||(a[5]=(...e)=>i.onSwipeEnd&&i.onSwipeEnd(...e)),onTouchcancel:a[6]||(a[6]=(...e)=>i.onSwipeEnd&&i.onSwipeEnd(...e)),key:o},[e.createElementVNode("view",{class:"swipe-actions",onClick:a[1]||(a[1]=(...e)=>i.onDelete&&i.onDelete(...e)),"data-index":o},"删除",8,["data-index"]),e.createElementVNode("view",{class:e.normalizeClass("swipe-content "+(t._moving?"no-anim":"")),style:e.normalizeStyle("transform: translateX("+t._x+"rpx);"),"data-index":o,onClick:a[2]||(a[2]=(...e)=>i.onSwipeTap&&i.onSwipeTap(...e))},[e.createElementVNode("view",{class:"card-row"},[e.createElementVNode("view",{class:"left"},[e.createElementVNode("image",{class:"heart",src:p,mode:"aspectFit"}),e.createElementVNode("text",{class:"count"},"第"+e.toDisplayString(o+1)+"次",1),e.createElementVNode("text",{class:"time"},e.toDisplayString(t.time),1)]),e.createElementVNode("text",{class:"method"},e.toDisplayString(t.method),1)])],14,["data-index"])],40,["data-index"])))),128))])):e.createCommentVNode("",!0),n.showPopup?(e.openBlock(),e.createElementBlock("view",{key:1,class:"mask",onClick:a[7]||(a[7]=(...e)=>i.onCancel&&i.onCancel(...e))})):e.createCommentVNode("",!0),n.showPopup?(e.openBlock(),e.createElementBlock("view",{key:2,class:"popup"},[e.createElementVNode("view",{class:"popup-title"},"添加爱爱记录"),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"label"},"爱爱时间"),e.createElementVNode("picker",{mode:"time",value:n.time,onChange:a[8]||(a[8]=(...e)=>i.onTimeChange&&i.onTimeChange(...e))},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(n.time),1)],40,["value"])]),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"label"},"避孕措施"),e.createElementVNode("picker",{mode:"selector",range:n.methods,onChange:a[9]||(a[9]=(...e)=>i.onMethodChange&&i.onMethodChange(...e))},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(n.method),1)],40,["range"])]),e.createElementVNode("view",{class:"popup-actions"},[e.createElementVNode("view",{class:"btn cancel",onClick:a[10]||(a[10]=(...e)=>i.onCancel&&i.onCancel(...e))},"取消"),e.createElementVNode("view",{class:"btn ok",onClick:a[11]||(a[11]=(...e)=>i.onConfirm&&i.onConfirm(...e))},"确定")])])):e.createCommentVNode("",!0)])}]]),ne="period_record_v1";function ie(){const e=uni.getStorageSync(ne);return e&&"object"==typeof e?e:{}}function le(e){uni.setStorageSync(ne,e)}const ce=a({data:()=>({date:"",records:[],showPopup:!1,time:"12:00",level:"一般",levels:["轻微","一般","严重"],medicine:"未用药",medicines:["未用药","布洛芬","对乙酰氨基酚","热敷/止痛贴","中成药","其他"],startX_var:0,startY_var:0,activeIndex_var:-1,rpxPerPx_var:2}),onLoad(e){var t;const a=e.date||"",o=750/uni.getSystemInfoSync().windowWidth,s=ie();s.painRecords=s.painRecords||{};const n=(null==(t=s.painRecords)?void 0:t[a])||[];this.setData({date:a,rpxPerPx_var:o,records:this.initSwipe(n)})},methods:{onAddTap(){this.setData({showPopup:!0})},onCancel(){this.setData({showPopup:!1})},onTimeChange(e){this.setData({time:e.detail.value})},onLevelChange(e){this.setData({level:this.levels[e.detail.value]})},onMedicineChange(e){this.setData({medicine:this.medicines[e.detail.value]})},onConfirm(){const e=ie();e.painRecords=e.painRecords||{},e.painRecords[this.date]=e.painRecords[this.date]||[],e.painRecords[this.date].push({time:this.time,level:this.level,medicine:this.medicine}),le(e),this.setData({records:this.initSwipe(e.painRecords[this.date]),showPopup:!1,activeIndex_var:-1})},onDelete(e){const t=e.currentTarget.dataset.index,a=ie();a.painRecords=a.painRecords||{},a.painRecords[this.date]=a.painRecords[this.date]||[],t<0||t>=a.painRecords[this.date].length||(a.painRecords[this.date].splice(t,1),le(a),this.setData({records:this.initSwipe(a.painRecords[this.date]),activeIndex_var:-1}))},initSwipe:e=>(e||[]).map((e=>({...e,_x:0,_moving:!1}))),closeAllSwipe(){const e=(this.records||[]).map((e=>({...e,_x:0,_moving:!1})));this.setData({records:e,activeIndex_var:-1})},onSwipeTap(e){var t;const a=e.currentTarget.dataset.index,o=null==(t=this.records)?void 0:t[a];o&&0!==o._x&&this.closeAllSwipe()},onSwipeStart(e){const t=e.currentTarget.dataset.index;-1!==this._activeIndex&&this._activeIndex!==t&&this.closeAllSwipe();const a=e.touches[0];this.setData({startX_var:a.clientX,startY_var:a.clientY,activeIndex_var:t});const o=this.records.slice();o[t]&&(o[t]._moving=!0),this.setData({records:o})},onSwipeMove(e){const t=this._activeIndex;if(t<0)return;const a=e.touches[0],o=a.clientX-this._startX,s=a.clientY-this._startY;if(Math.abs(o)<Math.abs(s))return;const n=this.records.slice(),i=n[t];if(!i)return;const l=o*this._rpxPerPx;let c=l;-160===i._x&&(c=-160+l),c<-160&&(c=-160),c>0&&(c=0),i._x=c,n[t]=i,this.setData({records:n})},onSwipeEnd(){const e=this._activeIndex;if(e<0)return;const t=this.records.slice(),a=t[e];if(!a)return;const o=a._x<-80;a._x=o?-160:0,a._moving=!1,t[e]=a,this.setData({records:t,activeIndex_var:o?e:-1})}}},[["render",function(t,a,o,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"add-btn",onClick:a[0]||(a[0]=(...e)=>i.onAddTap&&i.onAddTap(...e)),"hover-class":"btn-active","hover-stay-time":"80"},[e.createElementVNode("image",{src:u,class:"icon",mode:"aspectFit"}),e.createElementVNode("text",null,"添加痛经记录")]),n.records.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.records,((t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"swipe-item","data-index":o,onTouchstart:a[3]||(a[3]=(...e)=>i.onSwipeStart&&i.onSwipeStart(...e)),onTouchmove:a[4]||(a[4]=(...e)=>i.onSwipeMove&&i.onSwipeMove(...e)),onTouchend:a[5]||(a[5]=(...e)=>i.onSwipeEnd&&i.onSwipeEnd(...e)),onTouchcancel:a[6]||(a[6]=(...e)=>i.onSwipeEnd&&i.onSwipeEnd(...e)),key:o},[e.createElementVNode("view",{class:"swipe-actions",onClick:a[1]||(a[1]=(...e)=>i.onDelete&&i.onDelete(...e)),"data-index":o},"删除",8,["data-index"]),e.createElementVNode("view",{class:e.normalizeClass("swipe-content "+(t._moving?"no-anim":"")),style:e.normalizeStyle("transform: translateX("+t._x+"rpx);"),"data-index":o,onClick:a[2]||(a[2]=(...e)=>i.onSwipeTap&&i.onSwipeTap(...e))},[e.createElementVNode("view",{class:"row1"},[e.createElementVNode("view",{class:"left"},[e.createElementVNode("view",{class:"pain-badge"},"痛"),e.createElementVNode("text",{class:"count"},"第"+e.toDisplayString(o+1)+"次",1),e.createElementVNode("text",{class:"time"},e.toDisplayString(t.time),1)]),e.createElementVNode("text",{class:"right-muted"},e.toDisplayString(t.level),1)]),e.createElementVNode("view",{class:"row2"},[e.createElementVNode("text",{class:"meta"},"程度："+e.toDisplayString(t.level),1),e.createElementVNode("text",{class:"meta"},"用药："+e.toDisplayString(t.medicine),1)])],14,["data-index"])],40,["data-index"])))),128))])):e.createCommentVNode("",!0),n.showPopup?(e.openBlock(),e.createElementBlock("view",{key:1,class:"mask",onClick:a[7]||(a[7]=(...e)=>i.onCancel&&i.onCancel(...e))})):e.createCommentVNode("",!0),n.showPopup?(e.openBlock(),e.createElementBlock("view",{key:2,class:"popup"},[e.createElementVNode("view",{class:"popup-title"},"添加痛经记录"),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"label"},"痛经时间"),e.createElementVNode("picker",{mode:"time",value:n.time,onChange:a[8]||(a[8]=(...e)=>i.onTimeChange&&i.onTimeChange(...e))},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(n.time),1)],40,["value"])]),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"label"},"痛经程度"),e.createElementVNode("picker",{mode:"selector",range:n.levels,onChange:a[9]||(a[9]=(...e)=>i.onLevelChange&&i.onLevelChange(...e))},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(n.level),1)],40,["range"])]),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"label"},"用药情况"),e.createElementVNode("picker",{mode:"selector",range:n.medicines,onChange:a[10]||(a[10]=(...e)=>i.onMedicineChange&&i.onMedicineChange(...e))},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(n.medicine),1)],40,["range"])]),e.createElementVNode("view",{class:"popup-actions"},[e.createElementVNode("view",{class:"btn cancel",onClick:a[11]||(a[11]=(...e)=>i.onCancel&&i.onCancel(...e))},"取消"),e.createElementVNode("view",{class:"btn ok",onClick:a[12]||(a[12]=(...e)=>i.onConfirm&&i.onConfirm(...e))},"确定")])])):e.createCommentVNode("",!0)])}]]);__definePage("pages/home/home",c),__definePage("pages/add/add",m),__definePage("pages/period/period",S),__definePage("pages/me/me",B),__definePage("pages/detail/detail",P),__definePage("pages/about/about",I),__definePage("pages/editDetail/editDetail",F),__definePage("pages/subabout/privacy/privacy",$),__definePage("pages/subabout/agreement/agreement",W),__definePage("pages/subabout/intro/intro",O),__definePage("pages/subabout/feedback/feedback",U),__definePage("pages/subabout/changelog/changelog",Y),__definePage("pages/subperiod/analysis/analysis",ee),__definePage("pages/subperiod/love/love",se),__definePage("pages/subperiod/pain/pain",ce);const re={data:()=>({}),onLaunch(){const e=uni.getStorageSync("logs")||[];e.unshift(Date.now()),uni.setStorageSync("logs",e),uni.login({success:e=>{}})},globalData:{userInfo:null}};function de(e,t){e.$children.map((e=>{"function"==typeof e[t]&&e[t](),de(e,t)}))}const me={onLoad(){},onShow(){de(this,"handlePageShow")},onHide(){de(this,"handlePageHide")},onResize(){de(this,"handlePageResize")}};const he=(e,t)=>{var a,o=e._vnode;if(!(o=(null==(a=null==o?void 0:o.context)?void 0:a.$vnode)??"")||!o.data)return!1;let s=o.data.attrs||{},n=o.data.staticClass||"";const i=s.id||"";return"#"===t[0]?t.substr(1)===i:(n=n.trim().split(" "),(t=t.substr(1).split(".")).reduce(((e,t)=>e&&n.includes(t)),!0))},ue=e=>(e=(e=e.replace(/>>>/g,">")).split(">").map((e=>e.trim().split(" ").join("').descendant('"))).join("').child('"),function(t,a,o){return new t(a,o).descendant(e)});class pe{constructor(e,t=!1){this.nodes=[e],this.all=t}child(e){let t=[];if(this.all)this.nodes.forEach((a=>{t.push(...a.$children.filter((t=>he(t,e))))}));else if(this.nodes.length>0){let a=this.nodes[0].$children.find((t=>he(t,e)));t=a?[a]:[]}return this.nodes=t,this}descendant(e){let t=[];return this.nodes.forEach((a=>{(()=>{let e=!1;return function t(a,o){if(!e&&"function"==typeof o){let s=a.$children;for(let a=0;!e&&a<s.length;a++){let n=s[a];e=!0===o(n),t(n,o)}}}})()(a,(a=>{if(he(a,e))return t.push(a),!this.all}))})),this.nodes=t,this}}function ge(e){const t=e.split(",").map((e=>e.trim()));if(!t[0])return null;return ue(t[0])(pe,this,!1,e).nodes[0]}function ve(e){const t=e.split(",").map((e=>e.trim()));let a=[];return t.forEach((e=>{const t=ue(e);a=a.concat(t(pe,this,!0,e).nodes)})),a}const we=/^([^\x00-\xff]|[a-zA-Z_$])([^\x00-\xff]|[a-zA-Z0-9_$])*$/;const Ee={...me,methods:{clone:function(e){return JSON.parse(JSON.stringify(e))},handleDataset:function(e,t={}){e&&!e.currentTarget&&(t.tagId?e.currentTarget={id:t.tagId}:e.currentTarget={dataset:t})},escape2Html:function(e){if(!e)return e;var t={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return e.replace(/&(lt|gt|nbsp|amp|quot);/gi,(function(e,a){return t[a]}))},html2Escape:function(e){return e?e.replace(/[<>&"]/g,(function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[e]})):e},parseEventDynamicCode:function(e,t){"function"==typeof this[t]&&this[t](e)},getTabBar:function(){return{setData(e){var t,a,o,s;"function"==typeof(null==(a=null==(t=this.$mp)?void 0:t.page)?void 0:a.getTabBar)&&(null==(s=null==(o=this.$mp)?void 0:o.page)?void 0:s.getTabBar())?this.$mp.page.getTabBar().setData(e):D("log","at uni_modules/zp-mixins/methods/getTabBar.js:15","当前平台不支持getTabBar()，已稍作处理，详细请参见相关文档。")}}},getRelationNodes:function(e){if(!this.$unicom)throw"this.getRelationNodes()需与p-f-unicom配合使用！";return this.$unicom("@"+e)},zpSelectComponent:function(e){return ge.call(this,e)},zpSelectAllComponents:function(e){return ve.call(this,e)},setData:function(e,t=null){Object.keys(e).forEach((t=>{if(function(e,t,a){Object(e)!==e||(Array.isArray(t)||(t=t.toString().match(/[^.[\]]+/g)||[]),t.slice(0,-1).reduce(((e,a,o)=>Object(e[a])===e[a]?e[a]:e[a]=Math.abs(t[o+1])>>0==+t[o+1]?[]:{}),e)[t[t.length-1]]=a)}(this,t,e[t]),we.test(t)&&t.endsWith("Clone")){let a=t.replace(/Clone$/,"");this.$options&&this.$options.propsData[a]&&this.$emit(`update:${a}`,e[t])}})),this.$forceUpdate(),"function"==typeof t&&this.$nextTick(t)}}};const{app:Ne,Vuex:ye,Pinia:fe}=function(){const t=e.createVueApp(re);return t.mixin(Ee),{app:t}}();uni.Vuex=ye,uni.Pinia=fe,Ne.provide("__globalStyles",__uniConfig.styles),Ne._component.mpType="app",Ne._component.render=()=>{},Ne.mount("#app")}(Vue);
