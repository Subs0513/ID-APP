(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/period/period"],{"522c":function(e,t,n){"use strict";n.r(t);var r=n("a44e"),i=n.n(r);for(var a in r)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=i.a},"6d4b":function(e,t,n){"use strict";n.r(t);var r=n("c838"),i=n("522c");for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a);n("8522");var o=n("828b"),s=Object(o["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},8522:function(e,t,n){"use strict";var r=n("d871"),i=n.n(r);i.a},a44e:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("7ca3")),a=r(n("3b2d")),o=r(n("34cf"));function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={cycleLength:28,periodLength:5,lutealDays:14};function h(e){return(e<10?"0":"")+e}function l(e){return"".concat(e.getFullYear(),"-").concat(h(e.getMonth()+1),"-").concat(h(e.getDate()))}function u(e){var t=e.split("-").map(Number),n=(0,o.default)(t,3),r=n[0],i=n[1],a=n[2];return new Date(r,i-1,a)}function f(e,t){var n=new Date(e.getTime());return n.setDate(n.getDate()+t),n}function g(){var t=e.getStorageSync("period_record_v1");return t&&"object"===(0,a.default)(t)?t:{periodStarts:[],periodRecords:[],sexDates:[],sexRecords:{},settings:c({},d),weightRecords:{}}}function p(t){e.setStorageSync("period_record_v1",t)}function v(e){if(e.periodStarts=e.periodStarts||[],e.periodRecords=e.periodRecords||[],e.weightRecords=e.weightRecords||{},e.sexDates=e.sexDates||[],e.sexRecords=e.sexRecords||{},0===e.periodRecords.length&&e.periodStarts.length>0){var t=e.periodStarts.slice().sort((function(e,t){return u(e)-u(t)}));e.periodRecords=t.map((function(e){return{start:e,end:e}}))}e.periodRecords=(e.periodRecords||[]).filter((function(e){return e&&e.start})).map((function(e){return{start:e.start,end:e.end?e.end:e.start}}))}function m(e,t){for(var n=u(t),r=e.periodRecords||[],i=0;i<r.length;i++){var a=r[i],o=u(a.start),s=u(a.end);if(n>=o&&n<=s)return{record:a,index:i}}return null}var D={data:function(){return{weekNames:["日","一","二","三","四","五","六"],year:0,month:0,cells:[],selectedDate:"",periodSwitchOn:!1,touchStartX:0,touchStartY:0,showWeightPopup:!1,weightUnit:"kg",weightInput:"",weightDisplay:"0",hasWeight:!1,selectedWeightText:"",isFutureSelected:!1,hasSex:!1,selectedSexText:"",hasPain:!1,selectedPainText:"",isMonthAnimating:!1,monthAnimDir:"next",calOffsetPct:0,nextCells:[],nextYear:0,nextMonth:0,animTimer:null,pendingTarget:null,calNoAnim:!1}},onLoad:function(){var e=new Date;this.setData({year:e.getFullYear(),month:e.getMonth()+1,selectedDate:l(e)}),this.refreshAll()},onShow:function(){this.refreshAll()},onUnload:function(){this.animTimer&&(clearTimeout(this.animTimer),this.animTimer=null)},computed:{calTrackStyle:function(){var e=this.isMonthAnimating?"transform 260ms cubic-bezier(0.22, 0.61, 0.36, 1)":"none";return{transform:"translateX(".concat(this.calOffsetPct,"%)"),transition:e}}},methods:{noop:function(){},buildCalendarCellsFor:function(e,t){var n=g();v(n);var r=n.periodRecords&&n.periodRecords.length>0,i=r?this.computeMaps(n):{periodDays:new Set,predPeriodDays:new Set,ovulationDays:new Set,ovulationDay:new Set};return this.buildCalendarCells(n,i,e,t)},startMonthAnim:function(e,t,n){var r=this;if(this.isMonthAnimating)this.setData({pendingTarget:{direction:e,targetYear:t,targetMonth:n}});else{var i=this.buildCalendarCellsFor(t,n);this.setData({isMonthAnimating:!0,monthAnimDir:e,nextYear:t,nextMonth:n,nextCells:i,pendingTarget:null}),this.animTimer&&clearTimeout(this.animTimer),this.animTimer=setTimeout((function(){r.onMonthAnimEnd(!0)}),320),"next"===e?(this.setData({calOffsetPct:0}),this.$nextTick((function(){r.setData({calOffsetPct:-50})}))):(this.setData({calNoAnim:!0,calOffsetPct:-50}),this.$nextTick((function(){setTimeout((function(){r.setData({calNoAnim:!1}),r.setData({calOffsetPct:0})}),16)})))}},onMonthAnimEnd:function(e){var t=this;if(this.isMonthAnimating){this.animTimer&&(clearTimeout(this.animTimer),this.animTimer=null);var n=this.nextYear,r=this.nextMonth;this.setData({year:n,month:r,isMonthAnimating:!1,calOffsetPct:0,monthAnimDir:"next",nextCells:[]}),this.refreshAll();var i=this.pendingTarget;i&&i.targetYear&&i.targetMonth&&(this.setData({pendingTarget:null}),this.$nextTick((function(){t.startMonthAnim(i.direction,i.targetYear,i.targetMonth)})))}},refreshAll:function(){var e=g();v(e);var t=this.selectedDate,n=l(new Date),r=t>n,i=e.periodRecords&&e.periodRecords.length>0,a=i?this.computeMaps(e):{periodDays:new Set,predPeriodDays:new Set,ovulationDays:new Set,ovulationDay:new Set},o=a.periodDays.has(t),s=this.buildCalendarCells(e,a),c=e.weightRecords&&e.weightRecords[t],d=!!(c&&"number"===typeof c.kg&&c.kg>0),h=d?c.kg.toFixed(2)+"公斤":"",u=e.sexRecords&&e.sexRecords[t]?e.sexRecords[t]:[],f=u.length||((e.sexDates||[]).includes(t)?1:0),m=f>0,D=m?"".concat(f,"次"):"";e.painRecords=e.painRecords||{};var w=e.painRecords[t]||[],y=w.length,T=y>0,b=T?"".concat(y,"次"):"";this.setData({cells:s,periodSwitchOn:o,hasWeight:d,selectedWeightText:h,hasSex:m,selectedSexText:D,hasPain:T,selectedPainText:b,isFutureSelected:r}),p(e)},buildCalendarCells:function(e,t,n,r){var i=n||this.year,a=r||this.month,o=this.selectedDate,s=t||{periodDays:new Set,predPeriodDays:new Set,ovulationDays:new Set,ovulationDay:new Set},c=new Set(e.sexDates||[]),d=e.sexRecords||{};function h(e){var t=d[e];return Array.isArray(t)&&t.length>0||c.has(e)}for(var u=new Date(i,a-1,1),g=u.getDay(),p=f(u,-g),v=l(new Date),m=[],D=0;D<42;D++){var w=f(p,D),y=l(w),T=w.getMonth()===a-1,b="";T||(b+=" other"),s.periodDays.has(y)?b+=" period":s.predPeriodDays.has(y)?b+=" pred":s.ovulationDays.has(y)&&(b+=" ovulation"),y===o&&(b+=" selected"),y===v&&(b+=" today"),m.push({dateStr:y,day:w.getDate(),cls:b.trim(),isToday:y===v,hasHeart:h(y),isOvulationDay:s.ovulationDay.has(y)})}return m},computeMaps:function(e){var t=e.settings||d,n=t.cycleLength||d.cycleLength,r=t.periodLength||d.periodLength,i=t.lutealDays||d.lutealDays;v(e);var a=new Set,o=new Set,s=new Set,c=new Set,h=(e.periodRecords||[]).slice().sort((function(e,t){return u(e.start)-u(t.start)}));h.forEach((function(e){var t=u(e.start),n=u(e.end);if(!(n<t)){for(var i=Math.floor((n-t)/864e5),s=0;s<=i;s++)a.add(l(f(t,s)));var c=f(t,r-1),d=n;if(d<c)for(var h=f(d,1),g=Math.floor((c-h)/864e5),p=0;p<=g;p++)o.add(l(f(h,p)))}}));var g=function(e){var t=(e.periodRecords||[]).slice();return 0===t.length?null:(t.sort((function(e,t){return u(e.start)-u(t.start)})),t[t.length-1].start)}(e);if(g)for(var p=u(g),m=1;m<=6;m++){for(var D=f(p,n*m),w=0;w<r;w++){var y=l(f(D,w));a.has(y)||o.add(y)}var T=f(D,-i);c.add(l(T));for(var b=-2;b<=2;b++)s.add(l(f(T,b)))}return{periodDays:a,predPeriodDays:o,ovulationDays:s,ovulationDay:c}},buildMonth:function(e,t){this.setData({year:e,month:t}),this.refreshAll()},goPrevMonth:function(){var e=this.year,t=this.month-1;t<1&&(t=12,e--),this.startMonthAnim("prev",e,t)},goNextMonth:function(){var e=this.year,t=this.month+1;t>12&&(t=1,e++),this.startMonthAnim("next",e,t)},goToday:function(){var e=new Date;this.setData({year:e.getFullYear(),month:e.getMonth()+1,selectedDate:l(e)}),this.refreshAll()},onTapDate:function(e){var t=e.currentTarget.dataset.date;t&&(this.setData({selectedDate:t}),this.refreshAll())},onTogglePeriod:function(e){var t=e.detail.value,n=g();v(n);var r=this.selectedDate,i=n.settings||d,a=i.periodLength||d.periodLength;if(t){var o=m(n,r);if(o)return void this.refreshAll();var s=function(e,t,n){for(var r=u(t),i=e.periodRecords||[],a=0;a<i.length;a++){var o=i[a],s=u(o.start),c=f(s,n-1),d=u(o.end);if(r>d&&r>=s&&r<=c)return{record:o,index:a}}return null}(n,r,a);if(s)return s.record.end=r,p(n),void this.refreshAll();var c=function(e,t){for(var n=e.periodRecords||[],r=null,i=0;i<n.length;i++){var a=n[i],o=l(f(u(a.end),1));o===t&&(!r||u(a.end)>u(r.record.end))&&(r={record:a,index:i})}return r}(n,r);if(c)return c.record.end=r,p(n),void this.refreshAll();n.periodRecords=n.periodRecords||[],n.periodRecords.push({start:r,end:r}),p(n),this.refreshAll()}else{var h=m(n,r);if(h){var D=h.record,w=u(D.start),y=u(D.end),T=u(r);if(D.start===D.end)n.periodRecords.splice(h.index,1);else if(T.getTime()===w.getTime())D.start=l(f(w,1));else if(T.getTime()===y.getTime())D.end=l(f(y,-1));else{var b={start:D.start,end:l(f(T,-1))},x={start:l(f(T,1)),end:D.end};n.periodRecords.splice(h.index,1,b,x)}p(n)}this.refreshAll()}},onTouchStart:function(e){e.touches&&e.touches.length&&this.setData({touchStartX:e.touches[0].clientX,touchStartY:e.touches[0].clientY})},onTouchEnd:function(e){if(e.changedTouches&&e.changedTouches.length){var t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,r=t-this.touchStartX,i=n-this.touchStartY;Math.abs(r)<60||Math.abs(r)<1.2*Math.abs(i)||(r<0?this.goNextMonth():this.goPrevMonth())}},goPeriodAnalysis:function(){e.navigateTo({url:"/pages/subperiod/analysis/analysis"})},onGoAddPain:function(){var t=this.selectedDate;e.navigateTo({url:"/pages/subperiod/addpain/addpain?date=".concat(t)})},onAddWeight:function(){e.hideTabBar({animation:!0});var t=g();v(t);var n=this.selectedDate,r=t.weightRecords&&t.weightRecords[n],i=r&&"number"===typeof r.kg?r.kg:0,a="";i>0&&(a=i.toFixed(2)),this.setData({showWeightPopup:!0,weightInput:a,weightDisplay:a||"0"})},onWeightCancel:function(){this.setData({showWeightPopup:!1}),e.showTabBar({animation:!0})},onWeightKey:function(e){var t=e.currentTarget.dataset.k,n=this.weightInput||"";if("."===t){if(n.includes("."))return;""===n&&(n="0"),n+="."}else"0"===n?n=t:n+=t;var r=n.match(/^(\d{0,3})(?:\.(\d{0,2}))?/);if(r){var i=r[1]||"",a=n.includes(".")?".":"",o=(n.split(".")[1]||"").slice(0,2);n=i+(a?a+o:"")}this.setData({weightInput:n,weightDisplay:""===n?"0":n})},onWeightDel:function(){var e=this.weightInput||"";e?(e=e.slice(0,-1),this.setData({weightInput:e,weightDisplay:""===e?"0":e})):this.setData({weightDisplay:"0"})},onWeightConfirm:function(){var t=(this.weightInput||"").trim();""===t&&(t=(this.weightDisplay||"").trim()),""===t&&(t="0");var n=parseFloat(t);if(isNaN(n))e.showToast({title:"请输入有效体重",icon:"none"});else{var r=g();v(r);var i=this.selectedDate;if(r.weightRecords=r.weightRecords||{},0===n)return r.weightRecords[i]?(delete r.weightRecords[i],p(r),e.showToast({title:"已删除体重记录",icon:"none"})):e.showToast({title:"当天未记录体重",icon:"none"}),this.setData({showWeightPopup:!1}),e.showTabBar({animation:!0}),void this.refreshAll();if(n<0)e.showToast({title:"请输入有效体重",icon:"none"});else{var a=n;r.weightRecords[i]={kg:Number(a.toFixed(2))},p(r),this.setData({showWeightPopup:!1}),e.showTabBar({animation:!0}),e.showToast({title:"已记录体重",icon:"none"}),this.refreshAll()}}},onGoAddLove:function(){var t=this.selectedDate;e.navigateTo({url:"/pages/subperiod/addlove/addlove?date=".concat(t)})}}};t.default=D}).call(this,n("df3c")["default"])},c838:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this.$createElement;this._self._c},i=[]},d871:function(e,t,n){},e1c1:function(e,t,n){"use strict";(function(e,t){var r=n("47a9");n("8ba4");r(n("3240"));var i=r(n("6d4b"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])}},[["e1c1","common/runtime","common/vendor"]]]);